!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t=t||self).racingBars={},t.d3)}(this,function(t,e){function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function r(t,e){for(;t.toString().length<e;)t="0"+t;return t}function a(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerHeight*a}else r=+n;else r=t.getBoundingClientRect().height;return r>e?r:e}function i(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerWidth*a}else r=+n;else r=t.getBoundingClientRect().width;return r>e?r:e}function o(t){var e=new Date(t);if(isNaN(+e))throw new Error('"'+t+'" is not a valid date');var n=e.getFullYear(),a=(1+e.getMonth()).toString();return""+n+(a=r(a,2))+r(e.getDate().toString(),2)}function l(t,e){var n=t.slice(0,4),r=t.slice(4,6),a=t.slice(6,8),i=new Date(n+"-"+r+"-"+a),o=String(i.getDay());return e.replace("MMM",{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[r]).replace("DDD",{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}[o]).replace("YYYY",n).replace("MM",r).replace("DD",a)}t.d3={__proto__:null,axisTop:e.axisTop,csv:e.csv,easeLinear:e.easeLinear,format:e.format,hsl:e.hsl,interpolateRound:e.interpolateRound,interval:e.interval,json:e.json,max:e.max,scaleLinear:e.scaleLinear,select:e.select,selectAll:e.selectAll,tsv:e.tsv,xml:e.xml},t.generateId=function(t,e){return void 0===t&&(t="racingbars"),void 0===e&&(e=8),function(t,e){return t+Array(3).fill(null).map(function(){return Math.random().toString(36).substr(2)}).join("").slice(-e)}(t,e)},t.loadData=function(t,n){switch(void 0===n&&(n="json"),n){case"json":return e.json(t);case"csv":return e.csv(t);case"tsv":return e.tsv(t);case"xml":return e.xml(t);default:throw new Error("Unsupported data type: "+n)}},t.race=function(t,s){void 0===s&&(s={});var u=s.dataShape||"long",c=s.fillDateGaps,d=s.selector||"#race",f=s.startDate?o(s.startDate):"",p=s.endDate?o(s.endDate):"",h=s.colorSeed||"",v=s.disableGroupColors||!1,g=Number(s.tickDuration)||500,y=Number(s.topN)||10,w=!1!==s.disableClickEvents,x=s.disableKeyboardEvents,m=!1!==s.autorun,b=!1!==s.injectStyles,k={selector:d,title:s.title||"18 years of Top Global Brands",subTitle:s.subTitle||"Brand value, $m",caption:s.caption||"Source: Interbrand",dateCounterFormat:s.dateCounterFormat||"YYYY",labelsOnBars:!1!==s.labelsOnBars,labelsWidth:s.labelsWidth||100,showControls:s.showControls||"all",showOverlays:s.showOverlays||"all",inputHeight:s.height,inputWidth:s.width,minHeight:300,minWidth:500,tickDuration:g,topN:y},D={loop:s.loop||!1,tickDuration:g},L=document.querySelector(d);if(!L)throw new Error("Cannot find element with this selector: "+d);b&&function(t,e,n){if(void 0===e&&(e="top"),void 0===n&&(n="\n#selector text {\n  font-size: 16px;\n  font-family: Open Sans, sans-serif;\n}\n\n#selector text.title {\n  font-size: 24px;\n  font-weight: 500;\n}\n\n#selector text.subTitle {\n  font-weight: 500;\n  fill: #777777;\n}\n\n#selector text.caption {\n  font-weight: 400;\n  font-size: 24px;\n  fill: #777777;\n}\n\n#selector text.label {\n  font-weight: 600;\n}\n\n#selector text.valueLabel {\n  font-weight: 300;\n}\n\n#selector text.dateCounterText {\n  font-size: 64px;\n  font-weight: 700;\n  opacity: 0.25;\n}\n\n#selector .tick text {\n  fill: #777777;\n}\n\n#selector .xAxis .tick:nth-child(2) text {\n  text-anchor: start;\n}\n\n#selector .tick line {\n  shape-rendering: CrispEdges;\n  stroke: #dddddd;\n}\n\n#selector .tick line.origin {\n  stroke: #aaaaaa;\n}\n\n#selector path.domain {\n  display: none;\n}\n\n#selector {\n  position: relative;\n}\n\n#selector .controls {\n  /*  width and right are set dynamically in renderer.ts */\n  position: absolute;\n  top: 0;\n  display: flex;\n}\n\n#selector .controls div,\n#selector .overlay div {\n  cursor: pointer;\n  font-size: 24px;\n  font-weight: 700;\n  width: 38px;\n  height: 38px;\n  color: #ffffff;\n  background: #777777;\n  border: 1px solid black;\n  opacity: 0.5;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  margin: 5px;\n  text-align: center;\n}\n\n#selector .controls div:hover,\n#selector .overlay div:hover {\n  background: #aaaaaa;\n  color: black;\n}\n\n#selector .controls svg {\n  margin: 7px auto;\n}\n\n#selector .overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  opacity: 0.7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#selector .overlay div {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 200px;\n  height: 200px;\n  -moz-border-radius: 100px;\n  -webkit-border-radius: 100px;\n  border-radius: 100px;\n}\n#selector .overlay svg {\n  height: 50%;\n  width: 50%;\n}\n"),n&&"undefined"!=typeof document){n=n.split("#selector").join(t);var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===e&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n))}}(d,"top");var C,A=function(t,r){var o,s,u,c,d,f,p,h,v,g,y,w,x;function m(t,e){void 0===e&&(e=""),t?(y.play.style.display="none",y.pause.style.display="unset"):(y.play.style.display="unset",y.pause.style.display="none"),"first"!==e||"all"!==w&&"play"!==w?"last"!==e||"all"!==w&&"repeat"!==w?(y.container.style.visibility="unset",x.container.style.display="none"):(y.container.style.visibility="hidden",x.container.style.display="flex",x.overlayPlay.style.display="none",x.overlayRepeat.style.display="flex"):(y.container.style.visibility="hidden",x.container.style.display="flex",x.overlayPlay.style.display="flex",x.overlayRepeat.style.display="none")}return{renderInitalView:function(t){var n=r.selector,b=r.title,k=r.subTitle,D=r.caption,L=r.dateCounterFormat,C=r.labelsOnBars,A=r.labelsWidth,M=r.showControls,F=r.inputHeight,Y=r.inputWidth,S=r.minHeight,E=r.minWidth,j=r.topN;w=r.showOverlays;var B,O,H=t.length>0?t[0].date:"",W=document.querySelector(n);v=a(W,S,F),g=i(W,E,Y),s=e.select(n).append("svg").attr("width",g).attr("height",v),f=(v-((o={top:80,right:0,bottom:5,left:0+(C?0:A)}).bottom+o.top))/(5*j),s.append("text").attr("class","title").attr("y",24).html(b),s.append("text").attr("class","subTitle").attr("y",55).html(k),u=e.scaleLinear().domain([0,e.max(t,function(t){return t.value})]).range([o.left,g-o.right-65]),c=e.scaleLinear().domain([j,0]).range([v-o.bottom,o.top]),d=e.axisTop(u).ticks(g>500?5:2).tickSize(-(v-o.top-o.bottom)).tickFormat(function(t){return e.format(",")(t)}),s.append("g").attr("class","axis xAxis").attr("transform","translate(0, "+o.top+")").call(d).selectAll(".tick line").classed("origin",function(t){return 0===t}),s.selectAll("rect.bar").data(t,function(t){return t.name}).enter().append("rect").attr("class","bar").attr("x",u(0)+1).attr("width",function(t){return Math.abs(u(t.value)-u(0)-1)}).attr("y",function(t){return c(t.rank)+5}).attr("height",c(1)-c(0)-f).style("fill",function(t){return t.color}),h=C?function(t){return u(t.value)-8}:o.left-8,s.selectAll("text.label").data(t,function(t){return t.name}).enter().append("text").attr("class","label").attr("x",h).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}).style("text-anchor","end").html(function(t){return t.name}),s.selectAll("text.valueLabel").data(t,function(t){return t.name}).enter().append("text").attr("class","valueLabel").attr("x",function(t){return u(t.value)+5}).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}).text(function(t){return e.format(",.0f")(t.lastValue)}),p=s.append("text").attr("class","dateCounterText").attr("x",g-o.right-f).attr("y",v-40).style("text-anchor","end").html(l(H,L)).call(function(t,e){t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("fill","#ffffff").style("stroke","#ffffff").style("stroke-width",e).style("stroke-linejoin","round").style("opacity",1)},10),s.append("text").attr("class","caption").attr("x",g-o.right-f-10).attr("y",v-o.bottom-f).style("text-anchor","end").html(D),function(){var t={},r=W.getBoundingClientRect().width;e.select(n).append("div").classed("controls",!0).style("width",g).style("right",r-g+o.right+f+"px").call(function(e){t.container=e.node()}).selectAll("div").data([{skipBack:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="pravious"><path d="M28.46,4a3,3,0,0,0-3,.07l-15.2,9.41A3,3,0,0,0,9,15V5A3,3,0,0,0,6,2H5A3,3,0,0,0,2,5V27a3,3,0,0,0,3,3H6a3,3,0,0,0,3-3V17a3,3,0,0,0,1.22,1.53L25.42,28a3,3,0,0,0,1.58.46,3,3,0,0,0,3-3V6.59A3,3,0,0,0,28.46,4Z"/></g></svg>'},{play:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="Play"><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{pause:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="pause"><rect height="28" rx="1" width="7" x="7" y="2"/><rect height="28" rx="1" width="7" x="18" y="2"/></g></svg>'},{skipForward:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="forward"><path d="M27,2H26a3,3,0,0,0-3,3V15a3,3,0,0,0-1.22-1.53L6.58,4A3,3,0,0,0,2,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,6.58,28l15.2-9.41A3,3,0,0,0,23,17V27a3,3,0,0,0,3,3h1a3,3,0,0,0,3-3V5A3,3,0,0,0,27,2Z"/></g></svg>'}]).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}).each(function(e){t[Object.keys(e)[0]]=this}),y=t,"play"===M&&(y.skipBack.style.visibility="hidden",y.skipForward.style.visibility="hidden"),"none"===M&&e.select(n+" .controls").style("display","none")}(),B=[{overlayPlay:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="Play"><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{overlayRepeat:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><title/><g id="reload"><path d="M18,4A12,12,0,0,0,6.05,15H3a1,1,0,0,0-.88.53,1,1,0,0,0,0,1l4,6a1,1,0,0,0,1.66,0l4-6a1,1,0,0,0,.05-1A1,1,0,0,0,11,15H8.05A10,10,0,1,1,18,26a1,1,0,0,0,0,2A12,12,0,0,0,18,4Z"/></g></svg>'}],O={},e.select(n).append("div").classed("overlay",!0).style("minHeight",S+"px").style("minWidth",E+"px").call(function(t){O.container=t.node()}).selectAll("div").data(B).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}).each(function(t){O[Object.keys(t)[0]]=this}),x=O,m(!1,"first")},renderFrame:function(t){if(u){var n=r.tickDuration,a=r.topN,i=r.dateCounterFormat,o=t.length>0?t[0].date:"";u.domain([0,e.max(t,function(t){return t.value})]),s.select(".xAxis").transition().duration(n).ease(e.easeLinear).call(d);var v=s.selectAll(".bar").data(t,function(t){return t.name});v.enter().append("rect").attr("class",function(t){return"bar "+t.name.replace(/\s/g,"_")}).attr("x",u(0)+1).attr("width",function(t){return Math.abs(u(t.value)-u(0)-1)}).attr("y",function(){return c(a+1)+5}).attr("height",c(1)-c(0)-f).style("fill",function(t){return t.color}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return c(t.rank)+5}),v.transition().duration(n).ease(e.easeLinear).attr("width",function(t){return Math.abs(u(t.value)-u(0)-1)}).attr("y",function(t){return c(t.rank)+5}),v.exit().transition().duration(n).ease(e.easeLinear).attr("width",function(t){return Math.abs(u(t.value)-u(0)-1)}).attr("y",function(){return c(a+1)+5}).remove();var g=s.selectAll(".label").data(t,function(t){return t.name});g.enter().append("text").attr("class","label").attr("x",h).attr("y",function(){return c(a+1)+5+(c(1)-c(0))/2}).style("text-anchor","end").html(function(t){return t.name}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}),g.transition().duration(n).ease(e.easeLinear).attr("x",h).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}),g.exit().transition().duration(n).ease(e.easeLinear).attr("x",h).attr("y",function(){return c(a+1)+5}).remove();var y=s.selectAll(".valueLabel").data(t,function(t){return t.name});y.enter().append("text").attr("class","valueLabel").attr("x",function(t){return u(t.value)+5}).attr("y",function(){return c(a+1)+5}).text(function(t){return e.format(",.0f")(t.lastValue)}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}),y.transition().duration(n).ease(e.easeLinear).attr("x",function(t){return u(t.value)+5}).attr("y",function(t){return c(t.rank)+5+(c(1)-c(0))/2+1}).tween("text",function(t){var n=e.interpolateRound(t.lastValue,t.value);return function(t){this.textContent=e.format(",")(n(t))}}),y.exit().transition().duration(n).ease(e.easeLinear).attr("x",function(t){return u(t.value)+5}).attr("y",function(){return c(a+1)+5}).remove(),p.html(l(o,i))}},resize:function(e){if(!r.inputHeight&&!r.inputWidth||String(r.inputHeight).startsWith("window")||String(r.inputWidth).startsWith("window")){var n=document.querySelector(t);v=a(n,r.minHeight,r.inputHeight),g=i(n,r.minWidth,r.inputWidth);var o=n.style.position;e(),n.style.position=o}},updateControls:m,getRenderedHeight:function(){return v},getRenderedWidth:function(){return g},getControls:function(){return n(n({},y),x)}}}(d,k),M=function(t){var n,r,a,i,o,l;function s(){f(!0),n=e.interval(function(e){r.isLast()?(l(),o?d():(u(),t(a,"last"))):r.inc()},i),t(a,"")}function u(){n&&n.stop(),f(!1)}function c(){u(),r.setFirst(),l(),t(a,"first")}function d(){r.setFirst(),l()}function f(e){void 0===e&&(e=!0),a=e;var n=r.isLast()?"last":r.isFirst()?"first":"";t(a,n)}return{tickerDateFactory:function(t,e,n,a){i=e.tickDuration,o=e.loop,l=a;var s,u=0,c=t.length-1,d=t[c];function f(){n(s=t[u])}return r={inc:function(t){void 0===t&&(t=1);var e=u+t;u=e>c?c:e,f()},dec:function(t){void 0===t&&(t=1);var e=u-t;u=e<0?0:e,f()},setFirst:function(){u=0,f()},setLast:function(){u=t.length-1,f()},update:function(){f()},getDate:function(){return s},setDate:function(e){var n=t.indexOf(e);n>-1&&(u=n,f())},isFirst:function(){return s===t[0]},isLast:function(){return s===d}}},start:s,stop:u,rewind:c,loop:d,fastForward:function(){u(),r.setLast(),l(),t(a,"last")},toggle:function(){r.isLast()?(c(),s()):a?u():s()},isRunning:function(){return a}}}(function(t,e){A.updateControls(t,e)}),F=function(t){var e=new Set;return t.forEach(function(t){e.add(t.date)}),Array.from(e).sort()}(t=function(t,a,i,l){var s;return"wide"===a&&(s=[],t.forEach(function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e];s.push({date:t.date,name:r[0],value:Number(r[1])})}}),t=s),t.map(function(t){var a=n({},t);return a.value=isNaN(+a.value)?0:+a.value,a.date=o(a.date),a.color=function(t,n,a){return e.hsl(360*(i=function(t){for(var e="",n=0;n<t.length;n++)e+=r(String(t.charCodeAt(n)),3);return e}((t.group&&!n?t.group:t.name)+a),(o=1e4*Math.sin(+i))-Math.floor(o)),.75,.75);var i,o}(a,i,l),a})}(t=function(t,e,n){return t.filter(function(t){return!e||t.date>=e}).filter(function(t){return!n||t.date<=n})}(t,f,p),u,v,h));c&&(t=function(t,e,r){var a=new Date(l(e[0],"YYYY-MM-DD")),i=new Date(l(e[e.length-1],"YYYY-MM-DD")),s={years:function(t){t.setFullYear(t.getFullYear()+1)},months:function(t){t.setMonth(t.getMonth()+1)},days:function(t){t.setDate(t.getDate()+1)}};if(!s[r])return t;for(var u=[],c=a;c<i;s[r](c))u.push(o(c));return u.forEach(function(e,r){if(!(t.filter(function(t){return t.date===e}).length>0)){var a=t.filter(function(t){return t.date===u[r-1]}).map(function(t){return n(n({},t),{},{date:e})});t.push.apply(t,a)}}),t}(t,F,c));var Y,S=M.tickerDateFactory(F,D,function(e){Y=function(t,e,r,a){return t.filter(function(t){return t.date===e&&!isNaN(t.value)}).map(function(t){if(!r[t.name])return t;var e=r[t.name].value;return r[t.name].date=t.date,r[t.name].value=t.value,n(n({},t),{},{lastValue:e})}).sort(function(t,e){return e.value-t.value}).slice(0,a).map(function(t,e){return n(n({},t),{},{rank:e})})}(t,S.getDate(),C,y),j(),L.dispatchEvent(new CustomEvent("dateChanged",{detail:{date:l(e,"YYYY-MM-DD")}}))},j);function E(){L.innerHTML="",A.renderInitalView(Y),M.stop();var t=A.getControls();!function(t){t&&(t.skipBack.addEventListener("click",M.rewind),t.play.addEventListener("click",M.toggle),t.pause.addEventListener("click",M.toggle),t.skipForward.addEventListener("click",M.fastForward))}(t),function(t){t&&(t.overlayPlay.addEventListener("click",M.start),t.overlayRepeat.addEventListener("click",function(){M.rewind(),M.start()}))}(t)}function j(){A.renderFrame(Y)}return C={},t.forEach(function(t){t.lastValue=t.value,(!C[t.name]||t.date<C[t.name].date)&&(C[t.name]={date:t.date,value:t.value})}),S.setFirst(),E(),j(),M.start(),m||M.stop(),w||(L.querySelector("svg").addEventListener("click",M.toggle),L.addEventListener("dblclick",M.fastForward)),x||document.addEventListener("keypress",function(t){switch(t.keyCode){case 32:M.toggle();break;case 97:M.rewind();break;case 115:M.toggle();break;case 100:M.fastForward()}}),window.addEventListener("resize",function(){A.resize(function(){var t=M.isRunning();S.update(),E(),t&&M.start()})}),{start:function(){M.isRunning()||M.start()},stop:function(){M.stop()},rewind:function(){M.rewind()},fastforward:function(){M.fastForward()},loop:function(){M.loop()},inc:function(t){void 0===t&&(t=1),S.inc(t)},dec:function(t){void 0===t&&(t=1),S.dec(t)},getDate:function(){return S.getDate()},setDate:function(t){S.setDate(o(t))},getAllDates:function(){return F.map(function(t){return l(t,"YYYY-MM-DD")})},createScroller:function(){!function(){!function(){L.style.position="fixed",L.style.top="0";var t=document.createElement("div");t.style.height=10*window.innerHeight+"px",document.body.appendChild(t)}();var t=document.body.clientHeight/F.length;window.addEventListener("scroll",function(){var e=Math.ceil(window.pageYOffset/t);e<F.length?S.setDate(F[e]):S.setLast()})}()}}}});
//# sourceMappingURL=racing-bars.umd.js.map
