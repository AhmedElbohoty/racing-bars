!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t=t||self).racingBars={},t.d3)}(this,function(t,e){var n={__proto__:null,get actionTypes(){return a},get optionsLoaded(){return i},get changeOptions(){return o},get optionsChanged(){return s},get optionsReducer(){return R}},r={__proto__:null,axisTop:e.axisTop,csv:e.csv,easeLinear:e.easeLinear,format:e.format,hsl:e.hsl,interpolateRound:e.interpolateRound,interval:e.interval,json:e.json,max:e.max,scaleLinear:e.scaleLinear,select:e.select,selectAll:e.selectAll,tsv:e.tsv,xml:e.xml},a={optionsLoaded:"options/loaded",changeOptions:"options/change",optionsChanged:"options/changed"},i=function(t){return{type:a.optionsLoaded,payload:t}},o=function(t){return{type:a.changeOptions,payload:t}},s=function(t){return{type:a.optionsChanged,payload:t}};function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var c={initialize:"ticker/initialize",updateDate:"ticker/updateDate",setRunning:"ticker/setRunning",setFirst:"ticker/setFirst",setLast:"ticker/setLast",inc:"ticker/inc",dec:"ticker/dec"},u={isRunning:!1,currentDate:"",isFirstDate:!0,isLastDate:!1,dates:[]};function d(t,e){switch(void 0===t&&(t=u),e.type){case c.initialize:var n=e.payload;return l(l({},t),{},{isRunning:!1,currentDate:n[0],isFirstDate:!0,isLastDate:!1,dates:n});case c.updateDate:var r=e.payload;return-1===t.dates.indexOf(r)?l({},t):l(l({},t),{},{currentDate:r,isFirstDate:r===t.dates[0],isLastDate:r===t.dates[t.dates.length-1]});case c.setRunning:return l(l({},t),{},{isRunning:e.payload});case c.setFirst:return l(l({},t),{},{currentDate:t.dates[0],isFirstDate:!0,isLastDate:!1});case c.setLast:return l(l({},t),{},{currentDate:t.dates[t.dates.length-1],isFirstDate:!1,isLastDate:!0});case c.inc:var a=t.dates.indexOf(t.currentDate),i=t.dates.length-1,o=e.payload,s=a+o>i?t.dates[i]:t.dates[a+o];return l(l({},t),{},{currentDate:s,isFirstDate:s===t.dates[0],isLastDate:s===t.dates[i]});case c.dec:var d=t.dates.indexOf(t.currentDate),p=e.payload,f=d-p<0?t.dates[0]:t.dates[d-p];return l(l({},t),{},{currentDate:f,isFirstDate:f===t.dates[0],isLastDate:f===t.dates[t.dates.length-1]});default:return t}}function p(t){var n;function r(){n=e.interval(function(t){h.getState().ticker.isLastDate?h.getState().options.loop?o():a():h.dispatch(f.ticker.inc())},h.getState().options.tickDuration),h.dispatch(f.ticker.setRunning(!0))}function a(){n&&n.stop(),h.dispatch(f.ticker.setRunning(!1))}function i(){a(),h.dispatch(f.ticker.setFirst())}function o(){h.dispatch(f.ticker.setFirst())}return h.dispatch(f.ticker.initialize(t)),{start:r,stop:a,skipBack:i,loop:o,skipForward:function(){a(),h.dispatch(f.ticker.setLast())},toggle:function(){h.getState().ticker.isLastDate?(i(),r()):h.getState().ticker.isRunning?a():(h.getState().ticker.isFirstDate||h.dispatch(f.ticker.inc()),r())},goToDate:function(t){h.dispatch(f.ticker.updateDate(t))}}}var f={options:n,ticker:{__proto__:null,actionTypes:c,initialize:function(t){return{type:c.initialize,payload:t}},updateDate:function(t){return{type:c.updateDate,payload:t}},setRunning:function(t){return{type:c.setRunning,payload:t}},setFirst:function(){return{type:c.setFirst}},setLast:function(){return{type:c.setLast}},inc:function(t){return void 0===t&&(t=1),{type:c.inc,payload:t}},dec:function(t){return void 0===t&&(t=1),{type:c.dec,payload:t}},tickerReducer:d,createTicker:p}};function g(t,e){return{options:R(t.options,e),ticker:d(t.ticker,e)}}var h=function(t,e){void 0===t&&(t=g);var n={},r=[];return{getState:function(){return n},dispatch:function(e){return n=t(n,e),r.forEach(function(t){t()}),e},subscribe:function(t){r.push(t);var e=r.length-1;return{unsubscribe:function(){r.splice(e,1)}}}}}(g);function v(t,n,r){return e.hsl(360*(a=function(t){for(var e="",n=0;n<t.length;n++)e+=k(String(t.charCodeAt(n)),3);return e}((t.group&&n?t.group:t.name)+r),(i=1e4*Math.sin(+a))-Math.floor(i)),.75,.75);var a,i}function y(t){return"icon-"+t.name.toLowerCase().split(" ").join("_")}function k(t,e){for(;t.toString().length<e;)t="0"+t;return t}function x(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerHeight*a}else r=+n;else r=t.getBoundingClientRect().height;return r>e?r:e}function m(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerWidth*a}else r=+n;else r=t.getBoundingClientRect().width;return r>e?r:e}function w(t){return document.querySelector(h.getState().options.selector).querySelector("."+t)}function b(t){var e=h.getState().options.selector,n=document.querySelector(e+" ."+t);n&&(n.style.display="flex")}function S(t){var e=h.getState().options.selector,n=document.querySelector(e+" ."+t);n&&(n.style.display="none")}function D(t,e,n){var r=w(t);r&&r.addEventListener(e,n)}function L(t,e,n){return void 0===n&&(n=!1),"function"==typeof t?t(F(h.getState().ticker.currentDate),e.map(function(t){return l(l({},t),{},{date:F(t.date)})}),h.getState().ticker.dates.map(function(t){return F(t)})):n?F(h.getState().ticker.currentDate,t):t}var C=function(t){return Array.from(new Set(t.map(function(t){return t.date}))).sort()};function A(t){var e=new Date(t);if(isNaN(+e))throw new Error('"'+t+'" is not a valid date');var n=e.getFullYear(),r=(1+e.getMonth()).toString();return""+n+(r=k(r,2))+k(e.getDate().toString(),2)}function F(t,e){void 0===e&&(e="YYYY-MM-DD");var n=t.slice(0,4),r=t.slice(4,6),a=t.slice(6,8),i=new Date(n+"-"+r+"-"+a),o=String(i.getDay());return e.replace("MMM",{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[r]).replace("DDD",{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}[o]).replace("YYYY",n).replace("MM",r).replace("DD",a)}var M={selector:"#race",dataShape:"long",fillDateGaps:!1,fillDateGapsValue:"last",startDate:"",endDate:"",colorSeed:"",showGroups:!0,tickDuration:500,topN:10,disableClickEvents:!0,disableKeyboardEvents:!1,autorun:!0,loop:!1,injectStyles:!0,title:"",subTitle:"",caption:"",dateCounter:"MM/YYYY",labelsOnBars:!0,labelsWidth:100,showIcons:!1,showControls:"all",showOverlays:"none",inputHeight:"",inputWidth:"",minHeight:300,minWidth:500,height:"",width:"",theme:"light"};function R(t,e){switch(void 0===t&&(t=M),e.type){case a.optionsLoaded:var n=e.payload.startDate?A(e.payload.startDate):"",r=e.payload.endDate?A(e.payload.endDate):"",i=e.payload.height,o=e.payload.width;return l(l(l({},t),e.payload),{},{startDate:n,endDate:r,inputHeight:i,inputWidth:o});case a.changeOptions:return l(l({},t),e.payload);default:return t}}function j(t,e){return t.filter(function(t){return t.date===e&&!isNaN(t.value)}).sort(function(t,e){return e.value-t.value}).map(function(t,e){return l(l({},t),{},{rank:e})})}var B={dark:"#selector {  background-color: #313639;}#selector text.title {  fill: #fafafa;}#selector text.subTitle {  fill: #cccccc;}#selector text.dateCounterText {  fill: #cccccc;  opacity: 1;}#selector text.caption {  fill: #cccccc;}#selector .halo {  fill: #313639;  stroke: #313639;  stroke-width: 10;  stroke-linejoin: round;  opacity: 1;}#selector text.label {  fill: #313639;}#selector text.valueLabel {  fill: #fafafa;}#selector .tick text {  fill: #cccccc;}#selector .tick line {  shape-rendering: CrispEdges;  stroke: #dddddd;}#selector .tick line.origin {  stroke: #aaaaaa;}#selector .controls div,#selector .overlay div {  color: #ffffff;  background: #777777;  border: 1px solid black;  opacity: 0.5;}#selector .controls div:hover,#selector .overlay div:hover {  background: #aaaaaa;  color: black;}#selector .overlay {  background-color: black;  opacity: 0.7;}",light:"/* #selector {  background-color: #ffffff;}#selector text.title {  fill: #fafafa;} */#selector text.subTitle {  fill: #777777;}#selector text.dateCounterText {  fill: #bbbbbb;  opacity: 1;}#selector text.caption {  fill: #777777;}#selector .halo {  fill: #ffffff;  stroke: #ffffff;  stroke-width: 10;  stroke-linejoin: round;  opacity: 1;}#selector text.label {  fill: #000000;}#selector text.valueLabel {  fill: #000000;}#selector .tick text {  fill: #777777;}#selector .tick line {  shape-rendering: CrispEdges;  stroke: #dddddd;}#selector .tick line.origin {  stroke: #aaaaaa;}#selector .controls div,#selector .overlay div {  color: #ffffff;  background: #777777;  border: 1px solid black;  opacity: 0.5;}#selector .controls div:hover,#selector .overlay div:hover {  background: #aaaaaa;  color: black;}#selector .overlay {  background-color: black;  opacity: 0.7;}"};function E(t,e){D("skipBack","click",e.skipBack),D("play","click",e.toggle),D("pause","click",e.toggle),D("skipForward","click",e.skipForward),D("overlayPlay","click",function(){S("overlay"),e.start()}),D("overlayRepeat","click",function(){S("overlay"),e.loop(),e.start()}),h.getState().options.disableClickEvents||(t.querySelector("svg").addEventListener("click",e.toggle),t.addEventListener("dblclick",e.skipForward)),h.getState().options.disableKeyboardEvents||document.addEventListener("keypress",function(t){switch(t.keyCode){case 32:e.toggle();break;case 97:e.skipBack();break;case 115:e.toggle();break;case 100:e.skipForward()}})}t.d3=r,t.generateId=function(t,e){return void 0===t&&(t="racingbars"),void 0===e&&(e=8),function(t,e){return t+Array(3).fill(null).map(function(){return Math.random().toString(36).substr(2)}).join("").slice(-e)}(t,e)},t.loadData=function(t,n){switch(void 0===n&&(n="json"),n){case"json":return e.json(t);case"csv":return e.csv(t);case"tsv":return e.tsv(t);case"xml":return e.xml(t);default:throw new Error("Unsupported data type: "+n)}},t.race=function(t,n){h.dispatch(f.options.optionsLoaded(n));var r=document.querySelector(h.getState().options.selector);if(!r)throw new Error("Cannot find element with this selector: "+h.getState().options.selector);h.getState().options.injectStyles&&function(t,e){void 0===e&&(e="top");var n="#selector text {  font-size: 16px;  font-family: Open Sans, sans-serif;}#selector text.title {  font-size: 24px;  font-weight: 500;}#selector text.subTitle {  font-weight: 500;}#selector text.caption {  font-weight: 400;  font-size: 24px;}#selector text.label {  font-weight: 600;}#selector text.valueLabel {  font-weight: 300;}#selector text.dateCounterText {  font-size: 64px;  font-weight: 700;}#selector .xAxis .tick:nth-child(2) text {  text-anchor: start;}#selector .tick line {  shape-rendering: CrispEdges;}#selector path.domain {  display: none;}#selector {  position: relative;}#selector .controls {  /*  width and right are set dynamically in renderer.ts */  position: absolute;  top: 0;  display: flex;}#selector .controls div,#selector .overlay div {  cursor: pointer;  font-size: 24px;  font-weight: 700;  width: 38px;  height: 38px;  -moz-border-radius: 5px;  -webkit-border-radius: 5px;  border-radius: 5px;  margin: 5px;  text-align: center;}#selector .controls svg {  margin: 5px auto;  width: 28px;  height: 28px;}#selector .overlay {  position: absolute;  top: 0;  left: 0;  width: 100%;  height: 100%;  display: flex;  align-items: center;  justify-content: center;}#selector .overlay div {  position: relative;  display: flex;  align-items: center;  justify-content: center;  width: 200px;  height: 200px;  -moz-border-radius: 100px;  -webkit-border-radius: 100px;  border-radius: 100px;}#selector .overlay svg {  height: 50%;  width: 50%;}"+B[h.getState().options.theme];if(n&&"undefined"!=typeof document){n=n.split("#selector").join(t);var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===e&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n))}}(h.getState().options.selector,"top");var a=function(t){var e,n=h.getState().options,r=t.map(function(t){return l(l({},t),{},{date:A(t.date)})}).filter(function(t){return!n.startDate||t.date>=n.startDate}).filter(function(t){return!n.endDate||t.date<=n.endDate});return"wide"===n.dataShape&&(e=[],r.forEach(function(t){for(var n=0,r=Object.entries(t);n<r.length;n++){var a=r[n];e.push({date:t.date,name:a[0],value:Number(a[1])})}}),r=e),n.fillDateGaps&&(r=function(t,e){if(!e)return t;var n=C(t),r=new Date(F(n[0])),a=new Date(F(n[n.length-1])),i={years:function(t){t.setFullYear(t.getFullYear()+1)},months:function(t){t.setMonth(t.getMonth()+1)},days:function(t){t.setDate(t.getDate()+1)}};if(!i[e])return t;for(var o=[],s=r;s<a;i[e](s))o.push(A(s));return o.forEach(function(e,n){if(!(t.filter(function(t){return t.date===e}).length>0)){var r=t.filter(function(t){return t.date===o[n-1]}).map(function(t){return l(l({},t),{},{date:e})});t.push.apply(t,r)}}),t}(r,n.fillDateGaps)),function(t){return t.sort(function(t,e){return t.name.localeCompare(e.name)||t.date.localeCompare(e.date)}).reduce(function(t,e){if(0===t.length)e.lastValue=e.value;else{var n=t[t.length-1];e.lastValue=e.name===n.name?n.value:e.value}return[].concat(t,[e])},[]).sort(function(t,e){return t.date.localeCompare(e.date)})}(r=r.map(function(t){var e=isNaN(+t.value)?0:+t.value,r=v(t,n.showGroups,n.colorSeed);return l(l({},t),{},{value:e,color:r})}))}(t),i=C(a),o=p(i),s=function(t){var n,r,a,i,o,s,l,c,u,d,p,f,g,k,D,C,A,F,M,R;function B(){var w,b,B,E=h.getState().options,V=E.selector,z=E.title,H=E.subTitle,W=E.caption,N=E.dateCounter,Y=E.labelsOnBars,_=E.showIcons,q=E.labelsWidth,G=E.inputHeight,Z=E.inputWidth,I=E.minHeight,P=E.minWidth,J=E.topN,K=j(t,h.getState().ticker.currentDate),U=K.slice(0,h.getState().options.topN),Q=document.querySelector(V);Q.innerHTML="",M=x(Q,I,G),R=m(Q,P,Z),function(){var x=Array.from(new Set(t.map(function(t){return t.group}))).filter(Boolean).sort(),m=h.getState().options.showGroups&&x.length>0;if(n={top:80+(m?40:0),right:0,bottom:5,left:0+(Y?0:q)},a=e.scaleLinear().domain([0,e.max(U,function(t){return t.value})]).range([n.left,R-n.right-65]),i=e.scaleLinear().domain([J,0]).range([M-n.bottom,n.top]),s=(M-(n.bottom+n.top))/(5*J),l=8,c=i(1)-i(0)-s,u=(i(1)-i(0))/2+1,F=function(t){return i(t.rank)+5},p=_?.9*c:0,f=_?p+l:0,A=Y?function(t){return a(t.value)-l-f}:n.left-l,r=e.select(V).append("svg").attr("width",R).attr("height",M),g=r.append("text").attr("class","title").attr("x",5).attr("y",24).html(L(z,K)),k=r.append("text").attr("class","subTitle").attr("x",5).attr("y",55).html(L(H,K)),m){var w=e.scaleLinear().domain([x.length,0]).range([R-n.right,n.left]);r.selectAll("rect.group-color").data(x).enter().append("rect").attr("class","group-color").attr("width",10).attr("height",10).attr("x",function(t,e){return w(e)}).attr("y",75).style("fill",function(t){return v({group:t},!0,h.getState().options.colorSeed).toString()}),r.selectAll("text.group").data(x).enter().append("text").attr("class","group").attr("x",function(t,e){return w(e)+20}).attr("y",85).html(function(t){return t})}o=e.axisTop(a).ticks(R>500?5:2).tickSize(-(M-(n.top+n.bottom))).tickFormat(function(t){return e.format(",")(t)}),r.append("g").attr("class","axis xAxis").attr("transform","translate(0, "+n.top+")").call(o).selectAll(".tick line").classed("origin",function(t){return 0===t}),r.selectAll("rect.bar").data(U,function(t){return t.name}).enter().append("rect").attr("class","bar").attr("x",a(0)+1).attr("width",function(t){return Math.abs(a(t.value)-a(0)-1)}).attr("y",F).attr("height",c).style("fill",function(t){return t.color}),r.selectAll("text.label").data(U,function(t){return t.name}).enter().append("text").attr("class","label").attr("x",A).attr("y",function(t){return F(t)+u}).style("text-anchor","end").html(function(t){return t.name}),r.selectAll("text.valueLabel").data(U,function(t){return t.name}).enter().append("text").attr("class","valueLabel").attr("x",function(t){return a(t.value)+5}).attr("y",function(t){return F(t)+u}).text(function(t){return e.format(",.0f")(t.lastValue)}),_&&((d=r.append("svg:defs")).selectAll("svg").data(U,function(t){return t.name}).enter().append("svg:pattern").attr("class","svgpattern").attr("id",y).attr("width",p).attr("height",p).append("svg:image").attr("xlink:href",function(t){return t.icon}).attr("width",p).attr("height",p).attr("x",0).attr("y",0),r.selectAll("circle").data(U,function(t){return t.name}).enter().append("circle").attr("cx",function(t){return a(t.value)-p/2-l}).attr("cy",function(t){return i(t.rank)+u}).attr("r",p/2).style("fill","transparent").style("fill",function(t){return"url(#"+y(t)+")"})),C=r.append("text").attr("class","dateCounterText").attr("x",R-n.right-s).attr("y",M-40).style("text-anchor","end").html(L(N,K,!0)).call(O),D=r.append("text").attr("class","caption").attr("x",R-n.right-s-10).attr("y",M-n.bottom-s).style("text-anchor","end").html(L(W,K))}(),b=[{skipBack:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M28.46,4a3,3,0,0,0-3,.07l-15.2,9.41A3,3,0,0,0,9,15V5A3,3,0,0,0,6,2H5A3,3,0,0,0,2,5V27a3,3,0,0,0,3,3H6a3,3,0,0,0,3-3V17a3,3,0,0,0,1.22,1.53L25.42,28a3,3,0,0,0,1.58.46,3,3,0,0,0,3-3V6.59A3,3,0,0,0,28.46,4Z"/></g></svg>'},{play:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{pause:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns:svg="http://www.w3.org/2000/svg"><g transform="translate(-17)"><path d="m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z" /></g><g transform="translate(-4)"><path d="m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z" /></g></svg>'},{skipForward:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M27,2H26a3,3,0,0,0-3,3V15a3,3,0,0,0-1.22-1.53L6.58,4A3,3,0,0,0,2,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,6.58,28l15.2-9.41A3,3,0,0,0,23,17V27a3,3,0,0,0,3,3h1a3,3,0,0,0,3-3V5A3,3,0,0,0,27,2Z"/></g></svg>'}],B=Q.getBoundingClientRect().width,e.select(V).append("div").classed("controls",!0).style("width",R).style("right",B-R+n.right+s+"px").selectAll("div").data(b).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}),"play"===h.getState().options.showControls&&(S("skipBack"),S("skipForward")),"none"===h.getState().options.showControls&&S("controls"),w=[{overlayPlay:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{overlayRepeat:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M18,4A12,12,0,0,0,6.05,15H3a1,1,0,0,0-.88.53,1,1,0,0,0,0,1l4,6a1,1,0,0,0,1.66,0l4-6a1,1,0,0,0,.05-1A1,1,0,0,0,11,15H8.05A10,10,0,1,1,18,26a1,1,0,0,0,0,2A12,12,0,0,0,18,4Z"/></g></svg>'}],e.select(V).append("div").classed("overlay",!0).style("minHeight",I+"px").style("minWidth",P+"px").selectAll("div").data(w).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}),T()}function E(){if(a){var n=h.getState().options,s=n.tickDuration,f=n.topN,v=n.title,x=n.subTitle,m=n.caption,w=n.dateCounter,b=j(t,h.getState().ticker.currentDate),S=b.slice(0,h.getState().options.topN);a.domain([0,e.max(S,function(t){return t.value})]),r.select(".xAxis").transition().duration(s).ease(e.easeLinear).call(o);var M=r.selectAll(".bar").data(S,function(t){return t.name});M.enter().append("rect").attr("class",function(t){return"bar "+t.name.replace(/\s/g,"_")}).attr("x",a(0)+1).attr("width",function(t){return Math.abs(a(t.value)-a(0)-1)}).attr("y",function(){return i(f+1)+5}).attr("height",c).style("fill",function(t){return t.color}).transition().duration(s).ease(e.easeLinear).attr("y",F),M.transition().duration(s).ease(e.easeLinear).attr("width",function(t){return Math.abs(a(t.value)-a(0)-1)}).attr("y",F),M.exit().transition().duration(s).ease(e.easeLinear).attr("width",function(t){return Math.abs(a(t.value)-a(0)-1)}).attr("y",function(){return i(f+1)+5}).remove();var R=r.selectAll(".label").data(S,function(t){return t.name});R.enter().append("text").attr("class","label").attr("x",A).attr("y",function(){return i(f+1)+5+u}).style("text-anchor","end").html(function(t){return t.name}).transition().duration(s).ease(e.easeLinear).attr("y",function(t){return F(t)+u}),R.transition().duration(s).ease(e.easeLinear).attr("x",A).attr("y",function(t){return F(t)+u}),R.exit().transition().duration(s).ease(e.easeLinear).attr("x",A).attr("y",function(){return i(f+1)+5}).remove();var B=r.selectAll(".valueLabel").data(S,function(t){return t.name});if(B.enter().append("text").attr("class","valueLabel").attr("x",function(t){return a(t.value)+5}).attr("y",function(){return i(f+1)+5}).text(function(t){return e.format(",.0f")(t.lastValue)}).transition().duration(s).ease(e.easeLinear).attr("y",function(t){return F(t)+u}),B.transition().duration(s).ease(e.easeLinear).attr("x",function(t){return a(t.value)+5}).attr("y",function(t){return F(t)+u}).tween("text",function(t){var n=e.interpolateRound(t.lastValue,t.value);return function(t){this.textContent=e.format(",")(n(t))}}),B.exit().transition().duration(s).ease(e.easeLinear).attr("x",function(t){return a(t.value)+5}).attr("y",function(){return i(f+1)+5}).remove(),h.getState().options.showIcons){var E=d.selectAll(".svgpattern").data(S,function(t){return t.name});E.enter().append("svg:pattern").attr("class","svgpattern").attr("id",y).attr("width",p).attr("height",p).append("svg:image").attr("xlink:href",function(t){return t.icon}).attr("width",p).attr("height",p).style("z-index","99").attr("x",0).attr("y",0),E.exit().remove();var V=r.selectAll("circle").data(S,function(t){return t.name});V.enter().append("circle").attr("cx",function(t){return a(t.value)-p/2-l}).attr("cy",function(){return i(f+1)+p+u}).attr("r",p/2).style("z-index","99").style("fill","transparent").style("fill",function(t){return"url(#"+y(t)+")"}).transition().duration(s).ease(e.easeLinear).attr("cy",function(t){return i(t.rank)+u}),V.transition().duration(s).ease(e.easeLinear).attr("cx",function(t){return a(t.value)-p/2-l}).attr("cy",function(t){return i(t.rank)+u}),V.exit().transition().duration(s).ease(e.easeLinear).attr("cx",function(t){return a(t.value)-p/2-l}).attr("cy",function(){return i(f+1)+p+u}).remove()}g.html(L(v,b)),k.html(L(x,b)),D.html(L(m,b)),C.html(L(w,b,!0)).call(O),T()}}function T(){var t=h.getState().options.showOverlays;h.getState().ticker.isRunning?(b("pause"),S("play")):(b("play"),S("pause")),!h.getState().ticker.isFirstDate||"all"!==t&&"play"!==t||h.getState().ticker.isRunning?!h.getState().ticker.isLastDate||"all"!==t&&"repeat"!==t||h.getState().options.loop&&h.getState().ticker.isRunning?(w("controls").style.visibility="unset",w("overlay").style.display="none"):(w("controls").style.visibility="hidden",b("overlay"),b("overlayRepeat"),S("overlayPlay")):(w("controls").style.visibility="hidden",b("overlay"),b("overlayPlay"),S("overlayRepeat"))}function O(t){r.selectAll(".halo").remove(),t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).classed("halo",!0)}return{renderInitalView:B,renderFrame:E,resize:function(){if(!h.getState().options.inputHeight&&!h.getState().options.inputWidth||String(h.getState().options.inputHeight).startsWith("window")||String(h.getState().options.inputWidth).startsWith("window")){var t=document.querySelector(h.getState().options.selector);M=x(t,h.getState().options.minHeight,h.getState().options.inputHeight),R=m(t,h.getState().options.minWidth,h.getState().options.inputWidth);var e=t.style.position;B(),E(),T(),t.style.position=e}}}}(a);return s.renderInitalView(),h.subscribe(s.renderFrame),h.subscribe(function(t){var e="";return function(){var n=h.getState().ticker.currentDate;n!==e&&(function(t,e){t.dispatchEvent(new CustomEvent("racingBars/dateChanged",{bubbles:!0,detail:{date:F(e),isFirst:h.getState().ticker.isFirstDate,isLast:h.getState().ticker.isLastDate}}))}(t,n),e=n)}}(r)),o.start(),h.getState().options.autorun||o.stop(),E(r,o),window.addEventListener("resize",function(){s.resize(),E(r,o)}),{start:function(){h.getState().ticker.isRunning||o.start()},stop:function(){o.stop()},rewind:function(){o.skipBack()},fastforward:function(){o.skipForward()},loop:function(){o.loop()},inc:function(t){void 0===t&&(t=1),h.dispatch(f.ticker.inc(t))},dec:function(t){void 0===t&&(t=1),h.dispatch(f.ticker.dec(t))},getDate:function(){return h.getState().ticker.currentDate},setDate:function(t){h.dispatch(f.ticker.updateDate(A(t)))},getAllDates:function(){return i.map(function(t){return F(t)})},createScroller:function(){!function(t){var e=h.getState().ticker.dates;!function(){t.style.position="fixed",t.style.top="0";var e=document.createElement("div");e.style.height=10*window.innerHeight+"px",document.body.appendChild(e)}();var n=document.body.clientHeight/e.length;window.addEventListener("scroll",function(){var t=Math.ceil(window.pageYOffset/n);h.dispatch(t<e.length?f.ticker.updateDate(e[t]):f.ticker.setLast())})}(r)}}}});
//# sourceMappingURL=racing-bars.umd.js.map
