!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t=t||self).racingBars={},t.d3)}(this,function(t,e){var n={__proto__:null,axisTop:e.axisTop,csv:e.csv,easeLinear:e.easeLinear,format:e.format,hsl:e.hsl,interpolateRound:e.interpolateRound,interval:e.interval,json:e.json,max:e.max,scaleLinear:e.scaleLinear,select:e.select,selectAll:e.selectAll,tsv:e.tsv,xml:e.xml};function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t}).apply(this,arguments)}var r={optionsLoaded:"options/loaded",changeOptions:"options/change",optionsChanged:"options/changed"},i={selector:"#race",dataShape:"long",fillDateGaps:!1,fillDateGapsValue:"last",startDate:"",endDate:"",colorSeed:"",disableGroupColors:!1,tickDuration:500,topN:10,disableClickEvents:!0,disableKeyboardEvents:!1,autorun:!0,loop:!1,injectStyles:!0,title:"18 years of Top Global Brands",subTitle:"Brand value, $m",caption:"Source: Interbrand",dateCounter:"MM/YYYY",labelsOnBars:!0,labelsWidth:100,showControls:"all",showOverlays:"all",inputHeight:"",inputWidth:"",minHeight:300,minWidth:500,height:"",width:""};function o(t,e){switch(void 0===t&&(t=i),e.type){case r.optionsLoaded:var n=e.payload.startDate?S(e.payload.startDate):"",o=e.payload.endDate?S(e.payload.endDate):"",s=e.payload.height,l=e.payload.width;return a(a(a({},t),e.payload),{},{startDate:n,endDate:o,inputHeight:s,inputWidth:l});case r.changeOptions:return a(a({},t),e.payload);default:return t}}var s={initialize:"ticker/initialize",updateDate:"ticker/updateDate",setRunning:"ticker/setRunning",setFirst:"ticker/setFirst",setLast:"ticker/setLast",inc:"ticker/inc",dec:"ticker/dec"},l={isRunning:!1,currentDate:"",isFirstDate:!0,isLastDate:!1,dates:[]};function c(t,e){switch(void 0===t&&(t=l),e.type){case s.initialize:var n=e.payload;return a(a({},t),{},{isRunning:!1,currentDate:n[0],isFirstDate:!0,isLastDate:!1,dates:n});case s.updateDate:var r=e.payload;return-1===t.dates.indexOf(r)?a({},t):a(a({},t),{},{currentDate:r,isFirstDate:r===t.dates[0],isLastDate:r===t.dates[t.dates.length-1]});case s.setRunning:return a(a({},t),{},{isRunning:e.payload});case s.setFirst:return a(a({},t),{},{currentDate:t.dates[0],isFirstDate:!0,isLastDate:!1});case s.setLast:return a(a({},t),{},{currentDate:t.dates[t.dates.length-1],isFirstDate:!1,isLastDate:!0});case s.inc:var i=t.dates.indexOf(t.currentDate),o=t.dates.length-1,c=e.payload,u=i+c>o?t.dates[o]:t.dates[i+c];return a(a({},t),{},{currentDate:u,isFirstDate:u===t.dates[0],isLastDate:u===t.dates[o]});case s.dec:var d=t.dates.indexOf(t.currentDate),p=e.payload,f=d-p<0?t.dates[0]:t.dates[d-p];return a(a({},t),{},{currentDate:f,isFirstDate:f===t.dates[0],isLastDate:f===t.dates[t.dates.length-1]});default:return t}}function u(t){var n;function a(){n=e.interval(function(t){f.getState().ticker.isLastDate?f.getState().options.loop?o():r():f.dispatch(d.ticker.inc())},f.getState().options.tickDuration),f.dispatch(d.ticker.setRunning(!0))}function r(){n&&n.stop(),f.dispatch(d.ticker.setRunning(!1))}function i(){r(),f.dispatch(d.ticker.setFirst())}function o(){f.dispatch(d.ticker.setFirst())}return f.dispatch(d.ticker.initialize(t)),{start:a,stop:r,skipBack:i,loop:o,skipForward:function(){r(),f.dispatch(d.ticker.setLast())},toggle:function(){f.getState().ticker.isLastDate?(i(),a()):f.getState().ticker.isRunning?r():(f.getState().ticker.isFirstDate||f.dispatch(d.ticker.inc()),a())},goToDate:function(t){f.dispatch(d.ticker.updateDate(t))}}}var d={options:{__proto__:null,actionTypes:r,optionsLoaded:function(t){return{type:r.optionsLoaded,payload:t}},changeOptions:function(t){return{type:r.changeOptions,payload:t}},optionsChanged:function(t){return{type:r.optionsChanged,payload:t}},optionsReducer:o},ticker:{__proto__:null,actionTypes:s,initialize:function(t){return{type:s.initialize,payload:t}},updateDate:function(t){return{type:s.updateDate,payload:t}},setRunning:function(t){return{type:s.setRunning,payload:t}},setFirst:function(){return{type:s.setFirst}},setLast:function(){return{type:s.setLast}},inc:function(t){return void 0===t&&(t=1),{type:s.inc,payload:t}},dec:function(t){return void 0===t&&(t=1),{type:s.dec,payload:t}},tickerReducer:c,createTicker:u}};function p(t,e){return{options:o(t.options,e),ticker:c(t.ticker,e)}}var f=function(t,e){void 0===t&&(t=p);var n={},a=[];return{getState:function(){return n},dispatch:function(e){return n=t(n,e),a.forEach(function(t){t()}),e},subscribe:function(t){a.push(t);var e=a.length-1;return{unsubscribe:function(){a.splice(e,1)}}}}}(p);function g(t,e){for(;t.toString().length<e;)t="0"+t;return t}function h(t,e,n){var a;if(n)if(String(n).startsWith("window")){var r=+n.split("*")[1]||1;a=window.innerHeight*r}else a=+n;else a=t.getBoundingClientRect().height;return a>e?a:e}function v(t,e,n){var a;if(n)if(String(n).startsWith("window")){var r=+n.split("*")[1]||1;a=window.innerWidth*r}else a=+n;else a=t.getBoundingClientRect().width;return a>e?a:e}function y(t){return document.querySelector(f.getState().options.selector).querySelector("."+t)}function k(t){var e=f.getState().options.selector,n=document.querySelector(e+" ."+t);n&&(n.style.display="flex")}function m(t){var e=f.getState().options.selector,n=document.querySelector(e+" ."+t);n&&(n.style.display="none")}function w(t,e,n){var a=y(t);a&&a.addEventListener(e,n)}function x(t,e,n){return void 0===n&&(n=!1),"function"==typeof t?t(D(f.getState().ticker.currentDate),e.map(function(t){return a(a({},t),{},{date:D(t.date)})}),f.getState().ticker.dates.map(function(t){return D(t)})):n?D(f.getState().ticker.currentDate,t):t}var b=function(t){return Array.from(new Set(t.map(function(t){return t.date}))).sort()};function S(t){var e=new Date(t);if(isNaN(+e))throw new Error('"'+t+'" is not a valid date');var n=e.getFullYear(),a=(1+e.getMonth()).toString();return""+n+(a=g(a,2))+g(e.getDate().toString(),2)}function D(t,e){void 0===e&&(e="YYYY-MM-DD");var n=t.slice(0,4),a=t.slice(4,6),r=t.slice(6,8),i=new Date(n+"-"+a+"-"+r),o=String(i.getDay());return e.replace("MMM",{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[a]).replace("DDD",{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}[o]).replace("YYYY",n).replace("MM",a).replace("DD",r)}function L(t,e){return t.filter(function(t){return t.date===e&&!isNaN(t.value)}).sort(function(t,e){return e.value-t.value}).map(function(t,e){return a(a({},t),{},{rank:e})})}function C(t,e){w("skipBack","click",e.skipBack),w("play","click",e.toggle),w("pause","click",e.toggle),w("skipForward","click",e.skipForward),w("overlayPlay","click",function(){m("overlay"),e.start()}),w("overlayRepeat","click",function(){m("overlay"),e.loop(),e.start()}),f.getState().options.disableClickEvents||(t.querySelector("svg").addEventListener("click",e.toggle),t.addEventListener("dblclick",e.skipForward)),f.getState().options.disableKeyboardEvents||document.addEventListener("keypress",function(t){switch(t.keyCode){case 32:e.toggle();break;case 97:e.skipBack();break;case 115:e.toggle();break;case 100:e.skipForward()}})}t.d3=n,t.generateId=function(t,e){return void 0===t&&(t="racingbars"),void 0===e&&(e=8),function(t,e){return t+Array(3).fill(null).map(function(){return Math.random().toString(36).substr(2)}).join("").slice(-e)}(t,e)},t.loadData=function(t,n){switch(void 0===n&&(n="json"),n){case"json":return e.json(t);case"csv":return e.csv(t);case"tsv":return e.tsv(t);case"xml":return e.xml(t);default:throw new Error("Unsupported data type: "+n)}},t.race=function(t,n){f.dispatch(d.options.optionsLoaded(n));var r=document.querySelector(f.getState().options.selector);if(!r)throw new Error("Cannot find element with this selector: "+f.getState().options.selector);f.getState().options.injectStyles&&function(t,e,n){if(void 0===e&&(e="top"),void 0===n&&(n="\n#selector text {\n  font-size: 16px;\n  font-family: Open Sans, sans-serif;\n}\n\n#selector text.title {\n  font-size: 24px;\n  font-weight: 500;\n}\n\n#selector text.subTitle {\n  font-weight: 500;\n  fill: #777777;\n}\n\n#selector text.caption {\n  font-weight: 400;\n  font-size: 24px;\n  fill: #777777;\n}\n\n#selector text.label {\n  font-weight: 600;\n}\n\n#selector text.valueLabel {\n  font-weight: 300;\n}\n\n#selector text.dateCounterText {\n  font-size: 64px;\n  font-weight: 700;\n  opacity: 0.25;\n}\n\n#selector .tick text {\n  fill: #777777;\n}\n\n#selector .xAxis .tick:nth-child(2) text {\n  text-anchor: start;\n}\n\n#selector .tick line {\n  shape-rendering: CrispEdges;\n  stroke: #dddddd;\n}\n\n#selector .tick line.origin {\n  stroke: #aaaaaa;\n}\n\n#selector path.domain {\n  display: none;\n}\n\n#selector {\n  position: relative;\n}\n\n#selector .controls {\n  /*  width and right are set dynamically in renderer.ts */\n  position: absolute;\n  top: 0;\n  display: flex;\n}\n\n#selector .controls div,\n#selector .overlay div {\n  cursor: pointer;\n  font-size: 24px;\n  font-weight: 700;\n  width: 38px;\n  height: 38px;\n  color: #ffffff;\n  background: #777777;\n  border: 1px solid black;\n  opacity: 0.5;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  margin: 5px;\n  text-align: center;\n}\n\n#selector .controls div:hover,\n#selector .overlay div:hover {\n  background: #aaaaaa;\n  color: black;\n}\n\n#selector .controls svg {\n  margin: 5px auto;\n  width: 28px;\n  height: 28px;\n}\n\n#selector .overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: black;\n  opacity: 0.7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n#selector .overlay div {\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 200px;\n  height: 200px;\n  -moz-border-radius: 100px;\n  -webkit-border-radius: 100px;\n  border-radius: 100px;\n}\n#selector .overlay svg {\n  height: 50%;\n  width: 50%;\n}\n"),n&&"undefined"!=typeof document){n=n.split("#selector").join(t);var a=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===e&&a.firstChild?a.insertBefore(r,a.firstChild):a.appendChild(r),r.styleSheet?r.styleSheet.cssText=n:r.appendChild(document.createTextNode(n))}}(f.getState().options.selector,"top"),t=function(t){var n,r=f.getState().options;return t=t.map(function(t){return a(a({},t),{},{date:S(t.date)})}).filter(function(t){return!r.startDate||t.date>=r.startDate}).filter(function(t){return!r.endDate||t.date<=r.endDate}),"wide"===r.dataShape&&(n=[],t.forEach(function(t){for(var e=0,a=Object.entries(t);e<a.length;e++){var r=a[e];n.push({date:t.date,name:r[0],value:Number(r[1])})}}),t=n),r.fillDateGaps&&(t=function(t,e){if(!e)return t;var n=b(t),r=new Date(D(n[0])),i=new Date(D(n[n.length-1])),o={years:function(t){t.setFullYear(t.getFullYear()+1)},months:function(t){t.setMonth(t.getMonth()+1)},days:function(t){t.setDate(t.getDate()+1)}};if(!o[e])return t;for(var s=[],l=r;l<i;o[e](l))s.push(S(l));return s.forEach(function(e,n){if(!(t.filter(function(t){return t.date===e}).length>0)){var r=t.filter(function(t){return t.date===s[n-1]}).map(function(t){return a(a({},t),{},{date:e})});t.push.apply(t,r)}}),t}(t,r.fillDateGaps)),function(t){return t.sort(function(t,e){return t.name.localeCompare(e.name)||t.date.localeCompare(e.date)}).reduce(function(t,e){if(0===t.length)e.lastValue=e.value;else{var n=t[t.length-1];e.lastValue=e.name===n.name?n.value:e.value}return[].concat(t,[e])},[]).sort(function(t,e){return t.date.localeCompare(e.date)})}(t=t.map(function(t){var n=isNaN(+t.value)?0:+t.value,i=function(t,n,a){return e.hsl(360*(r=function(t){for(var e="",n=0;n<t.length;n++)e+=g(String(t.charCodeAt(n)),3);return e}((t.group&&!n?t.group:t.name)+a),(i=1e4*Math.sin(+r))-Math.floor(i)),.75,.75);var r,i}(t,r.disableGroupColors,r.colorSeed);return a(a({},t),{},{value:n,color:i})}))}(t);var i=b(t),o=u(i),s=function(t){var n,a,r,i,o,s,l,c,u,d,p,g,w;function b(){var y,k,b,S=f.getState().options,C=S.selector,A=S.title,F=S.subTitle,M=S.caption,R=S.dateCounter,B=S.labelsOnBars,j=S.labelsWidth,E=S.inputHeight,O=S.inputWidth,T=S.minHeight,V=S.minWidth,H=S.topN,W=L(t,f.getState().ticker.currentDate),z=W.slice(0,f.getState().options.topN),N=document.querySelector(C);N.innerHTML="",g=h(N,T,E),w=v(N,V,O),s=(g-((n={top:80,right:0,bottom:5,left:0+(B?0:j)}).bottom+n.top))/(5*H),a=e.select(C).append("svg").attr("width",w).attr("height",g),l=a.append("text").attr("class","title").attr("y",24).html(x(A,W)),c=a.append("text").attr("class","subTitle").attr("y",55).html(x(F,W)),r=e.scaleLinear().domain([0,e.max(z,function(t){return t.value})]).range([n.left,w-n.right-65]),i=e.scaleLinear().domain([H,0]).range([g-n.bottom,n.top]),o=e.axisTop(r).ticks(w>500?5:2).tickSize(-(g-n.top-n.bottom)).tickFormat(function(t){return e.format(",")(t)}),a.append("g").attr("class","axis xAxis").attr("transform","translate(0, "+n.top+")").call(o).selectAll(".tick line").classed("origin",function(t){return 0===t}),a.selectAll("rect.bar").data(z,function(t){return t.name}).enter().append("rect").attr("class","bar").attr("x",r(0)+1).attr("width",function(t){return Math.abs(r(t.value)-r(0)-1)}).attr("y",function(t){return i(t.rank)+5}).attr("height",i(1)-i(0)-s).style("fill",function(t){return t.color}),p=B?function(t){return r(t.value)-8}:n.left-8,a.selectAll("text.label").data(z,function(t){return t.name}).enter().append("text").attr("class","label").attr("x",p).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}).style("text-anchor","end").html(function(t){return t.name}),a.selectAll("text.valueLabel").data(z,function(t){return t.name}).enter().append("text").attr("class","valueLabel").attr("x",function(t){return r(t.value)+5}).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}).text(function(t){return e.format(",.0f")(t.lastValue)}),d=a.append("text").attr("class","dateCounterText").attr("x",w-n.right-s).attr("y",g-40).style("text-anchor","end").html(x(R,W,!0)).call(function(t,e){t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("fill","#ffffff").style("stroke","#ffffff").style("stroke-width",e).style("stroke-linejoin","round").style("opacity",1)},10),u=a.append("text").attr("class","caption").attr("x",w-n.right-s-10).attr("y",g-n.bottom-s).style("text-anchor","end").html(x(M,W)),k=[{skipBack:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M28.46,4a3,3,0,0,0-3,.07l-15.2,9.41A3,3,0,0,0,9,15V5A3,3,0,0,0,6,2H5A3,3,0,0,0,2,5V27a3,3,0,0,0,3,3H6a3,3,0,0,0,3-3V17a3,3,0,0,0,1.22,1.53L25.42,28a3,3,0,0,0,1.58.46,3,3,0,0,0,3-3V6.59A3,3,0,0,0,28.46,4Z"/></g></svg>'},{play:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{pause:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns:svg="http://www.w3.org/2000/svg"><g transform="translate(-17)"><path d="m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z" /></g><g transform="translate(-4)"><path d="m 27,2 h -1 c -1.656854,0 -3,1.3431458 -3,3 v 12 c -0.04755,3.269656 0,6.666667 0,10 0,1.656854 1.343146,3 3,3 h 1 c 1.656854,0 3,-1.343146 3,-3 V 5 C 30,3.3431458 28.656854,2 27,2 Z" /></g></svg>'},{skipForward:'<svg viewBox="0 0 32 32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M27,2H26a3,3,0,0,0-3,3V15a3,3,0,0,0-1.22-1.53L6.58,4A3,3,0,0,0,2,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,6.58,28l15.2-9.41A3,3,0,0,0,23,17V27a3,3,0,0,0,3,3h1a3,3,0,0,0,3-3V5A3,3,0,0,0,27,2Z"/></g></svg>'}],b=N.getBoundingClientRect().width,e.select(C).append("div").classed("controls",!0).style("width",w).style("right",b-w+n.right+s+"px").selectAll("div").data(k).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}),"play"===f.getState().options.showControls&&(m("skipBack"),m("skipForward")),"none"===f.getState().options.showControls&&m("controls"),y=[{overlayPlay:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M26.78,13.45,11.58,4A3,3,0,0,0,7,6.59V25.41a3,3,0,0,0,3,3A3,3,0,0,0,11.58,28l15.2-9.41a3,3,0,0,0,0-5.1Z"/></g></svg>'},{overlayRepeat:'<svg viewBox="0 0 32 32" fill="currentColor" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><g><path d="M18,4A12,12,0,0,0,6.05,15H3a1,1,0,0,0-.88.53,1,1,0,0,0,0,1l4,6a1,1,0,0,0,1.66,0l4-6a1,1,0,0,0,.05-1A1,1,0,0,0,11,15H8.05A10,10,0,1,1,18,26a1,1,0,0,0,0,2A12,12,0,0,0,18,4Z"/></g></svg>'}],e.select(C).append("div").classed("overlay",!0).style("minHeight",T+"px").style("minWidth",V+"px").selectAll("div").data(y).enter().append("div").html(function(t){return Object.values(t)[0]}).attr("class",function(t){return Object.keys(t)[0]}),D()}function S(){if(r){var n=f.getState().options,g=n.tickDuration,h=n.topN,v=n.title,y=n.subTitle,k=n.caption,m=n.dateCounter,w=L(t,f.getState().ticker.currentDate),b=w.slice(0,f.getState().options.topN);r.domain([0,e.max(b,function(t){return t.value})]),a.select(".xAxis").transition().duration(g).ease(e.easeLinear).call(o);var S=a.selectAll(".bar").data(b,function(t){return t.name});S.enter().append("rect").attr("class",function(t){return"bar "+t.name.replace(/\s/g,"_")}).attr("x",r(0)+1).attr("width",function(t){return Math.abs(r(t.value)-r(0)-1)}).attr("y",function(){return i(h+1)+5}).attr("height",i(1)-i(0)-s).style("fill",function(t){return t.color}).transition().duration(g).ease(e.easeLinear).attr("y",function(t){return i(t.rank)+5}),S.transition().duration(g).ease(e.easeLinear).attr("width",function(t){return Math.abs(r(t.value)-r(0)-1)}).attr("y",function(t){return i(t.rank)+5}),S.exit().transition().duration(g).ease(e.easeLinear).attr("width",function(t){return Math.abs(r(t.value)-r(0)-1)}).attr("y",function(){return i(h+1)+5}).remove();var C=a.selectAll(".label").data(b,function(t){return t.name});C.enter().append("text").attr("class","label").attr("x",p).attr("y",function(){return i(h+1)+5+(i(1)-i(0))/2}).style("text-anchor","end").html(function(t){return t.name}).transition().duration(g).ease(e.easeLinear).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}),C.transition().duration(g).ease(e.easeLinear).attr("x",p).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}),C.exit().transition().duration(g).ease(e.easeLinear).attr("x",p).attr("y",function(){return i(h+1)+5}).remove();var A=a.selectAll(".valueLabel").data(b,function(t){return t.name});A.enter().append("text").attr("class","valueLabel").attr("x",function(t){return r(t.value)+5}).attr("y",function(){return i(h+1)+5}).text(function(t){return e.format(",.0f")(t.lastValue)}).transition().duration(g).ease(e.easeLinear).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}),A.transition().duration(g).ease(e.easeLinear).attr("x",function(t){return r(t.value)+5}).attr("y",function(t){return i(t.rank)+5+(i(1)-i(0))/2+1}).tween("text",function(t){var n=e.interpolateRound(t.lastValue,t.value);return function(t){this.textContent=e.format(",")(n(t))}}),A.exit().transition().duration(g).ease(e.easeLinear).attr("x",function(t){return r(t.value)+5}).attr("y",function(){return i(h+1)+5}).remove(),l.html(x(v,w)),c.html(x(y,w)),u.html(x(k,w)),d.html(x(m,w,!0)),D()}}function D(){var t=f.getState().options.showOverlays;f.getState().ticker.isRunning?(k("pause"),m("play")):(k("play"),m("pause")),!f.getState().ticker.isFirstDate||"all"!==t&&"play"!==t||f.getState().ticker.isRunning?!f.getState().ticker.isLastDate||"all"!==t&&"repeat"!==t||f.getState().options.loop&&f.getState().ticker.isRunning?(y("controls").style.visibility="unset",y("overlay").style.display="none"):(y("controls").style.visibility="hidden",k("overlay"),k("overlayRepeat"),m("overlayPlay")):(y("controls").style.visibility="hidden",k("overlay"),k("overlayPlay"),m("overlayRepeat"))}return{renderInitalView:b,renderFrame:S,resize:function(){if(!f.getState().options.inputHeight&&!f.getState().options.inputWidth||String(f.getState().options.inputHeight).startsWith("window")||String(f.getState().options.inputWidth).startsWith("window")){var t=document.querySelector(f.getState().options.selector);g=h(t,f.getState().options.minHeight,f.getState().options.inputHeight),w=v(t,f.getState().options.minWidth,f.getState().options.inputWidth);var e=t.style.position;b(),S(),D(),t.style.position=e}}}}(t);return s.renderInitalView(),f.subscribe(s.renderFrame),f.subscribe(function(t){var e="";return function(){var n=f.getState().ticker.currentDate;n!==e&&(function(t,e){t.dispatchEvent(new CustomEvent("racingBars/dateChanged",{bubbles:!0,detail:{date:D(e),isFirst:f.getState().ticker.isFirstDate,isLast:f.getState().ticker.isLastDate}}))}(t,n),e=n)}}(r)),o.start(),f.getState().options.autorun||o.stop(),C(r,o),window.addEventListener("resize",function(){s.resize(),C(r,o)}),{start:function(){f.getState().ticker.isRunning||o.start()},stop:function(){o.stop()},rewind:function(){o.skipBack()},fastforward:function(){o.skipForward()},loop:function(){o.loop()},inc:function(t){void 0===t&&(t=1),f.dispatch(d.ticker.inc(t))},dec:function(t){void 0===t&&(t=1),f.dispatch(d.ticker.dec(t))},getDate:function(){return f.getState().ticker.currentDate},setDate:function(t){f.dispatch(d.ticker.updateDate(S(t)))},getAllDates:function(){return i.map(function(t){return D(t)})},createScroller:function(){!function(t){var e=f.getState().ticker.dates;!function(){t.style.position="fixed",t.style.top="0";var e=document.createElement("div");e.style.height=10*window.innerHeight+"px",document.body.appendChild(e)}();var n=document.body.clientHeight/e.length;window.addEventListener("scroll",function(){var t=Math.ceil(window.pageYOffset/n);f.dispatch(t<e.length?d.ticker.updateDate(e[t]):d.ticker.setLast())})}(r)}}}});
//# sourceMappingURL=racing-bars.umd.js.map
