!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t=t||self).racingBars={},t.d3)}(this,function(t,e){function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function r(t,e){for(;t.toString().length<e;)t="0"+t;return t}function a(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerHeight*a}else r=+n;else r=t.getBoundingClientRect().height;return r>e?r:e}function i(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerWidth*a}else r=+n;else r=t.getBoundingClientRect().width;return r>e?r:e}function o(t){var e=new Set;return t.forEach(function(t){e.add(t.date)}),Array.from(e).sort()}function s(t){var e=new Date(t);if(isNaN(+e))throw new Error('"'+t+'" is not a valid date');var n=e.getFullYear(),a=(1+e.getMonth()).toString();return""+n+(a=r(a,2))+r(e.getDate().toString(),2)}function u(t,e){var n=t.slice(0,4),r=t.slice(4,6),a=t.slice(6,8),i=new Date(n+"-"+r+"-"+a).getDay();return e.replace("MMM",{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[r]).replace("DDD",{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}[i]).replace("YYYY",n).replace("MM",r).replace("DD",a)}t.loadData=function(t,e){switch(void 0===e&&(e="json"),e){case"json":return d3.json(t);case"csv":return d3.csv(t);case"tsv":return d3.tsv(t);case"xml":return d3.xml(t);default:throw new Error("Unsupported data type: "+e)}},t.race=function(t,l){void 0===l&&(l={});var c,d,f,h,p,v,g,y,w,m,k,x=function(){var t,n,r,a,i,o,s;function u(){f(!0),t=e.interval(function(t){n.isLast()?(s(),i?d():l()):n.inc()},a)}function l(){t.stop(),f(!1)}function c(){l(),n.setFirst(),s()}function d(){n.setFirst(),s()}function f(t){void 0===t&&(t=!0);var e=document.querySelector(o+" .play"),n=document.querySelector(o+" .pause");t?(r=!0,e.style.display="none",n.style.display="unset"):(r=!1,e.style.display="unset",n.style.display="none")}return{tickerDateFactory:function(t,e,u,l,c,d){a=e,i=u,o=l,s=d;var h,p=0,v=t.length-1,g=t[v];function y(){c(h=t[p])}return n={inc:function(t){void 0===t&&(t=1);var e=p+t;p=e>v?v:e,y()},dec:function(t){void 0===t&&(t=1);var e=p-t;p=e<0?0:e,y()},setFirst:function(){p=0,y()},setLast:function(){p=t.length-1,y()},update:function(){y()},set:function(e){var n=t.indexOf(e);n>-1&&(p=n,y())},getDate:function(){return h},isLast:function(){return h===g},getDates:function(){return[].concat(t)},isRunning:function(){return r},setRunning:function(t){return f(t)}}},startTicker:u,stopTicker:l,rewindTicker:c,loopTicker:d,fastForwardTicker:function(){l(),n.setLast(),s()},toggle:function(){n.isLast()?(c(),u()):r?l():u()},setRunning:f}}(),b=x.tickerDateFactory,D=x.startTicker,L=x.stopTicker,M=x.rewindTicker,Y=x.loopTicker,T=x.fastForwardTicker,C=x.toggle,E=l.dataShape||"long",S=l.fillDateGaps,F=l.selector||"#race",N=l.startDate?s(l.startDate):"",W=l.endDate?s(l.endDate):"",A=l.loop||!1,B=l.colorSeed||"",j=l.disableGroupColors||!1,H=Number(l.tickDuration)||500,O=Number(l.topN)||10,R=l.disableClickEvents||!0,q=l.disableKeyboardEvents,V=!1!==l.autorun,G={title:l.title||"18 years of Top Global Brands",subTitle:l.subTitle||"Brand value, $m",caption:l.caption||"Source: Interbrand",dateCounterFormat:l.dateCounterFormat||"YYYY",labelsOnBars:!1!==l.labelsOnBars,labelsWidth:l.labelsWidth||100,showControls:l.showControls||"all",inputHeight:l.height,inputWidth:l.width,minHeight:300,minWidth:500,tickDuration:H,topN:O},J=document.querySelector(F);t=function(t,e,a,i){var o;return"wide"===e&&(o=[],t.forEach(function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e];o.push({date:t.date,name:r[0],value:Number(r[1])})}}),t=o),t.map(function(t){var e=n({},t);return e.value=isNaN(+e.value)?0:+e.value,e.date=s(e.date),e.color=function(t,e,n){return d3.hsl(360*(a=function(t){for(var e="",n=0;n<t.length;n++)e+=r(String(t.charCodeAt(n)),3);return e}((t.group&&!e?t.group:t.name)+n),(i=1e4*Math.sin(+a))-Math.floor(i)),.75,.75);var a,i}(e,a,i),e})}(t=function(t,e,n){return t.filter(function(t){return!e||t.date>=e}).filter(function(t){return!n||t.date<=n})}(t,N,W),E,j,B),S&&(t=function(t,e,r){var a=new Date(u(e[0],"YYYY-MM-DD")),i=new Date(u(e[e.length-1],"YYYY-MM-DD")),o={years:function(t){t.setFullYear(t.getFullYear()+1)},months:function(t){t.setMonth(t.getMonth()+1)},days:function(t){t.setDate(t.getDate()+1)}};if(!o[r])return t;for(var l=[],c=a;c<i;o[r](c))l.push(s(c));return l.forEach(function(e,r){if(!(t.filter(function(t){return t.date===e}).length>0)){var a=t.filter(function(t){return t.date===l[r-1]}).map(function(t){return n(n({},t),{},{date:e})});t.push.apply(t,a)}}),t}(t,o(t),S));var z,I=b(o(t),H,A,F,function(e){z=function(t,e,r,a){var i=t.filter(function(t){return t.date===e&&!isNaN(t.value)}).map(function(t){if(!r)return t;var e=r[t.name].value;return r[t.name].date=t.date,r[t.name].value=t.value,n(n({},t),{},{lastValue:e})}).sort(function(t,e){return e.value-t.value}).slice(0,a);return i.forEach(function(t,e){return t.rank=e}),i}(t,I.getDate(),k,O),P(),J.dispatchEvent(new CustomEvent("dateChanged",{detail:{date:u(e,"YYYY-MM-DD")}}))},P);function K(){!function(t,n,r,o,s,l){var k=r.inputHeight,x=r.inputWidth,b=r.minHeight,D=r.minWidth,L=r.labelsOnBars,M=r.labelsWidth,Y=r.topN,T=r.title,C=r.subTitle,E=r.caption,S=r.dateCounterFormat,F=r.showControls,N=document.querySelector(t);w=a(N,b,k),m=i(N,D,x),d=e.select(t).append("svg").attr("width",m).attr("height",w),v=(w-((c={top:80,right:0,bottom:5,left:0+(L?0:M)}).bottom+c.top))/(5*Y),d.append("text").attr("class","title").attr("y",24).html(T),d.append("text").attr("class","subTitle").attr("y",55).html(C),f=e.scaleLinear().domain([0,e.max(n,function(t){return t.value})]).range([c.left,m-c.right-65]),h=e.scaleLinear().domain([Y,0]).range([w-c.bottom,c.top]),p=e.axisTop(f).ticks(m>500?5:2).tickSize(-(w-c.top-c.bottom)).tickFormat(function(t){return e.format(",")(t)}),d.append("g").attr("class","axis xAxis").attr("transform","translate(0, "+c.top+")").call(p).selectAll(".tick line").classed("origin",function(t){return 0===t}),d.selectAll("rect.bar").data(n,function(t){return t.name}).enter().append("rect").attr("class","bar").attr("x",f(0)+1).attr("width",function(t){return Math.abs(f(t.value)-f(0)-1)}).attr("y",function(t){return h(t.rank)+5}).attr("height",h(1)-h(0)-v).style("fill",function(t){return t.color}),y=L?function(t){return f(t.value)-8}:c.left-8,d.selectAll("text.label").data(n,function(t){return t.name}).enter().append("text").attr("class","label").attr("x",y).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}).style("text-anchor","end").html(function(t){return t.name}),d.selectAll("text.valueLabel").data(n,function(t){return t.name}).enter().append("text").attr("class","valueLabel").attr("x",function(t){return f(t.value)+5}).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}).text(function(t){return e.format(",.0f")(t.lastValue)}),g=d.append("text").attr("class","dateCounterText").attr("x",m-c.right-v).attr("y",w-40).style("text-anchor","end").html(u(o(),S)).call(function(t,e){t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("fill","#ffffff").style("stroke","#ffffff").style("stroke-width",e).style("stroke-linejoin","round").style("opacity",1)},10),d.append("text").attr("class","caption").attr("x",m-c.right-v-10).attr("y",w-c.bottom-v).style("text-anchor","end").html(E),function(t,e,n){t.style.position="relative";var r=o("div","controls","",t);r.style.position="absolute",r.style.top="0",r.style.right=c.right+v+"px";var a=o("div","rewind",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-skip-back"><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></svg>',r);a.addEventListener("click",n.rewindTicker),o("div","play",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>',r).addEventListener("click",n.toggle),o("div","pause",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pause"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',r).addEventListener("click",n.toggle);var i=o("div","fastforward",'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-skip-forward"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>',r);switch(i.addEventListener("click",n.fastForwardTicker),e){case"play":a.style.visibility="hidden",i.style.visibility="hidden";break;case"none":r.style.display="none"}function o(t,e,n,r){var a=document.createElement(t);return a.classList.add(e),a.innerHTML=n,r.appendChild(a),a}}(N,F,s),l(!1)}(F,z,G,I.getDate,{rewindTicker:M,toggle:C,fastForwardTicker:T},I.setRunning)}function P(){!function(t,n,r){if(f){var a=n.tickDuration,i=n.topN,o=n.dateCounterFormat;f.domain([0,e.max(t,function(t){return t.value})]),d.select(".xAxis").transition().duration(a).ease(e.easeLinear).call(p);var s=d.selectAll(".bar").data(t,function(t){return t.name});s.enter().append("rect").attr("class",function(t){return"bar "+t.name.replace(/\s/g,"_")}).attr("x",f(0)+1).attr("width",function(t){return Math.abs(f(t.value)-f(0)-1)}).attr("y",function(){return h(i+1)+5}).attr("height",h(1)-h(0)-v).style("fill",function(t){return t.color}).transition().duration(a).ease(e.easeLinear).attr("y",function(t){return h(t.rank)+5}),s.transition().duration(a).ease(e.easeLinear).attr("width",function(t){return Math.abs(f(t.value)-f(0)-1)}).attr("y",function(t){return h(t.rank)+5}),s.exit().transition().duration(a).ease(e.easeLinear).attr("width",function(t){return Math.abs(f(t.value)-f(0)-1)}).attr("y",function(){return h(i+1)+5}).remove();var l=d.selectAll(".label").data(t,function(t){return t.name});l.enter().append("text").attr("class","label").attr("x",y).attr("y",function(){return h(i+1)+5+(h(1)-h(0))/2}).style("text-anchor","end").html(function(t){return t.name}).transition().duration(a).ease(e.easeLinear).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}),l.transition().duration(a).ease(e.easeLinear).attr("x",y).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}),l.exit().transition().duration(a).ease(e.easeLinear).attr("x",y).attr("y",function(){return h(i+1)+5}).remove();var c=d.selectAll(".valueLabel").data(t,function(t){return t.name});c.enter().append("text").attr("class","valueLabel").attr("x",function(t){return f(t.value)+5}).attr("y",function(){return h(i+1)+5}).text(function(t){return e.format(",.0f")(t.lastValue)}).transition().duration(a).ease(e.easeLinear).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}),c.transition().duration(a).ease(e.easeLinear).attr("x",function(t){return f(t.value)+5}).attr("y",function(t){return h(t.rank)+5+(h(1)-h(0))/2+1}).tween("text",function(t){var n=e.interpolateRound(t.lastValue,t.value);return function(t){this.textContent=e.format(",")(n(t))}}),c.exit().transition().duration(a).ease(e.easeLinear).attr("x",function(t){return f(t.value)+5}).attr("y",function(){return h(i+1)+5}).remove(),g.html(u(r(),o))}}(z,G,I.getDate)}return k={},t.forEach(function(t){t.lastValue=t.value,(!k[t.name]||t.date<k[t.name].date)&&(k[t.name]={date:t.date,value:t.value})}),I.setFirst(),K(),P(),D(),V||L(),R||(J.querySelector("svg").addEventListener("click",C),J.addEventListener("dblclick",T)),q||document.addEventListener("keypress",function(t){switch(t.keyCode){case 32:C();break;case 97:M();break;case 115:C();break;case 100:T()}}),window.addEventListener("resize",function(){!function(t,e,n){if(!e.height&&!e.width||String(e.height).startsWith("window")||String(e.width).startsWith("window")){w=a(t,e.minHeight,e.height),m=i(t,e.minWidth,e.width);var r=t.style.position;n(),t.style.position=r}}(J,G,function(){var t=I.isRunning();L(),J.innerHTML="",I.update(),K(),t&&D()})}),{start:function(){I.isRunning()||D()},stop:function(){L()},rewind:function(){M()},fastforward:function(){T()},loop:function(){Y()},inc:function(t){void 0===t&&(t=1),I.inc(t)},dec:function(t){void 0===t&&(t=1),I.dec(t)},getCurrentDate:function(){return I.getDate()},getDates:function(){return I.getDates().map(function(t){return u(t,"YYYY-MM-DD")})},setDate:function(t){I.set(s(t))},createScroller:function(){!function(){!function(){J.style.position="fixed",J.style.top="0";var t=document.createElement("div");t.style.height=10*window.innerHeight+"px",document.body.appendChild(t)}();var t=I.getDates(),e=document.body.clientHeight/t.length;window.addEventListener("scroll",function(){var n=Math.ceil(window.pageYOffset/e);n<t.length?I.set(t[n]):I.setLast()})}()}}}});
//# sourceMappingURL=racing-bars.umd.js.map
