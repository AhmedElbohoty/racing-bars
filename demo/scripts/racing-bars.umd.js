!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3")):"function"==typeof define&&define.amd?define(["exports","d3"],e):e((t=t||self).racingBars={},t.d3)}(this,function(t,e){function n(){return(n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function r(t,e){for(;t.toString().length<e;)t="0"+t;return t}function a(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerHeight*a}else r=+n;else r=t.getBoundingClientRect().height;return r>e?r:e}function i(t,e,n){var r;if(n)if(String(n).startsWith("window")){var a=+n.split("*")[1]||1;r=window.innerWidth*a}else r=+n;else r=t.getBoundingClientRect().width;return r>e?r:e}function o(t){var e=new Date(t);if(isNaN(+e))throw new Error('"'+t+'" is not a valid date');var n=e.getFullYear(),a=(1+e.getMonth()).toString();return""+n+(a=r(a,2))+r(e.getDate().toString(),2)}function s(t,e){var n=t.slice(0,4),r=t.slice(4,6),a=t.slice(6,8),i=new Date(n+"-"+r+"-"+a),o=String(i.getDay());return e.replace("MMM",{"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"}[r]).replace("DDD",{0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"}[o]).replace("YYYY",n).replace("MM",r).replace("DD",a)}var l={skipBack:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-skip-back"><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></svg>',play:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-play"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>',pause:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-pause"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>',skipForward:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-skip-forward"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>'};t.d3={__proto__:null,axisTop:e.axisTop,csv:e.csv,easeLinear:e.easeLinear,format:e.format,hsl:e.hsl,interpolateRound:e.interpolateRound,interval:e.interval,json:e.json,max:e.max,scaleLinear:e.scaleLinear,select:e.select,selectAll:e.selectAll,tsv:e.tsv,xml:e.xml},t.generateId=function(t,e){return void 0===t&&(t="racingbars"),void 0===e&&(e=8),function(t,e){return t+Array(3).fill(null).map(function(){return Math.random().toString(36).substr(2)}).join("").slice(-e)}(t,e)},t.loadData=function(t,n){switch(void 0===n&&(n="json"),n){case"json":return e.json(t);case"csv":return e.csv(t);case"tsv":return e.tsv(t);case"xml":return e.xml(t);default:throw new Error("Unsupported data type: "+n)}},t.race=function(t,u){void 0===u&&(u={});var c=u.dataShape||"long",d=u.fillDateGaps,f=u.selector||"#race",p=u.startDate?o(u.startDate):"",h=u.endDate?o(u.endDate):"",g=u.colorSeed||"",v=u.disableGroupColors||!1,y=Number(u.tickDuration)||500,m=Number(u.topN)||10,w=!1!==u.disableClickEvents,x=u.disableKeyboardEvents,k=!1!==u.autorun,b=!1!==u.injectStyles,D={selector:f,title:u.title||"18 years of Top Global Brands",subTitle:u.subTitle||"Brand value, $m",caption:u.caption||"Source: Interbrand",dateCounterFormat:u.dateCounterFormat||"YYYY",labelsOnBars:!1!==u.labelsOnBars,labelsWidth:u.labelsWidth||100,showControls:u.showControls||"all",inputHeight:u.height,inputWidth:u.width,minHeight:300,minWidth:500,tickDuration:y,topN:m},L={loop:u.loop||!1,tickDuration:y},C=document.querySelector(f);if(!C)throw new Error("Cannot find element with this selector: "+f);b&&function(t,e,n){if(void 0===e&&(e="top"),void 0===n&&(n="\n#selector text {\n  font-size: 16px;\n  font-family: Open Sans, sans-serif;\n}\n\n#selector text.title {\n  font-size: 24px;\n  font-weight: 500;\n}\n\n#selector text.subTitle {\n  font-weight: 500;\n  fill: #777777;\n}\n\n#selector text.caption {\n  font-weight: 400;\n  font-size: 24px;\n  fill: #777777;\n}\n\n#selector text.label {\n  font-weight: 600;\n}\n\n#selector text.valueLabel {\n  font-weight: 300;\n}\n\n#selector text.dateCounterText {\n  font-size: 64px;\n  font-weight: 700;\n  opacity: 0.25;\n}\n\n#selector .tick text {\n  fill: #777777;\n}\n\n#selector .xAxis .tick:nth-child(2) text {\n  text-anchor: start;\n}\n\n#selector .tick line {\n  shape-rendering: CrispEdges;\n  stroke: #dddddd;\n}\n\n#selector .tick line.origin {\n  stroke: #aaaaaa;\n}\n\n#selector path.domain {\n  display: none;\n}\n\n#selector {\n  position: relative;\n}\n\n#selector .controls {\n  /*  width and right are set dynamically in renderer.ts */\n  position: absolute;\n  top: 0;\n  display: flex;\n}\n\n#selector .controls div {\n  cursor: pointer;\n  font-size: 24px;\n  font-weight: 700;\n  width: 38px;\n  height: 38px;\n  color: #ffffff;\n  background: #777777;\n  border: 1px solid black;\n  opacity: 0.5;\n  -moz-border-radius: 5px;\n  -webkit-border-radius: 5px;\n  border-radius: 5px;\n  margin: 5px;\n  text-align: center;\n}\n\n#selector .controls div:hover {\n  background: #aaaaaa;\n  color: black;\n}\n\n#selector .controls div svg {\n  margin: 7px auto;\n}\n"),n&&"undefined"!=typeof document){n=n.split("#selector").join(t);var r=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===e&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=n:a.appendChild(document.createTextNode(n))}}(f,"top");var M,Y=function(t,r){var o,u,c,d,f,p,h,g,v,y,m;return{renderInitalView:function(t){var n=r.selector,w=r.title,x=r.subTitle,k=r.caption,b=r.dateCounterFormat,D=r.labelsOnBars,L=r.labelsWidth,C=r.showControls,M=r.inputHeight,Y=r.inputWidth,S=r.minHeight,F=r.minWidth,E=r.topN,A=t.length>0?t[0].date:"",B=document.querySelector(n);v=a(B,S,M),y=i(B,F,Y),u=e.select(n).append("svg").attr("width",y).attr("height",v),p=(v-((o={top:80,right:0,bottom:5,left:0+(D?0:L)}).bottom+o.top))/(5*E),u.append("text").attr("class","title").attr("y",24).html(w),u.append("text").attr("class","subTitle").attr("y",55).html(x),c=e.scaleLinear().domain([0,e.max(t,function(t){return t.value})]).range([o.left,y-o.right-65]),d=e.scaleLinear().domain([E,0]).range([v-o.bottom,o.top]),f=e.axisTop(c).ticks(y>500?5:2).tickSize(-(v-o.top-o.bottom)).tickFormat(function(t){return e.format(",")(t)}),u.append("g").attr("class","axis xAxis").attr("transform","translate(0, "+o.top+")").call(f).selectAll(".tick line").classed("origin",function(t){return 0===t}),u.selectAll("rect.bar").data(t,function(t){return t.name}).enter().append("rect").attr("class","bar").attr("x",c(0)+1).attr("width",function(t){return Math.abs(c(t.value)-c(0)-1)}).attr("y",function(t){return d(t.rank)+5}).attr("height",d(1)-d(0)-p).style("fill",function(t){return t.color}),g=D?function(t){return c(t.value)-8}:o.left-8,u.selectAll("text.label").data(t,function(t){return t.name}).enter().append("text").attr("class","label").attr("x",g).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}).style("text-anchor","end").html(function(t){return t.name}),u.selectAll("text.valueLabel").data(t,function(t){return t.name}).enter().append("text").attr("class","valueLabel").attr("x",function(t){return c(t.value)+5}).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}).text(function(t){return e.format(",.0f")(t.lastValue)}),h=u.append("text").attr("class","dateCounterText").attr("x",y-o.right-p).attr("y",v-40).style("text-anchor","end").html(s(A,b)).call(function(t,e){t.select(function(){return this.parentNode.insertBefore(this.cloneNode(!0),this)}).style("fill","#ffffff").style("stroke","#ffffff").style("stroke-width",e).style("stroke-linejoin","round").style("opacity",1)},10),u.append("text").attr("class","caption").attr("x",y-o.right-p-10).attr("y",v-o.bottom-p).style("text-anchor","end").html(k),function(t,r){var a={},i=t.getBoundingClientRect().width;e.select(n).append("div").classed("controls",!0).style("width",y).style("right",i-y+o.right+p+"px").selectAll("div").data(Object.entries(l)).enter().append("div").html(function(t){return t[1]}).each(function(t){var n=t[0];e.select(this).classed(n,!0),a[n]=this}),m=a,"play"===r&&(m.skipBack.style.visibility="hidden",m.skipForward.style.visibility="hidden"),"none"===r&&e.select(n+" .controls").style("display","none")}(B,C)},renderFrame:function(t){if(c){var n=r.tickDuration,a=r.topN,i=r.dateCounterFormat,o=t.length>0?t[0].date:"";c.domain([0,e.max(t,function(t){return t.value})]),u.select(".xAxis").transition().duration(n).ease(e.easeLinear).call(f);var l=u.selectAll(".bar").data(t,function(t){return t.name});l.enter().append("rect").attr("class",function(t){return"bar "+t.name.replace(/\s/g,"_")}).attr("x",c(0)+1).attr("width",function(t){return Math.abs(c(t.value)-c(0)-1)}).attr("y",function(){return d(a+1)+5}).attr("height",d(1)-d(0)-p).style("fill",function(t){return t.color}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return d(t.rank)+5}),l.transition().duration(n).ease(e.easeLinear).attr("width",function(t){return Math.abs(c(t.value)-c(0)-1)}).attr("y",function(t){return d(t.rank)+5}),l.exit().transition().duration(n).ease(e.easeLinear).attr("width",function(t){return Math.abs(c(t.value)-c(0)-1)}).attr("y",function(){return d(a+1)+5}).remove();var v=u.selectAll(".label").data(t,function(t){return t.name});v.enter().append("text").attr("class","label").attr("x",g).attr("y",function(){return d(a+1)+5+(d(1)-d(0))/2}).style("text-anchor","end").html(function(t){return t.name}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}),v.transition().duration(n).ease(e.easeLinear).attr("x",g).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}),v.exit().transition().duration(n).ease(e.easeLinear).attr("x",g).attr("y",function(){return d(a+1)+5}).remove();var y=u.selectAll(".valueLabel").data(t,function(t){return t.name});y.enter().append("text").attr("class","valueLabel").attr("x",function(t){return c(t.value)+5}).attr("y",function(){return d(a+1)+5}).text(function(t){return e.format(",.0f")(t.lastValue)}).transition().duration(n).ease(e.easeLinear).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}),y.transition().duration(n).ease(e.easeLinear).attr("x",function(t){return c(t.value)+5}).attr("y",function(t){return d(t.rank)+5+(d(1)-d(0))/2+1}).tween("text",function(t){var n=e.interpolateRound(t.lastValue,t.value);return function(t){this.textContent=e.format(",")(n(t))}}),y.exit().transition().duration(n).ease(e.easeLinear).attr("x",function(t){return c(t.value)+5}).attr("y",function(){return d(a+1)+5}).remove(),h.html(s(o,i))}},resize:function(e){if(!r.inputHeight&&!r.inputWidth||String(r.inputHeight).startsWith("window")||String(r.inputWidth).startsWith("window")){var n=document.querySelector(t);v=a(n,r.minHeight,r.inputHeight),y=i(n,r.minWidth,r.inputWidth);var o=n.style.position;e(),n.style.position=o}},renderAsRunning:function(t){t?(m.play.style.display="none",m.pause.style.display="unset"):(m.play.style.display="unset",m.pause.style.display="none")},getRenderedHeight:function(){return v},getRenderedWidth:function(){return y},getControlButtons:function(){return n({},m)}}}(f,D),S=function(t){var n,r,a,i,o,s;function l(){f(!0),n=e.interval(function(t){r.isLast()?(s(),o?d():u()):r.inc()},i)}function u(){n&&n.stop(),f(!1)}function c(){u(),r.setFirst(),s()}function d(){r.setFirst(),s()}function f(t){void 0===t&&(t=!0),function(t){Y.renderAsRunning(t)}(a=t)}return{tickerDateFactory:function(t,e,n,a){i=e.tickDuration,o=e.loop,s=a;var l,u=0,c=t.length-1,d=t[c];function f(){n(l=t[u])}return r={inc:function(t){void 0===t&&(t=1);var e=u+t;u=e>c?c:e,f()},dec:function(t){void 0===t&&(t=1);var e=u-t;u=e<0?0:e,f()},setFirst:function(){u=0,f()},setLast:function(){u=t.length-1,f()},update:function(){f()},getDate:function(){return l},setDate:function(e){var n=t.indexOf(e);n>-1&&(u=n,f())},isLast:function(){return l===d}}},start:l,stop:u,rewind:c,loop:d,fastForward:function(){u(),r.setLast(),s()},toggle:function(){r.isLast()?(c(),l()):a?u():l()},isRunning:function(){return a}}}(),F=function(t){var e=new Set;return t.forEach(function(t){e.add(t.date)}),Array.from(e).sort()}(t=function(t,a,i,s){var l;return"wide"===a&&(l=[],t.forEach(function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var r=n[e];l.push({date:t.date,name:r[0],value:Number(r[1])})}}),t=l),t.map(function(t){var a=n({},t);return a.value=isNaN(+a.value)?0:+a.value,a.date=o(a.date),a.color=function(t,n,a){return e.hsl(360*(i=function(t){for(var e="",n=0;n<t.length;n++)e+=r(String(t.charCodeAt(n)),3);return e}((t.group&&!n?t.group:t.name)+a),(o=1e4*Math.sin(+i))-Math.floor(o)),.75,.75);var i,o}(a,i,s),a})}(t=function(t,e,n){return t.filter(function(t){return!e||t.date>=e}).filter(function(t){return!n||t.date<=n})}(t,p,h),c,v,g));d&&(t=function(t,e,r){var a=new Date(s(e[0],"YYYY-MM-DD")),i=new Date(s(e[e.length-1],"YYYY-MM-DD")),l={years:function(t){t.setFullYear(t.getFullYear()+1)},months:function(t){t.setMonth(t.getMonth()+1)},days:function(t){t.setDate(t.getDate()+1)}};if(!l[r])return t;for(var u=[],c=a;c<i;l[r](c))u.push(o(c));return u.forEach(function(e,r){if(!(t.filter(function(t){return t.date===e}).length>0)){var a=t.filter(function(t){return t.date===u[r-1]}).map(function(t){return n(n({},t),{},{date:e})});t.push.apply(t,a)}}),t}(t,F,d));var E,A=S.tickerDateFactory(F,L,function(e){E=function(t,e,r,a){return t.filter(function(t){return t.date===e&&!isNaN(t.value)}).map(function(t){if(!r[t.name])return t;var e=r[t.name].value;return r[t.name].date=t.date,r[t.name].value=t.value,n(n({},t),{},{lastValue:e})}).sort(function(t,e){return e.value-t.value}).slice(0,a).map(function(t,e){return n(n({},t),{},{rank:e})})}(t,A.getDate(),M,m),j(),C.dispatchEvent(new CustomEvent("dateChanged",{detail:{date:s(e,"YYYY-MM-DD")}}))},j);function B(){var t;C.innerHTML="",Y.renderInitalView(E),S.stop(),(t=Y.getControlButtons())&&(t.skipBack.addEventListener("click",S.rewind),t.play.addEventListener("click",S.toggle),t.pause.addEventListener("click",S.toggle),t.skipForward.addEventListener("click",S.fastForward))}function j(){Y.renderFrame(E)}return M={},t.forEach(function(t){t.lastValue=t.value,(!M[t.name]||t.date<M[t.name].date)&&(M[t.name]={date:t.date,value:t.value})}),A.setFirst(),B(),j(),S.start(),k||S.stop(),w||(C.querySelector("svg").addEventListener("click",S.toggle),C.addEventListener("dblclick",S.fastForward)),x||document.addEventListener("keypress",function(t){switch(t.keyCode){case 32:S.toggle();break;case 97:S.rewind();break;case 115:S.toggle();break;case 100:S.fastForward()}}),window.addEventListener("resize",function(){Y.resize(function(){var t=S.isRunning();A.update(),B(),t&&S.start()})}),{start:function(){S.isRunning()||S.start()},stop:function(){S.stop()},rewind:function(){S.rewind()},fastforward:function(){S.fastForward()},loop:function(){S.loop()},inc:function(t){void 0===t&&(t=1),A.inc(t)},dec:function(t){void 0===t&&(t=1),A.dec(t)},getDate:function(){return A.getDate()},setDate:function(t){A.setDate(o(t))},getAllDates:function(){return F.map(function(t){return s(t,"YYYY-MM-DD")})},createScroller:function(){!function(){!function(){C.style.position="fixed",C.style.top="0";var t=document.createElement("div");t.style.height=10*window.innerHeight+"px",document.body.appendChild(t)}();var t=document.body.clientHeight/F.length;window.addEventListener("scroll",function(){var e=Math.ceil(window.pageYOffset/t);e<F.length?A.setDate(F[e]):A.setLast()})}()}}}});
//# sourceMappingURL=racing-bars.umd.js.map
