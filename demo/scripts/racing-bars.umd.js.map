{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/racing-bars.ts"],"sourcesContent":["import * as d3 from 'd3';\n\nimport { Data } from './models/data.model';\nimport { Options } from './models/options.model';\n\nexport function race(data: Data[], options: Options = {}) {\n  const dataShape = options.dataShape || \"\";\n  const fillDateGaps = options.fillDateGaps; // [false, \"years\", \"months\", \"days\"]\n  // const fillDateGapsValue = options.fillDateGapsValue || \"last\"; // [\"last\", \"zero\"]\n  const selector = options.selector || \"#race\";\n  const title = options.title || \"18 years of Top Global Brands\";\n  const subTitle = options.subTitle || \"Brand value, $m\";\n  const dateCounterFormat = options.dateCounterFormat || \"YYYY\";\n  const startDate = options.startDate ? getDateString(options.startDate) : \"\";\n  const endDate = options.endDate ? getDateString(options.endDate) : \"\";\n  const loop = options.loop;\n  const caption = options.caption || \"Source: Interbrand\";\n  const labelsOnBars = options.labelsOnBars !== false;\n  const labelsWidth = options.labelsWidth || 100;\n  const colorSeed = options.colorSeed || \"\";\n  const disableGroupColors = options.disableGroupColors;\n  const tickDuration = +options.tickDuration || 500;\n  const topN = +options.top_n || 10;\n  const inputHeight = options.height;\n  const inputWidth = options.width;\n  const disableClickEvents = options.disableClickEvents || true;\n  const disableKeyboardEvents = options.disableKeyboardEvents;\n  const showControls = options.showControls || \"all\"; // [\"all\", \"play\", \"none\"]\n  const autorun = options.autorun !== false;\n\n  let margin: any;\n  let svg: any;\n  let x: d3.ScaleLinear<number, number>;\n  let y: d3.ScaleLinear<number, number>;\n  let xAxis: any;\n  let barPadding: any;\n  let dateCounterText: any;\n  let labelX: number | ((d: Data) => number);\n  let lastValues: any;\n  let running: boolean;\n  let ticker: any;\n\n  const element = document.querySelector(selector) as HTMLElement;\n  const minHeight = 300;\n  const minWidth = 500;\n  let height = getHeight(inputHeight);\n  let width = getWidth(inputWidth);\n\n  data = filterDates(data, startDate, endDate);\n  data = prepareData(data, dataShape);\n\n  if (fillDateGaps) {\n    data = fillGaps(data, getDates(data), fillDateGaps);\n  }\n\n  const tickerDate = tickerDateFactory(getDates(data));\n\n  let dateSlice: Data[];\n  initialize();\n\n  renderInitalView();\n  renderFrame();\n\n  startTicker();\n\n  if (!autorun) {\n    stopTicker();\n  }\n\n  if (!disableClickEvents) {registerClickEvents();}\n  if (!disableKeyboardEvents) {registerKeyboardEvents();}\n\n  window.addEventListener(\"resize\", resize);\n\n  function prepareData(data: Data[], dataShape = \"\") {\n    if (dataShape === \"wide\") {\n      data = wideDataToLong(data);\n    }\n    return data.map((item) => {\n      const d = { ...item };\n      d.value = isNaN(+d.value) ? 0 : +d.value;\n      d.date = getDateString(d.date);\n      d.color = getColor(d);\n      return d;\n    });\n  }\n\n  function wideDataToLong(wide: any) {\n    const long = [] as Data[];\n    wide.forEach((item: any) => {\n      for (const [key, value] of Object.entries(item)) {\n        long.push({\n          date: item.date,\n          name: key,\n          value: Number(value),\n        });\n      }\n    });\n    return long;\n  }\n\n  function getDates(data: Data[]) {\n    const uniqueDates = new Set<string>();\n    data.forEach((d) => {\n      uniqueDates.add(d.date);\n    });\n    return Array.from(uniqueDates).sort();\n  }\n\n  function filterDates(data: Data[], startDate: string, endDate: string) {\n    return data\n      .filter((d) => (startDate ? d.date >= startDate : true))\n      .filter((d) => (endDate ? d.date <= endDate : true));\n  }\n\n  function fillGaps(data: Data[], dates: string[], period: \"years\" | \"months\" | \"days\") {\n\n    const minDate = new Date(formatDate(dates[0], \"YYYY-MM-DD\"));\n    const maxDate = new Date(formatDate(dates[dates.length - 1], \"YYYY-MM-DD\"));\n\n    const next = {\n      years: (dt: Date) => { dt.setFullYear(dt.getFullYear() + 1); },\n      months: (dt: Date) => { dt.setMonth(dt.getMonth() + 1); },\n      days: (dt: Date) => { dt.setDate(dt.getDate() + 1); },\n    };\n    if (!next[period]) {return data;}\n\n    const dateRange: string[] = [];\n    for (const date = minDate; date < maxDate; next[period](date)) {\n      dateRange.push(getDateString(date));\n    }\n\n    dateRange.forEach((date, index) => {\n      if (data.filter((d) => d.date === date).length > 0) { return; }\n\n      const missing = data\n      .filter((d) => d.date === dateRange[index - 1])\n      .map((d) => {\n        // const value = {\n        //   last: d.value,\n        //   zero: 0,\n        // }\n        return {\n          ...d,\n          date,\n          // value: value[fillDateGapsValue],\n        }\n      });\n\n      data.push(...missing);\n    })\n\n    return data;\n  }\n\n  function tickerDateFactory(dates: string[]) {\n    let dateCounter = 0;\n    let currentDate: string;\n    const lastIndex = dates.length - 1;\n    const maxDate = dates[lastIndex];\n\n    function updateDate() {\n      currentDate = dates[dateCounter];\n      dateSlice = getDateSlice(data, tickerDate.getDate(), topN);\n      renderFrame();\n      element.dispatchEvent(\n        new CustomEvent(\"dateChanged\", {\n          detail: { date: formatDate(currentDate, \"YYYY-MM-DD\") },\n        })\n      );\n    }\n\n    return {\n      inc: (value = 1) => {\n        const newValue = dateCounter + value;\n        dateCounter = newValue > lastIndex ? lastIndex : newValue;\n        updateDate();\n      },\n      dec: (value = 1) => {\n        const newValue = dateCounter - value;\n        dateCounter = newValue < 0 ? 0 : newValue;\n        updateDate();\n      },\n      setFirst: () => {\n        dateCounter = 0;\n        updateDate();\n      },\n      setLast: () => {\n        dateCounter = dates.length - 1;\n        updateDate();\n      },\n      update: () => {\n        updateDate();\n      },\n      set: (date: string) => {\n        const dateIndex = dates.indexOf(date);\n        if (dateIndex > -1) {\n          dateCounter = dateIndex;\n          updateDate();\n        }\n      },\n      getDate: () => currentDate,\n      isLast: () => currentDate === maxDate,\n      getDates: () => [...dates],\n    };\n  }\n\n  function getDateSlice(data: Data[], date: string, topN: number) {\n    const dateSlice = data\n      .filter((d) => d.date === date && !isNaN(d.value))\n      .map((d) => {\n        if (!lastValues) { return d; }\n\n        const lastValue = lastValues[d.name].value;\n        lastValues[d.name].date = d.date;\n        lastValues[d.name].value = d.value;\n        return { ...d, lastValue };\n      })\n      .sort((a, b) => b.value - a.value)\n      .slice(0, topN);\n    dateSlice.forEach((d, i) => (d.rank = i));\n\n    return dateSlice;\n  }\n\n  function initialize() {\n    initializeLastValues();\n    tickerDate.setFirst();\n\n    function initializeLastValues() {\n      lastValues = {};\n      data.forEach((d) => {\n        d.lastValue = d.value;\n        if (!lastValues[d.name] || d.date < lastValues[d.name].date) {\n          lastValues[d.name] = {\n            date: d.date,\n            value: d.value,\n          };\n        }\n      });\n    }\n  }\n\n  function startTicker() {\n    setRunning(true);\n    ticker = d3.interval(showRace, tickDuration);\n\n    function showRace(_: number) {\n      if (tickerDate.isLast()) {\n        renderFrame();\n        if (loop) {\n          loopTicker();\n        } else {\n          stopTicker();\n        }\n      } else {\n        tickerDate.inc();\n      }\n    }\n  }\n\n  function stopTicker() {\n    ticker.stop();\n    setRunning(false);\n  }\n\n  function rewindTicker() {\n    stopTicker();\n    tickerDate.setFirst();\n    renderFrame();\n  }\n\n  function loopTicker() {\n    tickerDate.setFirst();\n    renderFrame();\n  }\n\n  function fastForwardTicker() {\n    stopTicker();\n    tickerDate.setLast();\n    renderFrame();\n  }\n\n  function toggle() {\n    if (tickerDate.isLast()) {\n      rewindTicker();\n      startTicker();\n    } else if (running) {\n      stopTicker();\n    } else {\n      startTicker();\n    }\n  }\n\n  function setRunning(flag = true) {\n    const playButton = document.querySelector(selector + \" .play\") as HTMLElement;\n    const pauseButton = document.querySelector(selector + \" .pause\") as HTMLElement;\n    if (flag) {\n      running = true;\n      playButton.style.display = \"none\";\n      pauseButton.style.display = \"unset\";\n    } else {\n      running = false;\n      playButton.style.display = \"unset\";\n      pauseButton.style.display = \"none\";\n    }\n  }\n\n  function getDateString(inputDate: string | Date) {\n    const date = new Date(inputDate);\n    if (isNaN(+date)) { throw new Error(`\"${inputDate}\" is not a valid date`); }\n\n    const year = date.getFullYear();\n\n    let month = (1 + date.getMonth()).toString();\n    month = zeroPad(month, 2);\n\n    let day = date.getDate().toString();\n    day = zeroPad(day, 2);\n\n    return `${year}${month}${day}`;\n  }\n\n  function formatDate(dateStr: string, format = dateCounterFormat) {\n    const year = dateStr.slice(0, 4);\n    const month = dateStr.slice(4, 6);\n    const day = dateStr.slice(6, 8);\n    const date = new Date(`${year}-${month}-${day}`);\n    const weekDayIndex = date.getDay();\n    const monthNames: any = {\n      \"01\": \"Jan\",\n      \"02\": \"Feb\",\n      \"03\": \"Mar\",\n      \"04\": \"Apr\",\n      \"05\": \"May\",\n      \"06\": \"Jun\",\n      \"07\": \"Jul\",\n      \"08\": \"Aug\",\n      \"09\": \"Sep\",\n      \"10\": \"Oct\",\n      \"11\": \"Nov\",\n      \"12\": \"Dec\",\n    };\n\n    const weekDays: any = {\n      \"0\": \"Sun\",\n      \"1\": \"Mon\",\n      \"2\": \"Tue\",\n      \"3\": \"Wed\",\n      \"4\": \"Thu\",\n      \"5\": \"Fri\",\n      \"6\": \"Sat\",\n    };\n\n    return format\n      .replace(\"MMM\", monthNames[month])\n      .replace(\"DDD\", weekDays[weekDayIndex])\n      .replace(\"YYYY\", year)\n      .replace(\"MM\", month)\n      .replace(\"DD\", day);\n  }\n\n  function getColor(d: Data) {\n    const nameseed = d.group && !disableGroupColors ? d.group : d.name;\n    const seed = nameseed + colorSeed;\n    return d3.hsl(random(seed) * 360, 0.75, 0.75);\n  }\n\n  function zeroPad(n: string, w: number) {\n    while (n.toString().length < w) { n = \"0\" + n; }\n    return n;\n  }\n\n  function random(seedStr: string) {\n    function toNumbers(s: string) {\n      let nums = \"\";\n      for (let i = 0; i < s.length; i++) {\n        nums += zeroPad(String(s.charCodeAt(i)), 3);\n      }\n      return nums;\n    }\n\n    const seed = toNumbers(seedStr);\n    const x = Math.sin(+seed) * 10000;\n    return x - Math.floor(x);\n  }\n\n  function getHeight(height: string) {\n    let newHeight;\n    if (!height) {\n      newHeight = element.getBoundingClientRect().height;\n    } else if (String(height).startsWith(\"window\")) {\n      const scale = +height.split(\"*\")[1] || 1;\n      newHeight = window.innerHeight * scale;\n    } else {\n      newHeight = +height;\n    }\n    return newHeight > minHeight ? newHeight : minHeight;\n  }\n\n  function getWidth(width: string) {\n    let newWidth;\n    if (!width) {\n      newWidth = element.getBoundingClientRect().width;\n    } else if (String(width).startsWith(\"window\")) {\n      const scale = +width.split(\"*\")[1] || 1;\n      newWidth = window.innerWidth * scale;\n    } else {\n      newWidth = +width;\n    }\n    return newWidth > minWidth ? newWidth : minWidth;\n  }\n\n  function renderInitalView() {\n    renderInitialFrame();\n    renderControls();\n    setRunning(false);\n\n    function renderInitialFrame() {\n      svg = d3\n        .select(selector)\n        .append(\"svg\")\n        .attr(\"width\", width)\n        .attr(\"height\", height);\n\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\n\n      margin = {\n        top: 80,\n        right: 0,\n        bottom: 5,\n        left: 0 + labelsArea,\n      };\n\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\n\n      svg.append(\"text\").attr(\"class\", \"title\").attr(\"y\", 24).html(title);\n\n      svg.append(\"text\").attr(\"class\", \"subTitle\").attr(\"y\", 55).html(subTitle);\n\n      x = d3\n        .scaleLinear()\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\n        .range([margin.left, width - margin.right - 65]);\n\n      y = d3\n        .scaleLinear()\n        .domain([topN, 0])\n        .range([height - margin.bottom, margin.top]);\n\n      xAxis = d3\n        .axisTop(x)\n        // .scale()\n        .ticks(width > 500 ? 5 : 2)\n        .tickSize(-(height - margin.top - margin.bottom))\n        .tickFormat((n: number | { valueOf(): number; }) => d3.format(\",\")(n));\n\n      svg\n        .append(\"g\")\n        .attr(\"class\", \"axis xAxis\")\n        .attr(\"transform\", `translate(0, ${margin.top})`)\n        .call(xAxis)\n        .selectAll(\".tick line\")\n        .classed(\"origin\", (d: number) => d === 0);\n\n      svg\n        .selectAll(\"rect.bar\")\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"x\", x(0) + 1)\n        .attr(\"width\", (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n        .attr(\"y\", (d: any) => y(d.rank) + 5)\n        .attr(\"height\", y(1) - y(0) - barPadding)\n        .style(\"fill\", (d: Data) => d.color);\n\n      labelX = labelsOnBars ? (d: Data) => x(d.value) - 8 : margin.left - 8;\n\n      svg\n        .selectAll(\"text.label\")\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append(\"text\")\n        .attr(\"class\", \"label\")\n        .attr(\"x\", labelX)\n        .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .style(\"text-anchor\", \"end\")\n        .html((d: Data) => d.name);\n      svg\n        .selectAll(\"text.valueLabel\")\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append(\"text\")\n        .attr(\"class\", \"valueLabel\")\n        .attr(\"x\", (d: Data) => x(d.value) + 5)\n        .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .text((d: Data) => d3.format(\",.0f\")(d.lastValue as number));\n\n      const strokeWidth = 10;\n      dateCounterText = svg\n        .append(\"text\")\n        .attr(\"class\", \"dateCounterText\")\n        .attr(\"x\", width - margin.right - barPadding)\n        .attr(\"y\", height - 40)\n        .style(\"text-anchor\", \"end\")\n        .html(formatDate(tickerDate.getDate(), dateCounterFormat))\n        .call(halo, strokeWidth);\n\n      svg\n        .append(\"text\")\n        .attr(\"class\", \"caption\")\n        .attr(\"x\", width - margin.right - barPadding - strokeWidth)\n        .attr(\"y\", height - margin.bottom - barPadding)\n        .style(\"text-anchor\", \"end\")\n        .html(caption);\n\n      function halo(text: any, strokeWidth: number) {\n        text\n          .select(function () {\n            return this.parentNode.insertBefore(this.cloneNode(true), this);\n          })\n          .style(\"fill\", \"#ffffff\")\n          .style(\"stroke\", \"#ffffff\")\n          .style(\"stroke-width\", strokeWidth)\n          .style(\"stroke-linejoin\", \"round\")\n          .style(\"opacity\", 1);\n      }\n    }\n\n    function renderControls() {\n      const icons = {\n        play: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-play\"><polygon points=\"5 3 19 12 5 21 5 3\"></polygon></svg>`,\n        pause: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-pause\"><rect x=\"6\" y=\"4\" width=\"4\" height=\"16\"></rect><rect x=\"14\" y=\"4\" width=\"4\" height=\"16\"></rect></svg>`,\n        skipForward: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-skip-forward\"><polygon points=\"5 4 15 12 5 20 5 4\"></polygon><line x1=\"19\" y1=\"5\" x2=\"19\" y2=\"19\"></line></svg>`,\n        skipBack: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-skip-back\"><polygon points=\"19 20 9 12 19 4 19 20\"></polygon><line x1=\"5\" y1=\"19\" x2=\"5\" y2=\"5\"></line></svg>`,\n      }\n      element.style.position = \"relative\";\n\n      const controls = addElement(\"div\", \"controls\", \"\", element);\n      controls.style.position = \"absolute\";\n      controls.style.top = \"0\";\n      controls.style.right = margin.right + barPadding + \"px\";\n\n      const rewindButton = addElement(\"div\", \"rewind\", icons.skipBack, controls);\n      rewindButton.addEventListener(\"click\", rewindTicker);\n\n      const playButton = addElement(\"div\", \"play\", icons.play, controls);\n      playButton.addEventListener(\"click\", toggle);\n\n      const pauseButton = addElement(\"div\", \"pause\", icons.pause, controls);\n      pauseButton.addEventListener(\"click\", toggle);\n\n      const fastforwardButton = addElement(\"div\", \"fastforward\", icons.skipForward, controls);\n      fastforwardButton.addEventListener(\"click\", fastForwardTicker);\n\n      switch (showControls) {\n        case \"play\":\n          rewindButton.style.visibility = \"hidden\";\n          fastforwardButton.style.visibility = \"hidden\";\n          break;\n        case \"none\":\n          controls.style.display = \"none\";\n          break;\n      }\n\n      function addElement(tag: string, className: string, html: string, parent: HTMLElement) {\n        const domElement = document.createElement(tag);\n        domElement.classList.add(className);\n        domElement.innerHTML = html;\n        parent.appendChild(domElement);\n        return domElement;\n      }\n    }\n  }\n\n  function renderFrame() {\n    if (!x) {return;}\n\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\n\n    svg\n      .select(\".xAxis\")\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .call(xAxis);\n\n    const bars = svg.selectAll(\".bar\").data(dateSlice, (d: Data) => d.name);\n\n    bars\n      .enter()\n      .append(\"rect\")\n      .attr(\"class\", (d: Data) => `bar ${d.name.replace(/\\s/g, \"_\")}`)\n      .attr(\"x\", x(0) + 1)\n      .attr(\"width\", (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr(\"y\", () => y(topN + 1) + 5)\n      .attr(\"height\", y(1) - y(0) - barPadding)\n      .style(\"fill\", (d: Data) => d.color)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"width\", (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"width\", (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr(\"y\", () => y(topN + 1) + 5)\n      .remove();\n\n    const labels = svg.selectAll(\".label\").data(dateSlice, (d: Data) => d.name);\n\n    labels\n      .enter()\n      .append(\"text\")\n      .attr(\"class\", \"label\")\n      .attr(\"x\", labelX)\n      .attr(\"y\", () => y(topN + 1) + 5 + (y(1) - y(0)) / 2)\n      .style(\"text-anchor\", \"end\")\n      .html((d: Data) => d.name)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"x\", labelX)\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"x\", labelX)\n      .attr(\"y\", () => y(topN + 1) + 5)\n      .remove();\n\n    const valueLabels = svg\n      .selectAll(\".valueLabel\")\n      .data(dateSlice, (d: Data) => d.name);\n\n    valueLabels\n      .enter()\n      .append(\"text\")\n      .attr(\"class\", \"valueLabel\")\n      .attr(\"x\", (d: Data) => x(d.value) + 5)\n      .attr(\"y\", () => y(topN + 1) + 5)\n      .text((d: Data) => d3.format(\",.0f\")(d.lastValue as number))\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    valueLabels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"x\", (d: Data) => x(d.value) + 5)\n      .attr(\"y\", (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n      .tween(\"text\", function (d: Data) {\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\n        return function (t: any) {\n          this.textContent = d3.format(\",\")(i(t));\n        };\n      });\n\n    valueLabels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr(\"x\", (d: Data) => x(d.value) + 5)\n      .attr(\"y\", () => y(topN + 1) + 5)\n      .remove();\n\n    dateCounterText.html(formatDate(tickerDate.getDate(), dateCounterFormat));\n  }\n\n  function resize() {\n    if (\n      (!options.height && !options.width) ||\n      String(options.height).startsWith(\"window\") ||\n      String(options.width).startsWith(\"window\")\n    ) {\n      height = getHeight(options.height);\n      width = getWidth(options.width);\n\n      const currentlyRunning = running;\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\n\n      stopTicker();\n      element.innerHTML = \"\";\n      tickerDate.update();\n      renderInitalView();\n\n      if (currentlyRunning) {\n        startTicker();\n      }\n      element.style.position = currentPosition;\n    }\n  }\n\n  function createScroller() {\n    prepareDOM();\n\n    const dates = tickerDate.getDates();\n    const step = document.body.clientHeight / dates.length;\n\n    subscribeToEvents();\n\n    function prepareDOM() {\n      element.style.position = \"fixed\";\n      element.style.top = \"0\";\n\n      const scrollElement = document.createElement(\"div\");\n      scrollElement.style.height = window.innerHeight * 10 + \"px\";\n      document.body.appendChild(scrollElement);\n    }\n\n    function subscribeToEvents() {\n      window.addEventListener(\"scroll\", goToDate);\n      // element.addEventListener(\"dateChanged\", scrollToPosition);\n    }\n\n    // function scrollToPosition(e: CustomEvent) {\n    //   let currentDate = getDateString(e.detail.date);\n    //   let index = dates.indexOf(currentDate);\n    //   ignoreNextScrollEvent = true;\n    //   window.scroll({\n    //     top: index * step,\n    //     behavior: \"smooth\",\n    //   });\n    // }\n\n    function goToDate() {\n      const index = Math.ceil(window.pageYOffset / step);\n      if (index < dates.length) {\n        tickerDate.set(dates[index]);\n      } else {\n        tickerDate.setLast();\n      }\n    }\n  }\n\n  function registerClickEvents() {\n    const svg = element.querySelector(\"svg\") as SVGSVGElement;\n    svg.addEventListener(\"click\", toggle);\n\n    element.addEventListener(\"dblclick\", fastForwardTicker);\n  }\n\n  function registerKeyboardEvents() {\n    document.addEventListener(\"keypress\", function (e) {\n      const keyCodes = {\n        spacebar: 32,\n        a: 97,\n        d: 100,\n        s: 115,\n      };\n\n      // TODO: keyCode is deprecated\n      switch (e.keyCode) {\n        case keyCodes.spacebar:\n          toggle();\n          break;\n        case keyCodes.a:\n          rewindTicker();\n          break;\n        case keyCodes.s:\n          toggle();\n          break;\n        case keyCodes.d:\n          fastForwardTicker();\n          break;\n      }\n    });\n  }\n\n  return {\n    // TODO: validate user input\n    start: () => {\n      if (!running) { startTicker(); }\n    },\n    stop: () => {\n      stopTicker();\n    },\n    rewind: () => {\n      rewindTicker();\n    },\n    fastforward: () => {\n      fastForwardTicker();\n    },\n    loop: () => {\n      loopTicker();\n    },\n    inc: (value = 1) => {\n      tickerDate.inc(value);\n    },\n    dec: (value = 1) => {\n      tickerDate.dec(value);\n    },\n    getCurrentDate: () => {\n      return tickerDate.getDate();\n    },\n    getDates: () =>\n      tickerDate.getDates().map((date) => formatDate(date, \"YYYY-MM-DD\")),\n    setDate: (inputDate: string | Date) => {\n      tickerDate.set(getDateString(inputDate));\n    },\n    createScroller: () => {\n      createScroller();\n    },\n  };\n}\n\nexport function loadData(URL: string, type = \"json\") {\n  switch (type) {\n    case \"json\":\n      return d3.json(URL);\n    case \"csv\":\n      return d3.csv(URL);\n    case \"tsv\":\n      return d3.tsv(URL);\n    default:\n      throw new Error(`Unsupported data type: ${type}`);\n  }\n}\n"],"names":["URL","type","d3","Error","data","options","margin","svg","x","y","xAxis","barPadding","dateCounterText","labelX","lastValues","running","ticker","dataShape","fillDateGaps","selector","title","subTitle","dateCounterFormat","startDate","getDateString","endDate","loop","caption","labelsOnBars","labelsWidth","colorSeed","disableGroupColors","tickDuration","topN","top_n","inputHeight","height","inputWidth","width","disableClickEvents","disableKeyboardEvents","showControls","autorun","element","document","querySelector","getHeight","getWidth","long","forEach","item","Object","entries","push","date","name","value","Number","map","d","isNaN","color","seedStr","seed","s","nums","i","length","zeroPad","String","charCodeAt","toNumbers","Math","sin","floor","random","group","getColor","prepareData","filter","filterDates","dates","period","minDate","Date","formatDate","maxDate","next","years","dt","setFullYear","getFullYear","months","setMonth","getMonth","days","setDate","getDate","dateRange","index","missing","fillGaps","getDates","dateSlice","tickerDate","currentDate","dateCounter","lastIndex","updateDate","lastValue","sort","a","b","slice","rank","getDateSlice","renderFrame","dispatchEvent","CustomEvent","detail","inc","newValue","dec","setFirst","setLast","update","set","dateIndex","indexOf","isLast","tickerDateFactory","uniqueDates","Set","add","Array","from","startTicker","setRunning","_","loopTicker","stopTicker","stop","rewindTicker","fastForwardTicker","toggle","flag","playButton","pauseButton","style","display","inputDate","year","month","toString","dateStr","format","day","weekDayIndex","getDay","replace","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","n","w","newHeight","startsWith","scale","split","window","innerHeight","getBoundingClientRect","newWidth","innerWidth","renderInitalView","append","attr","top","right","bottom","left","html","domain","range","ticks","tickSize","tickFormat","call","selectAll","classed","enter","abs","text","strokeWidth","select","parentNode","insertBefore","this","cloneNode","position","controls","addElement","rewindButton","addEventListener","fastforwardButton","visibility","tag","className","parent","domElement","createElement","classList","innerHTML","appendChild","renderControls","transition","duration","ease","bars","exit","remove","labels","valueLabels","tween","t","textContent","e","keyCode","currentlyRunning","currentPosition","start","rewind","fastforward","getCurrentDate","createScroller","scrollElement","body","prepareDOM","step","clientHeight","ceil","pageYOffset"],"mappings":"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"}