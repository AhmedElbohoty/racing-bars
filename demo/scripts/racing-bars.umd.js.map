{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/options/options.actions.ts","../../src/lib/ticker/ticker.actions.ts","../../src/lib/ticker/ticker.reducer.ts","../../src/lib/ticker/ticker.ts","../../src/lib/store/actions.ts","../../src/lib/store/reducer.ts","../../src/lib/store/state.ts","../../src/lib/store/store.ts","../../src/lib/utils.ts","../../src/lib/dates.ts","../../src/lib/options/options.reducer.ts","../../src/lib/data-utils.ts","../../src/lib/styles/generated-styles.ts","../../src/lib/events.ts","../../src/lib/elements.ts","../../src/lib/load-data.ts","../../src/lib/race.ts","../../src/lib/styles/style-inject.ts","../../src/lib/renderer.ts","../../src/lib/scroller.ts"],"sourcesContent":["import { Options, OptionsAction, RequiredOptions } from './options.models';\r\n\r\nexport const actionTypes = {\r\n  optionsLoaded: 'options/loaded',\r\n  changeOptions: 'options/change',\r\n  optionsChanged: 'options/changed',\r\n};\r\n\r\nexport const optionsLoaded = (options: Options | RequiredOptions): OptionsAction => ({\r\n  type: actionTypes.optionsLoaded,\r\n  payload: options,\r\n});\r\n\r\nexport const changeOptions = (options: Options): OptionsAction => ({\r\n  type: actionTypes.changeOptions,\r\n  payload: options,\r\n});\r\n\r\nexport const optionsChanged = (options: Options): OptionsAction => ({\r\n  type: actionTypes.optionsChanged,\r\n  payload: options,\r\n});\r\n","import { TickerAction } from './ticker.models';\r\n\r\nexport const actionTypes = {\r\n  initialize: 'ticker/initialize',\r\n  updateDate: 'ticker/updateDate',\r\n  setRunning: 'ticker/setRunning',\r\n  setFirst: 'ticker/setFirst',\r\n  setLast: 'ticker/setLast',\r\n  inc: 'ticker/inc',\r\n  dec: 'ticker/dec',\r\n};\r\n\r\nexport const initialize = (dates: string[]): TickerAction => ({\r\n  type: actionTypes.initialize,\r\n  payload: dates,\r\n});\r\n\r\nexport const updateDate = (currentDate: string): TickerAction => ({\r\n  type: actionTypes.updateDate,\r\n  payload: currentDate,\r\n});\r\n\r\nexport const setRunning = (running: boolean): TickerAction => ({\r\n  type: actionTypes.setRunning,\r\n  payload: running,\r\n});\r\n\r\nexport const setFirst = (): TickerAction => ({\r\n  type: actionTypes.setFirst,\r\n});\r\n\r\nexport const setLast = (): TickerAction => ({\r\n  type: actionTypes.setLast,\r\n});\r\n\r\nexport const inc = (value = 1): TickerAction => ({\r\n  type: actionTypes.inc,\r\n  payload: value,\r\n});\r\n\r\nexport const dec = (value = 1): TickerAction => ({\r\n  type: actionTypes.dec,\r\n  payload: value,\r\n});\r\n","import { TickerState, TickerAction } from './ticker.models';\r\nimport { actionTypes } from './ticker.actions';\r\n\r\nconst initialState: TickerState = {\r\n  isRunning: false,\r\n  currentDate: '',\r\n  isFirstDate: true,\r\n  isLastDate: false,\r\n  dates: [],\r\n};\r\n\r\nexport function tickerReducer(state = initialState, action: TickerAction): TickerState {\r\n  switch (action.type) {\r\n    case actionTypes.initialize: {\r\n      const dates = action.payload as string[];\r\n      return {\r\n        ...state,\r\n        isRunning: false,\r\n        currentDate: dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n        dates,\r\n      };\r\n    }\r\n\r\n    case actionTypes.updateDate: {\r\n      const currentDate = action.payload as string;\r\n      if (state.dates.indexOf(currentDate) === -1) {\r\n        return { ...state };\r\n      }\r\n      return {\r\n        ...state,\r\n        currentDate,\r\n        isFirstDate: currentDate === state.dates[0],\r\n        isLastDate: currentDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    case actionTypes.setRunning: {\r\n      return {\r\n        ...state,\r\n        isRunning: action.payload as boolean,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setFirst: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setLast: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[state.dates.length - 1],\r\n        isFirstDate: false,\r\n        isLastDate: true,\r\n      };\r\n    }\r\n\r\n    case actionTypes.inc: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const lastIndex = state.dates.length - 1;\r\n      const incValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex + incValue > lastIndex\r\n          ? state.dates[lastIndex]\r\n          : state.dates[currentIndex + incValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[lastIndex],\r\n      };\r\n    }\r\n\r\n    case actionTypes.dec: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const decValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex - decValue < 0 ? state.dates[0] : state.dates[currentIndex - decValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import * as d3 from '../d3';\r\nimport { store, actions } from '../store';\r\nimport { Ticker } from './ticker.models';\r\n\r\nexport function createTicker(dates: string[]): Ticker {\r\n  store.dispatch(actions.ticker.initialize(dates));\r\n\r\n  let ticker: d3.Timer;\r\n\r\n  function start() {\r\n    ticker = d3.interval(showRace, store.getState().options.tickDuration);\r\n    store.dispatch(actions.ticker.setRunning(true));\r\n\r\n    function showRace(_: number) {\r\n      if (store.getState().ticker.isLastDate) {\r\n        if (store.getState().options.loop) {\r\n          loop();\r\n        } else {\r\n          stop();\r\n        }\r\n      } else {\r\n        store.dispatch(actions.ticker.inc());\r\n      }\r\n    }\r\n  }\r\n\r\n  function stop() {\r\n    if (ticker) {\r\n      ticker.stop();\r\n    }\r\n    store.dispatch(actions.ticker.setRunning(false));\r\n  }\r\n\r\n  function skipBack() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function loop() {\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function skipForward() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setLast());\r\n  }\r\n\r\n  function toggle() {\r\n    if (store.getState().ticker.isLastDate) {\r\n      skipBack();\r\n      start();\r\n    } else if (store.getState().ticker.isRunning) {\r\n      stop();\r\n    } else {\r\n      if (!store.getState().ticker.isFirstDate) {\r\n        // to avoid lastValue flicker\r\n        store.dispatch(actions.ticker.inc());\r\n      }\r\n      start();\r\n    }\r\n  }\r\n\r\n  function goToDate(date: string) {\r\n    store.dispatch(actions.ticker.updateDate(date));\r\n  }\r\n\r\n  return {\r\n    start,\r\n    stop,\r\n    skipBack,\r\n    loop,\r\n    skipForward,\r\n    toggle,\r\n    goToDate,\r\n  };\r\n}\r\n","import * as options from '../options';\r\nimport * as ticker from '../ticker';\r\n\r\nexport const actions = {\r\n  options,\r\n  ticker,\r\n};\r\n","import { optionsReducer, OptionsAction } from '../options';\r\nimport { tickerReducer, TickerAction } from '../ticker';\r\nimport { Action, State } from './models';\r\n\r\nexport function rootReducer(state: State, action: Action): State {\r\n  return {\r\n    options: optionsReducer(state.options, action as OptionsAction),\r\n    ticker: tickerReducer(state.ticker, action as TickerAction),\r\n  };\r\n}\r\n","import { createStore } from './store';\r\nimport { rootReducer } from './reducer';\r\n\r\nexport const store = createStore(rootReducer);\r\n","import { Action, Reducer, State, Subscriber } from './models';\r\nimport { rootReducer } from './reducer';\r\n\r\nexport function createStore(reducer: Reducer = rootReducer, preloadedState?: State) {\r\n  let state = {} as State;\r\n\r\n  if (preloadedState) {\r\n    state = preloadedState;\r\n  }\r\n\r\n  function dispatch(action: Action) {\r\n    state = reducer(state, action);\r\n    notifySubscribers();\r\n    return action;\r\n  }\r\n\r\n  function getState() {\r\n    return state;\r\n  }\r\n\r\n  const subscribers: Subscriber[] = [];\r\n\r\n  function subscribe(fn: Subscriber) {\r\n    subscribers.push(fn);\r\n    const index = subscribers.length - 1;\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        subscribers.splice(index, 1);\r\n      },\r\n    };\r\n  }\r\n\r\n  function notifySubscribers() {\r\n    subscribers.forEach((fn: Subscriber) => {\r\n      fn();\r\n    });\r\n  }\r\n\r\n  return {\r\n    getState,\r\n    dispatch,\r\n    subscribe,\r\n  };\r\n}\r\n","import * as d3 from './d3';\r\n\r\nimport { Data } from './models';\r\nimport { store } from './store';\r\nimport { formatDate } from './dates';\r\nimport { ParamFunction } from './options';\r\n\r\nexport function getColor(d: Data, showGroups: boolean, colorSeed: string) {\r\n  const nameseed = d.group && showGroups ? d.group : d.name;\r\n  const seed = nameseed + colorSeed;\r\n  return d3.hsl(random(seed) * 360, 0.75, 0.75);\r\n}\r\n\r\nexport function getIconID(d: Data) {\r\n  return 'icon-' + d.name.toLowerCase().split(' ').join('_');\r\n}\r\n\r\nexport function zeroPad(n: string, w: number) {\r\n  while (n.toString().length < w) {\r\n    n = '0' + n;\r\n  }\r\n  return n;\r\n}\r\n\r\nexport function random(seedStr: string) {\r\n  function toNumbers(s: string) {\r\n    let nums = '';\r\n    for (let i = 0; i < s.length; i++) {\r\n      nums += zeroPad(String(s.charCodeAt(i)), 3);\r\n    }\r\n    return nums;\r\n  }\r\n\r\n  const seed = toNumbers(seedStr);\r\n  const x = Math.sin(+seed) * 10000;\r\n  return x - Math.floor(x);\r\n}\r\n\r\nexport function randomString(prefix: string, n: number) {\r\n  const rnd = Array(3)\r\n    .fill(null)\r\n    .map(() => Math.random().toString(36).substr(2))\r\n    .join('');\r\n  return prefix + rnd.slice(-n);\r\n}\r\n\r\nexport function generateId(prefix = 'racingbars', n = 8) {\r\n  return randomString(prefix, n);\r\n}\r\n\r\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\r\n  let newHeight;\r\n  if (!height) {\r\n    newHeight = element.getBoundingClientRect().height;\r\n  } else if (String(height).startsWith('window')) {\r\n    const scale = +height.split('*')[1] || 1;\r\n    newHeight = window.innerHeight * scale;\r\n  } else {\r\n    newHeight = +height;\r\n  }\r\n  return newHeight > minHeight ? newHeight : minHeight;\r\n}\r\n\r\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\r\n  let newWidth;\r\n  if (!width) {\r\n    newWidth = element.getBoundingClientRect().width;\r\n  } else if (String(width).startsWith('window')) {\r\n    const scale = +width.split('*')[1] || 1;\r\n    newWidth = window.innerWidth * scale;\r\n  } else {\r\n    newWidth = +width;\r\n  }\r\n  return newWidth > minWidth ? newWidth : minWidth;\r\n}\r\n\r\nexport function getElement(className: string) {\r\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n  return element.querySelector('.' + className) as HTMLElement;\r\n}\r\n\r\nexport function showElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.style.display = 'flex';\r\n  }\r\n}\r\n\r\nexport function hideElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.style.display = 'none';\r\n  }\r\n}\r\n\r\nexport function removeElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.remove();\r\n  }\r\n}\r\n\r\nexport function addEventHandler(className: string, event: string, handler: () => void) {\r\n  const element = getElement(className);\r\n  if (element) {\r\n    element.addEventListener(event, handler);\r\n  }\r\n}\r\n\r\nexport function getText(param: string | ParamFunction, dateSlice: Data[], isDate = false): string {\r\n  if (typeof param === 'function') {\r\n    return param(\r\n      formatDate(store.getState().ticker.currentDate),\r\n      dateSlice.map((d) => ({ ...d, date: formatDate(d.date) })),\r\n      store.getState().ticker.dates.map((date) => formatDate(date)),\r\n    );\r\n  }\r\n  if (isDate) {\r\n    return formatDate(store.getState().ticker.currentDate, param);\r\n  }\r\n  return param;\r\n}\r\n","import { Data } from './models';\nimport { zeroPad } from './utils';\n\nexport const getDates = (data: Data[]) => Array.from(new Set(data.map((d) => d.date))).sort();\n\nexport function getDateString(inputDate: string | Date) {\n  const date = new Date(inputDate);\n  if (isNaN(+date)) {\n    throw new Error(`\"${inputDate}\" is not a valid date`);\n  }\n\n  const year = date.getFullYear();\n\n  let month = (1 + date.getMonth()).toString();\n  month = zeroPad(month, 2);\n\n  let day = date.getDate().toString();\n  day = zeroPad(day, 2);\n\n  return `${year}${month}${day}`;\n}\n\nexport function formatDate(dateStr: string, format = 'YYYY-MM-DD') {\n  const year = dateStr.slice(0, 4);\n  const month = dateStr.slice(4, 6);\n  const day = dateStr.slice(6, 8);\n  const date = new Date(`${year}-${month}-${day}`);\n  const weekDayIndex = String(date.getDay());\n  const monthNames: { [key: string]: string } = {\n    '01': 'Jan',\n    '02': 'Feb',\n    '03': 'Mar',\n    '04': 'Apr',\n    '05': 'May',\n    '06': 'Jun',\n    '07': 'Jul',\n    '08': 'Aug',\n    '09': 'Sep',\n    '10': 'Oct',\n    '11': 'Nov',\n    '12': 'Dec',\n  };\n\n  const weekDays: { [key: string]: string } = {\n    '0': 'Sun',\n    '1': 'Mon',\n    '2': 'Tue',\n    '3': 'Wed',\n    '4': 'Thu',\n    '5': 'Fri',\n    '6': 'Sat',\n  };\n\n  return format\n    .replace('MMM', monthNames[month])\n    .replace('DDD', weekDays[weekDayIndex])\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day);\n}\n","import { getDateString } from '../dates';\r\nimport { Options, OptionsAction } from './options.models';\r\nimport { actionTypes } from './options.actions';\r\n\r\nconst initialState: Options = {\r\n  selector: '#race',\r\n  dataShape: 'long',\r\n  fillDateGaps: false,\r\n  fillDateGapsValue: 'last',\r\n  startDate: '',\r\n  endDate: '',\r\n  colorSeed: '',\r\n  showGroups: true,\r\n  tickDuration: 500,\r\n  topN: 10,\r\n  disableClickEvents: true,\r\n  disableKeyboardEvents: false,\r\n  autorun: true,\r\n  loop: false,\r\n  injectStyles: true,\r\n  title: '',\r\n  subTitle: '',\r\n  caption: '',\r\n  dateCounter: 'MM/YYYY',\r\n  labelsOnBars: true,\r\n  labelsWidth: 100,\r\n  showIcons: false,\r\n  showControls: 'all',\r\n  showOverlays: 'none',\r\n  inputHeight: '',\r\n  inputWidth: '',\r\n  minHeight: 300,\r\n  minWidth: 500,\r\n  height: '',\r\n  width: '',\r\n  theme: 'light',\r\n};\r\n\r\nexport function optionsReducer(state = initialState, action: OptionsAction): Options {\r\n  switch (action.type) {\r\n    case actionTypes.optionsLoaded:\r\n      const startDate = action.payload.startDate ? getDateString(action.payload.startDate) : '';\r\n      const endDate = action.payload.endDate ? getDateString(action.payload.endDate) : '';\r\n      const inputHeight = action.payload.height;\r\n      const inputWidth = action.payload.width;\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n        startDate,\r\n        endDate,\r\n        inputHeight,\r\n        inputWidth,\r\n      };\r\n\r\n    case actionTypes.changeOptions:\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { formatDate, getDateString, getDates } from './dates';\r\nimport { Data, WideData } from './models';\r\nimport { getColor } from './utils';\r\nimport { store } from './store';\r\nimport { Options } from './options';\r\n\r\nexport function prepareData(rawData: Data[]) {\r\n  const options = store.getState().options;\r\n\r\n  let data = rawData\r\n    .map((d) => ({ ...d, date: getDateString(d.date) }))\r\n    .filter((d) => (options.startDate ? d.date >= options.startDate : true))\r\n    .filter((d) => (options.endDate ? d.date <= options.endDate : true));\r\n\r\n  if (options.dataShape === 'wide') {\r\n    data = wideDataToLong(data);\r\n  }\r\n\r\n  if (options.fillDateGaps) {\r\n    data = fillGaps(data, options.fillDateGaps);\r\n  }\r\n\r\n  data = data.map((d) => {\r\n    const value = isNaN(+d.value) ? 0 : +d.value;\r\n    const color = getColor(d, options.showGroups, options.colorSeed);\r\n    return { ...d, value, color };\r\n  });\r\n\r\n  data = calculateLastValues(data);\r\n\r\n  return data;\r\n}\r\n\r\nfunction calculateLastValues(data: Data[]) {\r\n  return data\r\n    .sort((a, b) => a.name.localeCompare(b.name) || a.date.localeCompare(b.date))\r\n    .reduce((acc: Data[], curr) => {\r\n      if (acc.length === 0) {\r\n        curr.lastValue = curr.value;\r\n      } else {\r\n        const last = acc[acc.length - 1];\r\n        if (curr.name === last.name) {\r\n          curr.lastValue = last.value;\r\n        } else {\r\n          curr.lastValue = curr.value;\r\n        }\r\n      }\r\n      return [...acc, curr];\r\n    }, [])\r\n    .sort((a, b) => a.date.localeCompare(b.date));\r\n}\r\n\r\nfunction wideDataToLong(wide: WideData[]) {\r\n  const long = [] as Data[];\r\n  wide.forEach((item: WideData) => {\r\n    for (const [key, value] of Object.entries(item)) {\r\n      long.push({\r\n        date: item.date,\r\n        name: key,\r\n        value: Number(value),\r\n      });\r\n    }\r\n  });\r\n  return long;\r\n}\r\n\r\nfunction fillGaps(data: Data[], period: Options['fillDateGaps']) {\r\n  if (!period) {\r\n    return data;\r\n  }\r\n\r\n  const dates = getDates(data);\r\n  const minDate = new Date(formatDate(dates[0]));\r\n  const maxDate = new Date(formatDate(dates[dates.length - 1]));\r\n\r\n  const next = {\r\n    years: (dt: Date) => {\r\n      dt.setFullYear(dt.getFullYear() + 1);\r\n    },\r\n    months: (dt: Date) => {\r\n      dt.setMonth(dt.getMonth() + 1);\r\n    },\r\n    days: (dt: Date) => {\r\n      dt.setDate(dt.getDate() + 1);\r\n    },\r\n  };\r\n  if (!next[period]) {\r\n    return data;\r\n  }\r\n\r\n  const dateRange: string[] = [];\r\n  for (const date = minDate; date < maxDate; next[period](date)) {\r\n    dateRange.push(getDateString(date));\r\n  }\r\n\r\n  dateRange.forEach((date, index) => {\r\n    if (data.filter((d) => d.date === date).length > 0) {\r\n      return;\r\n    }\r\n\r\n    const missing = data\r\n      .filter((d) => d.date === dateRange[index - 1])\r\n      .map((d) =>\r\n        // const value = {\r\n        //   last: d.value,\r\n        //   zero: 0,\r\n        // }\r\n        ({\r\n          ...d,\r\n          date,\r\n          // value: value[fillDateGapsValue],\r\n        }),\r\n      );\r\n\r\n    data.push(...missing);\r\n  });\r\n\r\n  return data;\r\n}\r\n\r\nexport function getDateSlice(data: Data[], date: string) {\r\n  return data\r\n    .filter((d) => d.date === date && !isNaN(d.value))\r\n    .sort((a, b) => b.value - a.value)\r\n    .map((d, i) => ({ ...d, rank: i }));\r\n}\r\n","// This file is auto-generated and will be over-written!\n// Please do NOT edit this file directly\n// You may edit files in this folder instead: src\\lib\\css\n\nexport const styles = `#selector text{\r font-size:16px;\r font-family:Open Sans, sans-serif;\r}\r\r#selector text.title{\r font-size:24px;\r font-weight:500;\r}\r\r#selector text.subTitle{\r font-weight:500;\r}\r\r#selector text.caption{\r font-weight:400;\r font-size:24px;\r}\r\r#selector text.label{\r font-weight:600;\r}\r\r#selector text.valueLabel{\r font-weight:300;\r}\r\r#selector text.dateCounterText{\r font-size:64px;\r font-weight:700;\r}\r\r#selector .xAxis .tick:nth-child(2) text{\r text-anchor:start;\r}\r\r#selector .tick line{\r shape-rendering:CrispEdges;\r}\r\r#selector path.domain{\r display:none;\r}\r\r#selector{\r position:relative;\r}\r\r#selector .controls{\r /* width and right are set dynamically in renderer.ts */\r position:absolute;\r top:0;\r display:flex;\r}\r\r#selector .controls div,\r#selector .overlay div{\r cursor:pointer;\r font-size:24px;\r font-weight:700;\r width:38px;\r height:38px;\r -moz-border-radius:5px;\r -webkit-border-radius:5px;\r border-radius:5px;\r margin:5px;\r text-align:center;\r}\r\r#selector .controls svg{\r margin:5px auto;\r width:28px;\r height:28px;\r}\r\r#selector .overlay{\r position:absolute;\r top:0;\r left:0;\r width:100%;\r height:100%;\r display:flex;\r align-items:center;\r justify-content:center;\r}\r#selector .overlay div{\r position:relative;\r display:flex;\r align-items:center;\r justify-content:center;\r width:200px;\r height:200px;\r -moz-border-radius:100px;\r -webkit-border-radius:100px;\r border-radius:100px;\r}\r#selector .overlay svg{\r height:50%;\r width:50%;\r}\r`;\n\nexport const themes = {\n\"dark\": `#selector{\r background-color:#313639;\r}\r\r#selector text.title{\r fill:#fafafa;\r}\r\r#selector text.subTitle{\r fill:#cccccc;\r}\r\r#selector text.dateCounterText{\r fill:#cccccc;\r opacity:1;\r}\r\r#selector text.caption{\r fill:#cccccc;\r}\r\r#selector .halo{\r fill:#313639;\r stroke:#313639;\r stroke-width:10;\r stroke-linejoin:round;\r opacity:1;\r}\r\r#selector text.label{\r fill:#313639;\r}\r\r#selector text.valueLabel{\r fill:#fafafa;\r}\r\r#selector .tick text{\r fill:#cccccc;\r}\r\r#selector .tick line{\r shape-rendering:CrispEdges;\r stroke:#dddddd;\r}\r\r#selector .tick line.origin{\r stroke:#aaaaaa;\r}\r\r#selector .controls div,\r#selector .overlay div{\r color:#ffffff;\r background:#777777;\r border:1px solid black;\r opacity:0.5;\r}\r\r#selector .controls div:hover,\r#selector .overlay div:hover{\r background:#aaaaaa;\r color:black;\r}\r\r#selector .overlay{\r background-color:black;\r opacity:0.7;\r}\r`,\n\"light\": `/* #selector{\r background-color:#ffffff;\r}\r\r#selector text.title{\r fill:#fafafa;\r} */\r\r#selector text.subTitle{\r fill:#777777;\r}\r\r#selector text.dateCounterText{\r fill:#bbbbbb;\r opacity:1;\r}\r\r#selector text.caption{\r fill:#777777;\r}\r\r#selector .halo{\r fill:#ffffff;\r stroke:#ffffff;\r stroke-width:10;\r stroke-linejoin:round;\r opacity:1;\r}\r\r#selector text.label{\r fill:#000000;\r}\r\r#selector text.valueLabel{\r fill:#000000;\r}\r\r#selector .tick text{\r fill:#777777;\r}\r\r#selector .tick line{\r shape-rendering:CrispEdges;\r stroke:#dddddd;\r}\r\r#selector .tick line.origin{\r stroke:#aaaaaa;\r}\r\r#selector .controls div,\r#selector .overlay div{\r color:#ffffff;\r background:#777777;\r border:1px solid black;\r opacity:0.5;\r}\r\r#selector .controls div:hover,\r#selector .overlay div:hover{\r background:#aaaaaa;\r color:black;\r}\r\r#selector .overlay{\r background-color:black;\r opacity:0.7;\r}\r`,\n};\n","import { elements } from './elements';\nimport { store } from './store';\nimport { Ticker } from './ticker';\nimport { addEventHandler, hideElement } from './utils';\nimport { formatDate } from './dates';\nimport { DOMCustomEvent } from './models';\n\nexport function registerEvents(element: HTMLElement, ticker: Ticker) {\n  registerControlButtonEvents();\n  registerOverlayEvents();\n  registerClickEvents();\n  registerKeyboardEvents();\n\n  function registerControlButtonEvents() {\n    addEventHandler(elements.skipBack, 'click', ticker.skipBack);\n    addEventHandler(elements.play, 'click', ticker.toggle);\n    addEventHandler(elements.pause, 'click', ticker.toggle);\n    addEventHandler(elements.skipForward, 'click', ticker.skipForward);\n  }\n\n  function registerOverlayEvents() {\n    addEventHandler(elements.overlayPlay, 'click', () => {\n      hideElement(elements.overlay);\n      ticker.start();\n    });\n    addEventHandler(elements.overlayRepeat, 'click', () => {\n      hideElement(elements.overlay);\n      ticker.loop();\n      ticker.start();\n    });\n  }\n\n  function registerClickEvents() {\n    if (!store.getState().options.disableClickEvents) {\n      const svg = element.querySelector('svg') as SVGSVGElement;\n      svg.addEventListener('click', ticker.toggle);\n      element.addEventListener('dblclick', ticker.skipForward);\n    }\n  }\n\n  function registerKeyboardEvents() {\n    if (!store.getState().options.disableKeyboardEvents) {\n      document.addEventListener('keypress', function (e) {\n        const keyCodes = {\n          spacebar: 32,\n          a: 97,\n          d: 100,\n          s: 115,\n        };\n\n        // TODO: keyCode is deprecated\n        switch (e.keyCode) {\n          case keyCodes.spacebar:\n            ticker.toggle();\n            break;\n          case keyCodes.a:\n            ticker.skipBack();\n            break;\n          case keyCodes.s:\n            ticker.toggle();\n            break;\n          case keyCodes.d:\n            ticker.skipForward();\n            break;\n        }\n      });\n    }\n  }\n}\n\nfunction dispatchDOMEvent(element: HTMLElement, currentDate: string) {\n  element.dispatchEvent(\n    new CustomEvent('racingBars/dateChanged', {\n      bubbles: true,\n      detail: {\n        date: formatDate(currentDate),\n        isFirst: store.getState().ticker.isFirstDate,\n        isLast: store.getState().ticker.isLastDate,\n      },\n    } as DOMCustomEvent),\n  );\n}\n\nexport function DOMEventSubscriber(element: HTMLElement) {\n  let lastDate = '';\n  return function () {\n    const currentDate = store.getState().ticker.currentDate;\n    if (currentDate !== lastDate) {\n      dispatchDOMEvent(element, currentDate);\n      lastDate = currentDate;\n    }\n  };\n}\n","export const elements = {\r\n  controls: 'controls',\r\n  skipBack: 'skipBack',\r\n  play: 'play',\r\n  pause: 'pause',\r\n  skipForward: 'skipForward',\r\n  overlay: 'overlay',\r\n  overlayPlay: 'overlayPlay',\r\n  overlayRepeat: 'overlayRepeat',\r\n};\r\n","import * as d3 from './d3';\n\nexport function loadData(URL: string, type: 'json' | 'csv' | 'tsv' | 'xml' = 'json') {\n  switch (type) {\n    case 'json':\n      return d3.json(URL);\n    case 'csv':\n      return d3.csv(URL);\n    case 'tsv':\n      return d3.tsv(URL);\n    case 'xml':\n      return d3.xml(URL);\n    default:\n      throw new Error(`Unsupported data type: ${type}`);\n  }\n}\n","import { prepareData } from './data-utils';\r\nimport { getDates, getDateString, formatDate } from './dates';\r\nimport { Data, WideData } from './models';\r\nimport { createRenderer } from './renderer';\r\nimport { createTicker } from './ticker';\r\nimport { styleInject } from './styles';\r\nimport { actions, store } from './store';\r\nimport { Options, RequiredOptions } from './options';\r\nimport { registerEvents, DOMEventSubscriber } from './events';\r\nimport { createScroller } from './scroller';\r\n\r\nexport function race(data: Data[] | WideData[], options: Options | RequiredOptions) {\r\n  store.dispatch(actions.options.optionsLoaded(options));\r\n\r\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n  if (!element) {\r\n    throw new Error('Cannot find element with this selector: ' + store.getState().options.selector);\r\n  }\r\n\r\n  if (store.getState().options.injectStyles) {\r\n    styleInject(store.getState().options.selector, 'top');\r\n  }\r\n\r\n  const preparedData = prepareData(data as Data[]);\r\n\r\n  const dates = getDates(preparedData);\r\n\r\n  const ticker = createTicker(dates);\r\n\r\n  const renderer = createRenderer(preparedData);\r\n  renderer.renderInitalView();\r\n\r\n  store.subscribe(renderer.renderFrame);\r\n  store.subscribe(DOMEventSubscriber(element));\r\n\r\n  ticker.start();\r\n\r\n  if (!store.getState().options.autorun) {\r\n    ticker.stop();\r\n  }\r\n\r\n  registerEvents(element, ticker);\r\n  window.addEventListener('resize', resize);\r\n\r\n  function resize() {\r\n    renderer.resize();\r\n    registerEvents(element, ticker);\r\n  }\r\n\r\n  return {\r\n    // TODO: validate user input\r\n    start: () => {\r\n      if (!store.getState().ticker.isRunning) {\r\n        ticker.start();\r\n      }\r\n    },\r\n    stop: () => {\r\n      ticker.stop();\r\n    },\r\n    rewind: () => {\r\n      ticker.skipBack();\r\n    },\r\n    fastforward: () => {\r\n      ticker.skipForward();\r\n    },\r\n    loop: () => {\r\n      ticker.loop();\r\n    },\r\n    inc: (value = 1) => {\r\n      store.dispatch(actions.ticker.inc(value));\r\n    },\r\n    dec: (value = 1) => {\r\n      store.dispatch(actions.ticker.dec(value));\r\n    },\r\n    getDate: () => store.getState().ticker.currentDate,\r\n    setDate: (inputDate: string | Date) => {\r\n      store.dispatch(actions.ticker.updateDate(getDateString(inputDate)));\r\n    },\r\n    getAllDates: () => dates.map((date: string) => formatDate(date)),\r\n    createScroller: () => {\r\n      createScroller(element);\r\n    },\r\n  };\r\n}\r\n","import { store } from '../store';\r\nimport { styles, themes } from './generated-styles';\r\n\r\n// modifed from https://github.com/egoist/style-inject\r\nexport function styleInject(selector: string, insertAt = 'top') {\r\n  let css = styles + (themes as any)[store.getState().options.theme];\r\n\r\n  if (!css || typeof document === 'undefined') {\r\n    return;\r\n  }\r\n\r\n  // replace with selector\r\n  css = css.split('#selector').join(selector);\r\n\r\n  const head = document.head || document.getElementsByTagName('head')[0];\r\n  const style = document.createElement('style') as HTMLStyleElement | any;\r\n  style.type = 'text/css';\r\n\r\n  if (insertAt === 'top') {\r\n    if (head.firstChild) {\r\n      head.insertBefore(style, head.firstChild);\r\n    } else {\r\n      head.appendChild(style);\r\n    }\r\n  } else {\r\n    head.appendChild(style);\r\n  }\r\n\r\n  if (style.styleSheet) {\r\n    style.styleSheet.cssText = css;\r\n  } else {\r\n    style.appendChild(document.createTextNode(css));\r\n  }\r\n}\r\n","import * as d3 from './d3';\r\n\r\nimport { icons } from './icons';\r\nimport { elements } from './elements';\r\nimport { Data, Renderer } from './models';\r\nimport { store } from './store';\r\nimport {\r\n  getHeight,\r\n  getWidth,\r\n  getElement,\r\n  hideElement,\r\n  showElement,\r\n  getText,\r\n  getColor,\r\n  getIconID,\r\n} from './utils';\r\nimport { getDateSlice } from './data-utils';\r\n\r\nexport function createRenderer(data: Data[]): Renderer {\r\n  let margin: { top: number; right: number; bottom: number; left: number };\r\n  let svg: any;\r\n  let x: d3.ScaleLinear<number, number>;\r\n  let y: d3.ScaleLinear<number, number>;\r\n  let xAxis: d3.Axis<number | { valueOf(): number }>;\r\n  const titlePadding = 5;\r\n  let barPadding: number;\r\n  let labelPadding: number;\r\n  let barHeight: number;\r\n  let barHalfHeight: number;\r\n  let defs: any;\r\n  let iconSize: number;\r\n  let iconSpace: number;\r\n  let titleText: any;\r\n  let subTitleText: any;\r\n  let captionText: any;\r\n  let dateCounterText: any;\r\n  let labelX: number | ((d: Data) => number);\r\n  let barY: (d: Data) => number;\r\n  let height: number;\r\n  let width: number;\r\n\r\n  function renderInitalView() {\r\n    const {\r\n      selector,\r\n      title,\r\n      subTitle,\r\n      caption,\r\n      dateCounter,\r\n      labelsOnBars,\r\n      showIcons,\r\n      labelsWidth,\r\n      inputHeight,\r\n      inputWidth,\r\n      minHeight,\r\n      minWidth,\r\n      topN,\r\n    } = store.getState().options;\r\n\r\n    const TotalDateSlice = getDateSlice(data, store.getState().ticker.currentDate);\r\n    const dateSlice = TotalDateSlice.slice(0, store.getState().options.topN);\r\n    const element = document.querySelector(selector) as HTMLElement;\r\n    element.innerHTML = '';\r\n\r\n    height = getHeight(element, minHeight, inputHeight);\r\n    width = getWidth(element, minWidth, inputWidth);\r\n\r\n    renderInitialFrame();\r\n    renderControls();\r\n    renderOverlays();\r\n    updateControls();\r\n\r\n    function renderInitialFrame() {\r\n      const groups = Array.from(new Set(data.map((d) => d.group)))\r\n        .filter(Boolean)\r\n        .sort() as string[];\r\n      const showGroups = store.getState().options.showGroups && groups.length > 0;\r\n      const groupsArea = showGroups ? 40 : 0;\r\n\r\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\r\n\r\n      margin = {\r\n        top: 80 + groupsArea,\r\n        right: 0,\r\n        bottom: 5,\r\n        left: 0 + labelsArea,\r\n      };\r\n\r\n      x = d3\r\n        .scaleLinear()\r\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\r\n        .range([margin.left, width - margin.right - 65]);\r\n\r\n      y = d3\r\n        .scaleLinear()\r\n        .domain([topN, 0])\r\n        .range([height - margin.bottom, margin.top]);\r\n\r\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\r\n      labelPadding = 8;\r\n      barHeight = y(1) - y(0) - barPadding;\r\n      barHalfHeight = (y(1) - y(0)) / 2 + 1;\r\n      barY = (d: Data) => y(d.rank as number) + 5;\r\n      iconSize = showIcons ? barHeight * 0.9 : 0;\r\n      iconSpace = showIcons ? iconSize + labelPadding : 0;\r\n      labelX = labelsOnBars\r\n        ? (d: Data) => x(d.value) - labelPadding - iconSpace\r\n        : margin.left - labelPadding;\r\n\r\n      svg = d3 //\r\n        .select(selector)\r\n        .append('svg')\r\n        .attr('width', width)\r\n        .attr('height', height);\r\n\r\n      titleText = svg //\r\n        .append('text')\r\n        .attr('class', 'title')\r\n        .attr('x', titlePadding)\r\n        .attr('y', 24)\r\n        .html(getText(title, TotalDateSlice));\r\n\r\n      subTitleText = svg //\r\n        .append('text')\r\n        .attr('class', 'subTitle')\r\n        .attr('x', titlePadding)\r\n        .attr('y', 55)\r\n        .html(getText(subTitle, TotalDateSlice));\r\n\r\n      if (showGroups) {\r\n        const groupX = d3\r\n          .scaleLinear()\r\n          .domain([groups.length, 0])\r\n          .range([width - margin.right, margin.left]);\r\n\r\n        svg\r\n          .selectAll('rect.group-color')\r\n          .data(groups)\r\n          .enter()\r\n          .append('rect')\r\n          .attr('class', 'group-color')\r\n          .attr('width', 10)\r\n          .attr('height', 10)\r\n          .attr('x', (_d: string, i: number) => groupX(i))\r\n          .attr('y', 75)\r\n          .style('fill', (d: string) =>\r\n            getColor({ group: d } as Data, true, store.getState().options.colorSeed).toString(),\r\n          );\r\n\r\n        svg\r\n          .selectAll('text.group')\r\n          .data(groups)\r\n          .enter()\r\n          .append('text')\r\n          .attr('class', 'group')\r\n          .attr('x', (_d: string, i: number) => groupX(i) + 20)\r\n          .attr('y', 75 + 10)\r\n          .html((d: string) => d);\r\n      }\r\n\r\n      xAxis = d3\r\n        .axisTop(x)\r\n        .ticks(width > 500 ? 5 : 2)\r\n        .tickSize(-(height - (margin.top + margin.bottom)))\r\n        .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n));\r\n\r\n      svg\r\n        .append('g')\r\n        .attr('class', 'axis xAxis')\r\n        .attr('transform', `translate(0, ${margin.top})`)\r\n        .call(xAxis)\r\n        .selectAll('.tick line')\r\n        .classed('origin', (d: number) => d === 0);\r\n\r\n      svg\r\n        .selectAll('rect.bar')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('rect')\r\n        .attr('class', 'bar')\r\n        .attr('x', x(0) + 1)\r\n        .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n        .attr('y', barY)\r\n        .attr('height', barHeight)\r\n        .style('fill', (d: Data) => d.color);\r\n\r\n      svg\r\n        .selectAll('text.label')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('text')\r\n        .attr('class', 'label')\r\n        .attr('x', labelX)\r\n        .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n        .style('text-anchor', 'end')\r\n        .html((d: Data) => d.name);\r\n\r\n      svg\r\n        .selectAll('text.valueLabel')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('text')\r\n        .attr('class', 'valueLabel')\r\n        .attr('x', (d: Data) => x(d.value) + 5)\r\n        .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n        .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\r\n\r\n      if (showIcons) {\r\n        defs = svg.append('svg:defs');\r\n\r\n        defs\r\n          .selectAll('svg')\r\n          .data(dateSlice, (d: Data) => d.name)\r\n          .enter()\r\n          .append('svg:pattern')\r\n          .attr('class', 'svgpattern')\r\n          .attr('id', getIconID)\r\n          .attr('width', iconSize)\r\n          .attr('height', iconSize)\r\n          .append('svg:image')\r\n          .attr('xlink:href', (d: Data) => d.icon)\r\n          .attr('width', iconSize)\r\n          .attr('height', iconSize)\r\n          .attr('x', 0)\r\n          .attr('y', 0);\r\n\r\n        svg\r\n          .selectAll('circle')\r\n          .data(dateSlice, (d: Data) => d.name)\r\n          .enter()\r\n          .append('circle')\r\n          .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n          .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight)\r\n          .attr('r', iconSize / 2)\r\n          .style('fill', 'transparent')\r\n          .style('fill', (d: Data) => `url(#${getIconID(d)})`);\r\n      }\r\n\r\n      dateCounterText = svg\r\n        .append('text')\r\n        .attr('class', 'dateCounterText')\r\n        .attr('x', width - margin.right - barPadding)\r\n        .attr('y', height - 40)\r\n        .style('text-anchor', 'end')\r\n        .html(getText(dateCounter, TotalDateSlice, true))\r\n        .call(halo);\r\n\r\n      captionText = svg\r\n        .append('text')\r\n        .attr('class', 'caption')\r\n        .attr('x', width - margin.right - barPadding - 10)\r\n        .attr('y', height - margin.bottom - barPadding)\r\n        .style('text-anchor', 'end')\r\n        .html(getText(caption, TotalDateSlice));\r\n    }\r\n\r\n    function renderControls() {\r\n      const controlIcons = [\r\n        { skipBack: icons.skipBack },\r\n        { play: icons.play },\r\n        { pause: icons.pause },\r\n        { skipForward: icons.skipForward },\r\n      ];\r\n\r\n      const elementWidth = element.getBoundingClientRect().width;\r\n\r\n      d3.select(selector)\r\n        .append('div')\r\n        .classed('controls', true)\r\n        .style('width', width)\r\n        .style('right', elementWidth - width + margin.right + barPadding + 'px')\r\n        .selectAll('div')\r\n        .data(controlIcons)\r\n        .enter()\r\n        .append('div')\r\n        .html((d) => Object.values(d)[0] as string)\r\n        .attr('class', (d) => Object.keys(d)[0]);\r\n\r\n      if (store.getState().options.showControls === 'play') {\r\n        hideElement(elements.skipBack);\r\n        hideElement(elements.skipForward);\r\n      }\r\n      if (store.getState().options.showControls === 'none') {\r\n        hideElement(elements.controls);\r\n      }\r\n    }\r\n\r\n    function renderOverlays() {\r\n      const overlayIcons = [\r\n        { overlayPlay: icons.overlayPlay },\r\n        { overlayRepeat: icons.overlayRepeat },\r\n      ];\r\n\r\n      d3.select(selector)\r\n        .append('div')\r\n        .classed('overlay', true)\r\n        .style('minHeight', minHeight + 'px')\r\n        .style('minWidth', minWidth + 'px')\r\n        .selectAll('div')\r\n        .data(overlayIcons)\r\n        .enter()\r\n        .append('div')\r\n        .html((d) => Object.values(d)[0] as string)\r\n        .attr('class', (d) => Object.keys(d)[0]);\r\n    }\r\n  }\r\n\r\n  function renderFrame() {\r\n    if (!x) {\r\n      return;\r\n    }\r\n\r\n    const { tickDuration, topN, title, subTitle, caption, dateCounter } = store.getState().options;\r\n    const TotalDateSlice = getDateSlice(data, store.getState().ticker.currentDate);\r\n    const dateSlice = TotalDateSlice.slice(0, store.getState().options.topN);\r\n\r\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\r\n\r\n    svg //\r\n      .select('.xAxis')\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .call(xAxis);\r\n\r\n    const bars = svg //\r\n      .selectAll('.bar')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    bars\r\n      .enter()\r\n      .append('rect')\r\n      .attr('class', (d: Data) => `bar ${d.name.replace(/\\s/g, '_')}`)\r\n      .attr('x', x(0) + 1)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .attr('height', barHeight)\r\n      .style('fill', (d: Data) => d.color)\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', barY);\r\n\r\n    bars\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', barY);\r\n\r\n    bars\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    const labels = svg //\r\n      .selectAll('.label')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    labels\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'label')\r\n      .attr('x', labelX)\r\n      .attr('y', () => y(topN + 1) + 5 + barHalfHeight)\r\n      .style('text-anchor', 'end')\r\n      .html((d: Data) => d.name)\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n    labels\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', labelX)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n    labels\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', labelX)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    const valueLabels = svg //\r\n      .selectAll('.valueLabel')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    valueLabels\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'valueLabel')\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight);\r\n\r\n    valueLabels\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', (d: Data) => barY(d) + barHalfHeight)\r\n      .tween('text', function (d: Data) {\r\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\r\n        return function (t: number) {\r\n          this.textContent = d3.format(',')(i(t));\r\n        };\r\n      });\r\n\r\n    valueLabels\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    if (store.getState().options.showIcons) {\r\n      const iconPatterns = defs.selectAll('.svgpattern').data(dateSlice, (d: Data) => d.name);\r\n\r\n      iconPatterns\r\n        .enter()\r\n        .append('svg:pattern')\r\n        .attr('class', 'svgpattern')\r\n        .attr('id', getIconID)\r\n        .attr('width', iconSize)\r\n        .attr('height', iconSize)\r\n        .append('svg:image')\r\n        .attr('xlink:href', (d: Data) => d.icon)\r\n        .attr('width', iconSize)\r\n        .attr('height', iconSize)\r\n        .style('z-index', '99')\r\n        .attr('x', 0)\r\n        .attr('y', 0);\r\n\r\n      iconPatterns.exit().remove();\r\n\r\n      const icons = svg //\r\n        .selectAll('circle')\r\n        .data(dateSlice, (d: Data) => d.name);\r\n\r\n      icons\r\n        .enter()\r\n        .append('circle')\r\n        .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n        .attr('cy', () => y(topN + 1) + iconSize + barHalfHeight)\r\n        .attr('r', iconSize / 2)\r\n        .style('z-index', '99')\r\n        .style('fill', 'transparent')\r\n        .style('fill', (d: Data) => `url(#${getIconID(d)})`)\r\n        .transition()\r\n        .duration(tickDuration)\r\n        .ease(d3.easeLinear)\r\n        .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight);\r\n\r\n      icons\r\n        .transition()\r\n        .duration(tickDuration)\r\n        .ease(d3.easeLinear)\r\n        .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n        .attr('cy', (d: Data) => y(d.rank as number) + barHalfHeight);\r\n\r\n      icons\r\n        .exit()\r\n        .transition()\r\n        .duration(tickDuration)\r\n        .ease(d3.easeLinear)\r\n        .attr('cx', (d: Data) => x(d.value) - iconSize / 2 - labelPadding)\r\n        .attr('cy', () => y(topN + 1) + iconSize + barHalfHeight)\r\n        .remove();\r\n    }\r\n\r\n    titleText.html(getText(title, TotalDateSlice));\r\n    subTitleText.html(getText(subTitle, TotalDateSlice));\r\n    captionText.html(getText(caption, TotalDateSlice));\r\n    dateCounterText.html(getText(dateCounter, TotalDateSlice, true)).call(halo);\r\n    updateControls();\r\n  }\r\n\r\n  function resize() {\r\n    if (\r\n      (!store.getState().options.inputHeight && !store.getState().options.inputWidth) ||\r\n      String(store.getState().options.inputHeight).startsWith('window') ||\r\n      String(store.getState().options.inputWidth).startsWith('window')\r\n    ) {\r\n      const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n\r\n      height = getHeight(\r\n        element,\r\n        store.getState().options.minHeight,\r\n        store.getState().options.inputHeight,\r\n      );\r\n      width = getWidth(\r\n        element,\r\n        store.getState().options.minWidth,\r\n        store.getState().options.inputWidth,\r\n      );\r\n\r\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\r\n      renderInitalView();\r\n      renderFrame();\r\n      updateControls();\r\n      element.style.position = currentPosition;\r\n    }\r\n  }\r\n\r\n  function updateControls() {\r\n    const showOverlays = store.getState().options.showOverlays;\r\n\r\n    if (store.getState().ticker.isRunning) {\r\n      showElement(elements.pause);\r\n      hideElement(elements.play);\r\n    } else {\r\n      showElement(elements.play);\r\n      hideElement(elements.pause);\r\n    }\r\n\r\n    if (\r\n      store.getState().ticker.isFirstDate &&\r\n      (showOverlays === 'all' || showOverlays === 'play') &&\r\n      !store.getState().ticker.isRunning\r\n    ) {\r\n      getElement(elements.controls).style.visibility = 'hidden';\r\n      showElement(elements.overlay);\r\n      showElement(elements.overlayPlay);\r\n      hideElement(elements.overlayRepeat);\r\n    } else if (\r\n      store.getState().ticker.isLastDate &&\r\n      (showOverlays === 'all' || showOverlays === 'repeat') &&\r\n      !(store.getState().options.loop && store.getState().ticker.isRunning)\r\n    ) {\r\n      getElement(elements.controls).style.visibility = 'hidden';\r\n      showElement(elements.overlay);\r\n      showElement(elements.overlayRepeat);\r\n      hideElement(elements.overlayPlay);\r\n    } else {\r\n      getElement(elements.controls).style.visibility = 'unset';\r\n      getElement(elements.overlay).style.display = 'none';\r\n    }\r\n  }\r\n\r\n  function halo(text: any) {\r\n    svg //\r\n      .selectAll('.halo')\r\n      .remove();\r\n\r\n    text\r\n      .select(function () {\r\n        return this.parentNode.insertBefore(this.cloneNode(true), this);\r\n      })\r\n      .classed('halo', true);\r\n  }\r\n\r\n  return {\r\n    renderInitalView,\r\n    renderFrame,\r\n    resize,\r\n  };\r\n}\r\n","import { store, actions } from './store';\r\n\r\nexport function createScroller(element: HTMLElement) {\r\n  const dates = store.getState().ticker.dates;\r\n  prepareDOM();\r\n\r\n  const step = document.body.clientHeight / dates.length;\r\n\r\n  subscribeToEvents();\r\n\r\n  function prepareDOM() {\r\n    element.style.position = 'fixed';\r\n    element.style.top = '0';\r\n\r\n    const scrollElement = document.createElement('div');\r\n    scrollElement.style.height = window.innerHeight * 10 + 'px';\r\n    document.body.appendChild(scrollElement);\r\n  }\r\n\r\n  function subscribeToEvents() {\r\n    window.addEventListener('scroll', goToDate);\r\n    // element.addEventListener(\"dateChanged\", scrollToPosition);\r\n  }\r\n\r\n  // function scrollToPosition(e: CustomEvent) {\r\n  //   let currentDate = getDateString(e.detail.date);\r\n  //   let index = dates.indexOf(currentDate);\r\n  //   ignoreNextScrollEvent = true;\r\n  //   window.scroll({\r\n  //     top: index * step,\r\n  //     behavior: \"smooth\",\r\n  //   });\r\n  // }\r\n\r\n  function goToDate() {\r\n    const index = Math.ceil(window.pageYOffset / step);\r\n    if (index < dates.length) {\r\n      store.dispatch(actions.ticker.updateDate(dates[index]));\r\n    } else {\r\n      store.dispatch(actions.ticker.setLast());\r\n    }\r\n  }\r\n}\r\n"],"names":["actionTypes","optionsLoaded","changeOptions","optionsChanged","options","type","payload","initialize","updateDate","setRunning","setFirst","setLast","inc","dec","initialState","isRunning","currentDate","isFirstDate","isLastDate","dates","tickerReducer","state","action","indexOf","length","currentIndex","lastIndex","incValue","newDate","decValue","createTicker","ticker","start","d3","_","store","getState","loop","stop","dispatch","actions","tickDuration","skipBack","skipForward","toggle","goToDate","date","running","value","rootReducer","optionsReducer","reducer","preloadedState","subscribers","forEach","fn","subscribe","push","index","unsubscribe","splice","createStore","getColor","d","showGroups","colorSeed","seed","s","nums","i","zeroPad","String","charCodeAt","toNumbers","group","name","x","Math","sin","floor","getIconID","toLowerCase","split","join","n","w","toString","getHeight","element","minHeight","height","newHeight","startsWith","scale","window","innerHeight","getBoundingClientRect","getWidth","minWidth","width","newWidth","innerWidth","getElement","className","document","querySelector","selector","showElement","style","display","hideElement","addEventHandler","event","handler","addEventListener","getText","param","dateSlice","isDate","formatDate","map","getDates","data","Array","from","Set","sort","getDateString","inputDate","Date","isNaN","Error","year","getFullYear","month","getMonth","getDate","dateStr","format","slice","day","weekDayIndex","getDay","replace","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","dataShape","fillDateGaps","fillDateGapsValue","startDate","endDate","topN","disableClickEvents","disableKeyboardEvents","autorun","injectStyles","title","subTitle","caption","dateCounter","labelsOnBars","labelsWidth","showIcons","showControls","showOverlays","inputHeight","inputWidth","theme","getDateSlice","filter","a","b","rank","themes","dark","light","registerEvents","e","keyCode","prefix","fill","random","substr","randomString","URL","insertAt","css","head","getElementsByTagName","createElement","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","styleInject","preparedData","rawData","long","item","Object","entries","Number","period","minDate","maxDate","next","years","dt","setFullYear","months","setMonth","days","setDate","dateRange","missing","fillGaps","localeCompare","reduce","acc","curr","lastValue","last","calculateLastValues","color","prepareData","renderer","margin","svg","y","xAxis","barPadding","labelPadding","barHeight","barHalfHeight","defs","iconSize","iconSpace","titleText","subTitleText","captionText","dateCounterText","labelX","barY","renderInitalView","overlayIcons","controlIcons","elementWidth","TotalDateSlice","innerHTML","groups","Boolean","top","right","bottom","left","domain","range","append","attr","html","groupX","selectAll","enter","_d","ticks","tickSize","tickFormat","call","classed","abs","text","icon","halo","renderInitialFrame","play","pause","values","keys","overlayPlay","overlayRepeat","updateControls","renderFrame","select","transition","duration","ease","bars","exit","remove","labels","valueLabels","tween","t","this","textContent","iconPatterns","icons","visibility","parentNode","cloneNode","resize","currentPosition","position","createRenderer","lastDate","dispatchEvent","CustomEvent","bubbles","detail","isFirst","isLast","dispatchDOMEvent","DOMEventSubscriber","rewind","fastforward","getAllDates","createScroller","scrollElement","body","prepareDOM","step","clientHeight","ceil","pageYOffset"],"mappings":"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"}