{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/utils.ts","../../src/lib/dates.ts","../../src/lib/load-data.ts","../../src/lib/racing-bars.ts","../../src/lib/render.ts","../../src/lib/ticker.ts","../../src/lib/data-utils.ts"],"sourcesContent":["import { Data } from './models';\n\nexport function getColor(d: Data, disableGroupColors: boolean, colorSeed: string) {\n  const nameseed = d.group && !disableGroupColors ? d.group : d.name;\n  const seed = nameseed + colorSeed;\n  return d3.hsl(random(seed) * 360, 0.75, 0.75);\n}\n\nexport function zeroPad(n: string, w: number) {\n  while (n.toString().length < w) {\n    n = '0' + n;\n  }\n  return n;\n}\n\nexport function random(seedStr: string) {\n  function toNumbers(s: string) {\n    let nums = '';\n    for (let i = 0; i < s.length; i++) {\n      nums += zeroPad(String(s.charCodeAt(i)), 3);\n    }\n    return nums;\n  }\n\n  const seed = toNumbers(seedStr);\n  const x = Math.sin(+seed) * 10000;\n  return x - Math.floor(x);\n}\n\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\n  let newHeight;\n  if (!height) {\n    newHeight = element.getBoundingClientRect().height;\n  } else if (String(height).startsWith('window')) {\n    const scale = +height.split('*')[1] || 1;\n    newHeight = window.innerHeight * scale;\n  } else {\n    newHeight = +height;\n  }\n  return newHeight > minHeight ? newHeight : minHeight;\n}\n\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\n  let newWidth;\n  if (!width) {\n    newWidth = element.getBoundingClientRect().width;\n  } else if (String(width).startsWith('window')) {\n    const scale = +width.split('*')[1] || 1;\n    newWidth = window.innerWidth * scale;\n  } else {\n    newWidth = +width;\n  }\n  return newWidth > minWidth ? newWidth : minWidth;\n}\n\n","import { Data } from './models';\nimport { zeroPad } from './utils';\n\nexport function getDates(data: Data[]) {\n  const uniqueDates = new Set<string>();\n  data.forEach(d => {\n    uniqueDates.add(d.date);\n  });\n  return Array.from(uniqueDates).sort();\n}\n\nexport function filterDates(data: Data[], startDate: string, endDate: string) {\n  return data\n    .filter(d => (startDate ? d.date >= startDate : true))\n    .filter(d => (endDate ? d.date <= endDate : true));\n}\n\nexport function getDateString(inputDate: string | Date) {\n  const date = new Date(inputDate);\n  if (isNaN(+date)) {\n    throw new Error(`\"${inputDate}\" is not a valid date`);\n  }\n\n  const year = date.getFullYear();\n\n  let month = (1 + date.getMonth()).toString();\n  month = zeroPad(month, 2);\n\n  let day = date.getDate().toString();\n  day = zeroPad(day, 2);\n\n  return `${year}${month}${day}`;\n}\n\nexport function formatDate(dateStr: string, format: string) {\n  const year = dateStr.slice(0, 4);\n  const month = dateStr.slice(4, 6);\n  const day = dateStr.slice(6, 8);\n  const date = new Date(`${year}-${month}-${day}`);\n  const weekDayIndex = date.getDay();\n  const monthNames: any = {\n    '01': 'Jan',\n    '02': 'Feb',\n    '03': 'Mar',\n    '04': 'Apr',\n    '05': 'May',\n    '06': 'Jun',\n    '07': 'Jul',\n    '08': 'Aug',\n    '09': 'Sep',\n    '10': 'Oct',\n    '11': 'Nov',\n    '12': 'Dec'\n  };\n\n  const weekDays: any = {\n    '0': 'Sun',\n    '1': 'Mon',\n    '2': 'Tue',\n    '3': 'Wed',\n    '4': 'Thu',\n    '5': 'Fri',\n    '6': 'Sat'\n  };\n\n  return format\n    .replace('MMM', monthNames[month])\n    .replace('DDD', weekDays[weekDayIndex])\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day);\n}\n","export function loadData(\n  URL: string,\n  type: 'json' | 'csv' | 'tsv' | 'xml' = 'json'\n) {\n  switch (type) {\n    case 'json':\n      return d3.json(URL);\n    case 'csv':\n      return d3.csv(URL);\n    case 'tsv':\n      return d3.tsv(URL);\n    case 'xml':\n      return d3.xml(URL);\n    default:\n      throw new Error(`Unsupported data type: ${type}`);\n  }\n}\n","import { fillGaps, getDateSlice, prepareData } from './data-utils';\nimport { filterDates, formatDate, getDateString, getDates } from './dates';\nimport { Data, Options } from './models';\nimport { createRenderer } from './render';\nimport { createTicker } from './ticker';\n\nexport function race(data: Data[], options: Options = {}) {\n  // ********************\n  //  Stateful functions\n  // ********************\n\n  const { renderInitalView, renderFrame, resize } = createRenderer();\n  const {\n    tickerDateFactory,\n    startTicker,\n    stopTicker,\n    rewindTicker,\n    loopTicker,\n    fastForwardTicker,\n    toggle\n  } = createTicker();\n\n  // ********************\n  // User-defined options\n  // ********************\n\n  const dataShape = options.dataShape || 'long';\n  const fillDateGaps = options.fillDateGaps;\n  // const fillDateGapsValue = options.fillDateGapsValue || \"last\";\n  const selector = options.selector || '#race';\n  const startDate = options.startDate ? getDateString(options.startDate) : '';\n  const endDate = options.endDate ? getDateString(options.endDate) : '';\n  const loop = options.loop || false;\n  const colorSeed = options.colorSeed || '';\n  const disableGroupColors = options.disableGroupColors || false;\n  const tickDuration = Number(options.tickDuration) || 500;\n  const topN = Number(options.topN) || 10;\n  const disableClickEvents = options.disableClickEvents || true;\n  const disableKeyboardEvents = options.disableKeyboardEvents;\n  const autorun = options.autorun !== false;\n\n  const renderOptions = {\n    title: options.title || '18 years of Top Global Brands',\n    subTitle: options.subTitle || 'Brand value, $m',\n    caption: options.caption || 'Source: Interbrand',\n    dateCounterFormat: options.dateCounterFormat || 'YYYY',\n    labelsOnBars: options.labelsOnBars !== false,\n    labelsWidth: options.labelsWidth || 100,\n    showControls: options.showControls || 'all',\n    inputHeight: options.height,\n    inputWidth: options.width,\n    minHeight: 300,\n    minWidth: 500,\n    tickDuration,\n    topN\n  };\n\n  // ********************\n  //   Create the chart\n  // ********************\n\n  const element = document.querySelector(selector) as HTMLElement;\n  let lastValues: any;\n\n  data = filterDates(data, startDate, endDate);\n  data = prepareData(data, dataShape, disableGroupColors, colorSeed);\n\n  if (fillDateGaps) {\n    data = fillGaps(data, getDates(data), fillDateGaps);\n  }\n\n  const tickerDate = tickerDateFactory(\n    getDates(data),\n    tickDuration,\n    loop,\n    selector,\n    updateDateSlice,\n    runRenderFrame\n  );\n\n  let dateSlice: Data[];\n  initialize();\n\n  runRenderInitalView();\n  runRenderFrame();\n\n  startTicker();\n\n  if (!autorun) {\n    stopTicker();\n  }\n\n  if (!disableClickEvents) {\n    registerClickEvents();\n  }\n  if (!disableKeyboardEvents) {\n    registerKeyboardEvents();\n  }\n\n  window.addEventListener('resize', runResize);\n\n  // ********************\n  //   Helper functions\n  // ********************\n\n  function runRenderInitalView() {\n    const controlFns = {\n      rewindTicker,\n      toggle,\n      fastForwardTicker\n    };\n\n    renderInitalView(\n      selector,\n      dateSlice,\n      renderOptions,\n      tickerDate.getDate,\n      controlFns,\n      tickerDate.setRunning\n    );\n  }\n\n  function runRenderFrame() {\n    renderFrame(dateSlice, renderOptions, tickerDate.getDate);\n  }\n\n  function runResize() {\n    resize(element, renderOptions, reset);\n\n    function reset() {\n      const currentlyRunning = tickerDate.isRunning();\n      stopTicker();\n      element.innerHTML = '';\n      tickerDate.update();\n      runRenderInitalView();\n\n      if (currentlyRunning) {\n        startTicker();\n      }\n    }\n  }\n\n  function updateDateSlice(currentDate: string) {\n    dateSlice = getDateSlice(data, tickerDate.getDate(), lastValues, topN);\n    runRenderFrame();\n    element.dispatchEvent(\n      new CustomEvent('dateChanged', {\n        detail: { date: formatDate(currentDate, 'YYYY-MM-DD') }\n      })\n    );\n  }\n\n  function initialize() {\n    initializeLastValues();\n    tickerDate.setFirst();\n\n    function initializeLastValues() {\n      lastValues = {};\n      data.forEach(d => {\n        d.lastValue = d.value;\n        if (!lastValues[d.name] || d.date < lastValues[d.name].date) {\n          lastValues[d.name] = {\n            date: d.date,\n            value: d.value\n          };\n        }\n      });\n    }\n  }\n\n  function createScroller() {\n    prepareDOM();\n\n    const dates = tickerDate.getDates();\n    const step = document.body.clientHeight / dates.length;\n\n    subscribeToEvents();\n\n    function prepareDOM() {\n      element.style.position = 'fixed';\n      element.style.top = '0';\n\n      const scrollElement = document.createElement('div');\n      scrollElement.style.height = window.innerHeight * 10 + 'px';\n      document.body.appendChild(scrollElement);\n    }\n\n    function subscribeToEvents() {\n      window.addEventListener('scroll', goToDate);\n      // element.addEventListener(\"dateChanged\", scrollToPosition);\n    }\n\n    // function scrollToPosition(e: CustomEvent) {\n    //   let currentDate = getDateString(e.detail.date);\n    //   let index = dates.indexOf(currentDate);\n    //   ignoreNextScrollEvent = true;\n    //   window.scroll({\n    //     top: index * step,\n    //     behavior: \"smooth\",\n    //   });\n    // }\n\n    function goToDate() {\n      const index = Math.ceil(window.pageYOffset / step);\n      if (index < dates.length) {\n        tickerDate.set(dates[index]);\n      } else {\n        tickerDate.setLast();\n      }\n    }\n  }\n\n  function registerClickEvents() {\n    const svg = element.querySelector('svg') as SVGSVGElement;\n    svg.addEventListener('click', toggle);\n\n    element.addEventListener('dblclick', fastForwardTicker);\n  }\n\n  function registerKeyboardEvents() {\n    document.addEventListener('keypress', function(e) {\n      const keyCodes = {\n        spacebar: 32,\n        a: 97,\n        d: 100,\n        s: 115\n      };\n\n      // TODO: keyCode is deprecated\n      switch (e.keyCode) {\n        case keyCodes.spacebar:\n          toggle();\n          break;\n        case keyCodes.a:\n          rewindTicker();\n          break;\n        case keyCodes.s:\n          toggle();\n          break;\n        case keyCodes.d:\n          fastForwardTicker();\n          break;\n      }\n    });\n  }\n\n  // ********************\n  //      Public API\n  // ********************\n\n  return {\n    // TODO: validate user input\n    start: () => {\n      if (!tickerDate.isRunning()) {\n        startTicker();\n      }\n    },\n    stop: () => {\n      stopTicker();\n    },\n    rewind: () => {\n      rewindTicker();\n    },\n    fastforward: () => {\n      fastForwardTicker();\n    },\n    loop: () => {\n      loopTicker();\n    },\n    inc: (value = 1) => {\n      tickerDate.inc(value);\n    },\n    dec: (value = 1) => {\n      tickerDate.dec(value);\n    },\n    getCurrentDate: () => tickerDate.getDate(),\n    getDates: () => tickerDate.getDates().map((date: string) => formatDate(date, 'YYYY-MM-DD')),\n    setDate: (inputDate: string | Date) => {\n      tickerDate.set(getDateString(inputDate));\n    },\n    createScroller: () => {\n      createScroller();\n    }\n  };\n}\n","import * as d3 from 'd3';\n\nimport { Data, Options } from './models';\nimport { formatDate } from './dates';\nimport { getHeight, getWidth } from './utils';\n\nexport function createRenderer() {\n  let margin: any;\n  let svg: any;\n  let x: d3.ScaleLinear<number, number>;\n  let y: d3.ScaleLinear<number, number>;\n  let xAxis: any;\n  let barPadding: any;\n  let dateCounterText: any;\n  let labelX: number | ((d: Data) => number);\n  let height: number;\n  let width: number;\n\n  function renderInitalView(\n    selector: string,\n    dateSlice: Data[],\n    renderOptions: any,\n    getDateFn: () => string,\n    controlFns: any,\n    setRunningFn: (flag: boolean) => void\n  ) {\n    const {\n      inputHeight,\n      inputWidth,\n      minHeight,\n      minWidth,\n      labelsOnBars,\n      labelsWidth,\n      topN,\n      title,\n      subTitle,\n      caption,\n      dateCounterFormat,\n      showControls\n    } = renderOptions;\n\n    const element = document.querySelector(selector) as HTMLElement;\n\n    height = getHeight(element, minHeight, inputHeight);\n    width = getWidth(element, minWidth, inputWidth);\n\n    renderInitialFrame();\n    renderControls(element, showControls, controlFns);\n    setRunningFn(false);\n\n    function renderInitialFrame() {\n      svg = d3\n        .select(selector)\n        .append('svg')\n        .attr('width', width)\n        .attr('height', height);\n\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\n\n      margin = {\n        top: 80,\n        right: 0,\n        bottom: 5,\n        left: 0 + labelsArea\n      };\n\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\n\n      svg\n        .append('text')\n        .attr('class', 'title')\n        .attr('y', 24)\n        .html(title);\n\n      svg\n        .append('text')\n        .attr('class', 'subTitle')\n        .attr('y', 55)\n        .html(subTitle);\n\n      x = d3\n        .scaleLinear()\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\n        .range([margin.left, width - margin.right - 65]);\n\n      y = d3\n        .scaleLinear()\n        .domain([topN, 0])\n        .range([height - margin.bottom, margin.top]);\n\n      xAxis = d3\n        .axisTop(x)\n        // .scale()\n        .ticks(width > 500 ? 5 : 2)\n        .tickSize(-(height - margin.top - margin.bottom))\n        .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n));\n\n      svg\n        .append('g')\n        .attr('class', 'axis xAxis')\n        .attr('transform', `translate(0, ${margin.top})`)\n        .call(xAxis)\n        .selectAll('.tick line')\n        .classed('origin', (d: number) => d === 0);\n\n      svg\n        .selectAll('rect.bar')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('x', x(0) + 1)\n        .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n        .attr('y', (d: any) => y(d.rank) + 5)\n        .attr('height', y(1) - y(0) - barPadding)\n        .style('fill', (d: Data) => d.color);\n\n      labelX = labelsOnBars ? (d: Data) => x(d.value) - 8 : margin.left - 8;\n\n      svg\n        .selectAll('text.label')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'label')\n        .attr('x', labelX)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .style('text-anchor', 'end')\n        .html((d: Data) => d.name);\n      svg\n        .selectAll('text.valueLabel')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'valueLabel')\n        .attr('x', (d: Data) => x(d.value) + 5)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\n\n      const strokeWidth = 10;\n      dateCounterText = svg\n        .append('text')\n        .attr('class', 'dateCounterText')\n        .attr('x', width - margin.right - barPadding)\n        .attr('y', height - 40)\n        .style('text-anchor', 'end')\n        .html(formatDate(getDateFn(), dateCounterFormat))\n        .call(halo, strokeWidth);\n\n      svg\n        .append('text')\n        .attr('class', 'caption')\n        .attr('x', width - margin.right - barPadding - strokeWidth)\n        .attr('y', height - margin.bottom - barPadding)\n        .style('text-anchor', 'end')\n        .html(caption);\n\n      function halo(text: any, strokeWidth: number) {\n        text\n          .select(function() {\n            return this.parentNode.insertBefore(this.cloneNode(true), this);\n          })\n          .style('fill', '#ffffff')\n          .style('stroke', '#ffffff')\n          .style('stroke-width', strokeWidth)\n          .style('stroke-linejoin', 'round')\n          .style('opacity', 1);\n      }\n    }\n\n    function renderControls(\n      element: HTMLElement,\n      showControls: Options['showControls'],\n      controlFns: any\n    ) {\n      const icons = {\n        play: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-play\"><polygon points=\"5 3 19 12 5 21 5 3\"></polygon></svg>`,\n        pause: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-pause\"><rect x=\"6\" y=\"4\" width=\"4\" height=\"16\"></rect><rect x=\"14\" y=\"4\" width=\"4\" height=\"16\"></rect></svg>`,\n        skipForward: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-skip-forward\"><polygon points=\"5 4 15 12 5 20 5 4\"></polygon><line x1=\"19\" y1=\"5\" x2=\"19\" y2=\"19\"></line></svg>`,\n        skipBack: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-skip-back\"><polygon points=\"19 20 9 12 19 4 19 20\"></polygon><line x1=\"5\" y1=\"19\" x2=\"5\" y2=\"5\"></line></svg>`\n      };\n      element.style.position = 'relative';\n\n      const controls = addElement('div', 'controls', '', element);\n      controls.style.position = 'absolute';\n      controls.style.top = '0';\n      controls.style.right = margin.right + barPadding + 'px';\n\n      const rewindButton = addElement('div', 'rewind', icons.skipBack, controls);\n      rewindButton.addEventListener('click', controlFns.rewindTicker);\n\n      const playButton = addElement('div', 'play', icons.play, controls);\n      playButton.addEventListener('click', controlFns.toggle);\n\n      const pauseButton = addElement('div', 'pause', icons.pause, controls);\n      pauseButton.addEventListener('click', controlFns.toggle);\n\n      const fastforwardButton = addElement('div', 'fastforward', icons.skipForward, controls);\n      fastforwardButton.addEventListener('click', controlFns.fastForwardTicker);\n\n      switch (showControls) {\n        case 'play':\n          rewindButton.style.visibility = 'hidden';\n          fastforwardButton.style.visibility = 'hidden';\n          break;\n        case 'none':\n          controls.style.display = 'none';\n          break;\n      }\n\n      function addElement(tag: string, className: string, html: string, parent: HTMLElement) {\n        const domElement = document.createElement(tag);\n        domElement.classList.add(className);\n        domElement.innerHTML = html;\n        parent.appendChild(domElement);\n        return domElement;\n      }\n    }\n  }\n\n  function renderFrame(dateSlice: Data[], renderOptions: any, getDateFn: () => string) {\n    if (!x) {\n      return;\n    }\n\n    const { tickDuration, topN, dateCounterFormat } = renderOptions;\n\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\n\n    svg\n      .select('.xAxis')\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .call(xAxis);\n\n    const bars = svg.selectAll('.bar').data(dateSlice, (d: Data) => d.name);\n\n    bars\n      .enter()\n      .append('rect')\n      .attr('class', (d: Data) => `bar ${d.name.replace(/\\s/g, '_')}`)\n      .attr('x', x(0) + 1)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .attr('height', y(1) - y(0) - barPadding)\n      .style('fill', (d: Data) => d.color)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const labels = svg.selectAll('.label').data(dateSlice, (d: Data) => d.name);\n\n    labels\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5 + (y(1) - y(0)) / 2)\n      .style('text-anchor', 'end')\n      .html((d: Data) => d.name)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const valueLabels = svg.selectAll('.valueLabel').data(dateSlice, (d: Data) => d.name);\n\n    valueLabels\n      .enter()\n      .append('text')\n      .attr('class', 'valueLabel')\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    valueLabels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n      .tween('text', function(d: Data) {\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\n        return function(t: any) {\n          this.textContent = d3.format(',')(i(t));\n        };\n      });\n\n    valueLabels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    dateCounterText.html(formatDate(getDateFn(), dateCounterFormat));\n  }\n\n  function resize(element: HTMLElement, renderOptions: any, resetFn: () => void) {\n    if (\n      (!renderOptions.height && !renderOptions.width) ||\n      String(renderOptions.height).startsWith('window') ||\n      String(renderOptions.width).startsWith('window')\n    ) {\n      height = getHeight(element, renderOptions.minHeight, renderOptions.height);\n      width = getWidth(element, renderOptions.minWidth, renderOptions.width);\n\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\n      resetFn();\n      element.style.position = currentPosition;\n    }\n  }\n\n  return {\n    renderInitalView,\n    renderFrame,\n    resize\n  };\n}\n","import * as d3 from 'd3';\n\nexport function createTicker() {\n  let ticker: any;\n  let tickerDate: any;\n  let running: boolean;\n  let tickDuration: number;\n  let loop: boolean;\n  let selector: string;\n  let runRenderFrame: () => void;\n\n  function tickerDateFactory(\n    dates: string[],\n    _tickDuration: number,\n    _loop: boolean,\n    _selector: string,\n    updateDateSlice: (currentDate: string) => void,\n    _runRenderFrame: () => void\n  ) {\n    tickDuration = _tickDuration;\n    loop = _loop;\n    selector = _selector;\n    runRenderFrame = _runRenderFrame;\n\n    let dateCounter = 0;\n    let currentDate: string;\n    const lastIndex = dates.length - 1;\n    const maxDate = dates[lastIndex];\n\n    function updateDate() {\n      currentDate = dates[dateCounter];\n      updateDateSlice(currentDate);\n    }\n\n    tickerDate = {\n      inc: (value = 1) => {\n        const newValue = dateCounter + value;\n        dateCounter = newValue > lastIndex ? lastIndex : newValue;\n        updateDate();\n      },\n      dec: (value = 1) => {\n        const newValue = dateCounter - value;\n        dateCounter = newValue < 0 ? 0 : newValue;\n        updateDate();\n      },\n      setFirst: () => {\n        dateCounter = 0;\n        updateDate();\n      },\n      setLast: () => {\n        dateCounter = dates.length - 1;\n        updateDate();\n      },\n      update: () => {\n        updateDate();\n      },\n      set: (date: string) => {\n        const dateIndex = dates.indexOf(date);\n        if (dateIndex > -1) {\n          dateCounter = dateIndex;\n          updateDate();\n        }\n      },\n      getDate: () => currentDate,\n      isLast: () => currentDate === maxDate,\n      getDates: () => [...dates],\n      isRunning: () => running,\n      setRunning: (flag: boolean) => setRunning(flag)\n    };\n\n    return tickerDate;\n  }\n\n  function startTicker() {\n    setRunning(true);\n    ticker = d3.interval(showRace, tickDuration);\n\n    function showRace(_: number) {\n      if (tickerDate.isLast()) {\n        runRenderFrame();\n        if (loop) {\n          loopTicker();\n        } else {\n          stopTicker();\n        }\n      } else {\n        tickerDate.inc();\n      }\n    }\n  }\n\n  function stopTicker() {\n    ticker.stop();\n    setRunning(false);\n  }\n\n  function rewindTicker() {\n    stopTicker();\n    tickerDate.setFirst();\n    runRenderFrame();\n  }\n\n  function loopTicker() {\n    tickerDate.setFirst();\n    runRenderFrame();\n  }\n\n  function fastForwardTicker() {\n    stopTicker();\n    tickerDate.setLast();\n    runRenderFrame();\n  }\n\n  function toggle() {\n    if (tickerDate.isLast()) {\n      rewindTicker();\n      startTicker();\n    } else if (running) {\n      stopTicker();\n    } else {\n      startTicker();\n    }\n  }\n\n  function setRunning(flag = true) {\n    const playButton = document.querySelector(selector + ' .play') as HTMLElement;\n    const pauseButton = document.querySelector(selector + ' .pause') as HTMLElement;\n    if (flag) {\n      running = true;\n      playButton.style.display = 'none';\n      pauseButton.style.display = 'unset';\n    } else {\n      running = false;\n      playButton.style.display = 'unset';\n      pauseButton.style.display = 'none';\n    }\n  }\n\n  return {\n    tickerDateFactory,\n    startTicker,\n    stopTicker,\n    rewindTicker,\n    loopTicker,\n    fastForwardTicker,\n    toggle,\n    setRunning\n  };\n}\n","import { formatDate, getDateString } from './dates';\nimport { Data } from './models';\nimport { getColor } from './utils';\n\nexport function prepareData(data: Data[], dataShape: string, disableGroupColors: boolean, colorSeed: string) {\n  if (dataShape === 'wide') {\n    data = wideDataToLong(data);\n  }\n  return data.map(item => {\n    const d = { ...item };\n    d.value = isNaN(+d.value) ? 0 : +d.value;\n    d.date = getDateString(d.date);\n    d.color = getColor(d, disableGroupColors, colorSeed);\n    return d;\n  });\n}\n\nexport function wideDataToLong(wide: any) {\n  const long = [] as Data[];\n  wide.forEach((item: any) => {\n    for (const [key, value] of Object.entries(item)) {\n      long.push({\n        date: item.date,\n        name: key,\n        value: Number(value)\n      });\n    }\n  });\n  return long;\n}\n\nexport function fillGaps(data: Data[], dates: string[], period: 'years' | 'months' | 'days') {\n  const minDate = new Date(formatDate(dates[0], 'YYYY-MM-DD'));\n  const maxDate = new Date(formatDate(dates[dates.length - 1], 'YYYY-MM-DD'));\n\n  const next = {\n    years: (dt: Date) => {\n      dt.setFullYear(dt.getFullYear() + 1);\n    },\n    months: (dt: Date) => {\n      dt.setMonth(dt.getMonth() + 1);\n    },\n    days: (dt: Date) => {\n      dt.setDate(dt.getDate() + 1);\n    }\n  };\n  if (!next[period]) {\n    return data;\n  }\n\n  const dateRange: string[] = [];\n  for (const date = minDate; date < maxDate; next[period](date)) {\n    dateRange.push(getDateString(date));\n  }\n\n  dateRange.forEach((date, index) => {\n    if (data.filter(d => d.date === date).length > 0) {\n      return;\n    }\n\n    const missing = data\n      .filter(d => d.date === dateRange[index - 1])\n      .map(d =>\n        // const value = {\n        //   last: d.value,\n        //   zero: 0,\n        // }\n        ({\n          ...d,\n          date\n          // value: value[fillDateGapsValue],\n        })\n      );\n\n    data.push(...missing);\n  });\n\n  return data;\n}\n\nexport function getDateSlice(data: Data[], date: string, lastValues: any, topN: number) {\n  const dateSlice = data\n    .filter(d => d.date === date && !isNaN(d.value))\n    .map(d => {\n      if (!lastValues) {\n        return d;\n      }\n\n      const lastValue = lastValues[d.name].value;\n      lastValues[d.name].date = d.date;\n      lastValues[d.name].value = d.value;\n      return { ...d, lastValue };\n    })\n    .sort((a, b) => b.value - a.value)\n    .slice(0, topN);\n  dateSlice.forEach((d, i) => (d.rank = i));\n\n  return dateSlice;\n}\n"],"names":["zeroPad","n","w","toString","length","getHeight","element","minHeight","height","newHeight","String","startsWith","scale","split","window","innerHeight","getBoundingClientRect","getWidth","minWidth","width","newWidth","innerWidth","getDates","data","uniqueDates","Set","forEach","d","add","date","Array","from","sort","getDateString","inputDate","Date","isNaN","Error","year","getFullYear","month","getMonth","getDate","formatDate","dateStr","format","slice","day","weekDayIndex","getDay","replace","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","URL","type","d3","json","csv","tsv","xml","options","margin","svg","x","y","xAxis","barPadding","dateCounterText","labelX","lastValues","ticker","tickerDate","running","tickDuration","loop","selector","runRenderFrame","startTicker","setRunning","_","isLast","loopTicker","stopTicker","inc","stop","rewindTicker","setFirst","flag","playButton","document","querySelector","pauseButton","style","display","tickerDateFactory","dates","_tickDuration","_loop","_selector","updateDateSlice","_runRenderFrame","currentDate","dateCounter","lastIndex","maxDate","updateDate","value","newValue","dec","setLast","update","set","dateIndex","indexOf","isRunning","fastForwardTicker","toggle","createTicker","dataShape","fillDateGaps","startDate","endDate","colorSeed","disableGroupColors","Number","topN","disableClickEvents","disableKeyboardEvents","autorun","renderOptions","title","subTitle","caption","dateCounterFormat","labelsOnBars","labelsWidth","showControls","inputHeight","inputWidth","long","item","Object","entries","push","name","map","color","hsl","seed","s","nums","i","charCodeAt","toNumbers","group","Math","sin","floor","getColor","prepareData","filter","filterDates","period","minDate","next","years","dt","setFullYear","months","setMonth","days","setDate","dateRange","index","missing","fillGaps","dateSlice","lastValue","a","b","rank","getDateSlice","dispatchEvent","CustomEvent","detail","runRenderInitalView","getDateFn","controlFns","setRunningFn","append","attr","top","right","bottom","left","html","domain","range","ticks","tickSize","tickFormat","call","selectAll","classed","enter","abs","text","strokeWidth","select","parentNode","insertBefore","this","cloneNode","position","controls","addElement","rewindButton","addEventListener","fastforwardButton","visibility","tag","className","parent","domElement","createElement","classList","innerHTML","appendChild","renderControls","renderInitalView","transition","duration","ease","bars","exit","remove","labels","valueLabels","tween","t","textContent","renderFrame","e","keyCode","resetFn","currentPosition","resize","currentlyRunning","start","rewind","fastforward","getCurrentDate","createScroller","scrollElement","body","prepareDOM","step","clientHeight","ceil","pageYOffset"],"mappings":"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"}