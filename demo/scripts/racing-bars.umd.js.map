{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/utils.ts","../../src/lib/dates.ts","../../src/lib/load-data.ts","../../src/lib/racing-bars.ts","../../src/lib/renderer.ts","../../src/lib/ticker.ts","../../src/lib/data-utils.ts"],"sourcesContent":["import { Data } from './models';\n\nexport function getColor(d: Data, disableGroupColors: boolean, colorSeed: string) {\n  const nameseed = d.group && !disableGroupColors ? d.group : d.name;\n  const seed = nameseed + colorSeed;\n  return d3.hsl(random(seed) * 360, 0.75, 0.75);\n}\n\nexport function zeroPad(n: string, w: number) {\n  while (n.toString().length < w) {\n    n = '0' + n;\n  }\n  return n;\n}\n\nexport function random(seedStr: string) {\n  function toNumbers(s: string) {\n    let nums = '';\n    for (let i = 0; i < s.length; i++) {\n      nums += zeroPad(String(s.charCodeAt(i)), 3);\n    }\n    return nums;\n  }\n\n  const seed = toNumbers(seedStr);\n  const x = Math.sin(+seed) * 10000;\n  return x - Math.floor(x);\n}\n\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\n  let newHeight;\n  if (!height) {\n    newHeight = element.getBoundingClientRect().height;\n  } else if (String(height).startsWith('window')) {\n    const scale = +height.split('*')[1] || 1;\n    newHeight = window.innerHeight * scale;\n  } else {\n    newHeight = +height;\n  }\n  return newHeight > minHeight ? newHeight : minHeight;\n}\n\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\n  let newWidth;\n  if (!width) {\n    newWidth = element.getBoundingClientRect().width;\n  } else if (String(width).startsWith('window')) {\n    const scale = +width.split('*')[1] || 1;\n    newWidth = window.innerWidth * scale;\n  } else {\n    newWidth = +width;\n  }\n  return newWidth > minWidth ? newWidth : minWidth;\n}\n\n","import { Data } from './models';\nimport { zeroPad } from './utils';\n\nexport function getDates(data: Data[]) {\n  const uniqueDates = new Set<string>();\n  data.forEach(d => {\n    uniqueDates.add(d.date);\n  });\n  return Array.from(uniqueDates).sort();\n}\n\nexport function filterDates(data: Data[], startDate: string, endDate: string) {\n  return data\n    .filter(d => (startDate ? d.date >= startDate : true))\n    .filter(d => (endDate ? d.date <= endDate : true));\n}\n\nexport function getDateString(inputDate: string | Date) {\n  const date = new Date(inputDate);\n  if (isNaN(+date)) {\n    throw new Error(`\"${inputDate}\" is not a valid date`);\n  }\n\n  const year = date.getFullYear();\n\n  let month = (1 + date.getMonth()).toString();\n  month = zeroPad(month, 2);\n\n  let day = date.getDate().toString();\n  day = zeroPad(day, 2);\n\n  return `${year}${month}${day}`;\n}\n\nexport function formatDate(dateStr: string, format: string) {\n  const year = dateStr.slice(0, 4);\n  const month = dateStr.slice(4, 6);\n  const day = dateStr.slice(6, 8);\n  const date = new Date(`${year}-${month}-${day}`);\n  const weekDayIndex = date.getDay();\n  const monthNames: any = {\n    '01': 'Jan',\n    '02': 'Feb',\n    '03': 'Mar',\n    '04': 'Apr',\n    '05': 'May',\n    '06': 'Jun',\n    '07': 'Jul',\n    '08': 'Aug',\n    '09': 'Sep',\n    '10': 'Oct',\n    '11': 'Nov',\n    '12': 'Dec'\n  };\n\n  const weekDays: any = {\n    '0': 'Sun',\n    '1': 'Mon',\n    '2': 'Tue',\n    '3': 'Wed',\n    '4': 'Thu',\n    '5': 'Fri',\n    '6': 'Sat'\n  };\n\n  return format\n    .replace('MMM', monthNames[month])\n    .replace('DDD', weekDays[weekDayIndex])\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day);\n}\n","export function loadData(\n  URL: string,\n  type: 'json' | 'csv' | 'tsv' | 'xml' = 'json'\n) {\n  switch (type) {\n    case 'json':\n      return d3.json(URL);\n    case 'csv':\n      return d3.csv(URL);\n    case 'tsv':\n      return d3.tsv(URL);\n    case 'xml':\n      return d3.xml(URL);\n    default:\n      throw new Error(`Unsupported data type: ${type}`);\n  }\n}\n","import { fillGaps, getDateSlice, prepareData } from './data-utils';\nimport { filterDates, formatDate, getDateString, getDates } from './dates';\nimport { ControlButtons, Data, Options, RenderOptions, TickerOptions } from './models';\nimport { createRenderer } from './renderer';\nimport { createTicker } from './ticker';\n\nexport function race(data: Data[], options: Options = {}) {\n  // ********************\n  // User-defined options\n  // ********************\n\n  const dataShape = options.dataShape || 'long';\n  const fillDateGaps = options.fillDateGaps;\n  // const fillDateGapsValue = options.fillDateGapsValue || \"last\";\n  const selector = options.selector || '#race';\n  const startDate = options.startDate ? getDateString(options.startDate) : '';\n  const endDate = options.endDate ? getDateString(options.endDate) : '';\n  const colorSeed = options.colorSeed || '';\n  const disableGroupColors = options.disableGroupColors || false;\n  const tickDuration = Number(options.tickDuration) || 500;\n  const topN = Number(options.topN) || 10;\n  const disableClickEvents = options.disableClickEvents || true;\n  const disableKeyboardEvents = options.disableKeyboardEvents;\n  const autorun = options.autorun !== false;\n\n  const renderOptions: RenderOptions = {\n    selector,\n    title: options.title || '18 years of Top Global Brands',\n    subTitle: options.subTitle || 'Brand value, $m',\n    caption: options.caption || 'Source: Interbrand',\n    dateCounterFormat: options.dateCounterFormat || 'YYYY',\n    labelsOnBars: options.labelsOnBars !== false,\n    labelsWidth: options.labelsWidth || 100,\n    showControls: options.showControls || 'all',\n    inputHeight: options.height,\n    inputWidth: options.width,\n    minHeight: 300,\n    minWidth: 500,\n    tickDuration,\n    topN\n  };\n\n  const tickerOptions: TickerOptions = {\n    loop: options.loop || false,\n    tickDuration\n  };\n\n  // ********************\n  //  Stateful functions\n  // ********************\n\n  const renderer = createRenderer(selector, renderOptions);\n  const ticker = createTicker(notifyRenderer);\n\n  // ********************\n  //   Create the chart\n  // ********************\n\n  const element = document.querySelector(selector) as HTMLElement;\n  let lastValues: any;\n\n  data = filterDates(data, startDate, endDate);\n  data = prepareData(data, dataShape, disableGroupColors, colorSeed);\n\n  const dates = getDates(data);\n\n  if (fillDateGaps) {\n    data = fillGaps(data, dates, fillDateGaps);\n  }\n\n  const tickerDate = ticker.tickerDateFactory(dates, tickerOptions, updateDate, renderFrame);\n\n  let dateSlice: Data[];\n  initialize();\n\n  renderInitalView();\n  renderFrame();\n\n  ticker.start();\n\n  if (!autorun) {\n    ticker.stop();\n  }\n\n  if (!disableClickEvents) {\n    registerClickEvents();\n  }\n  if (!disableKeyboardEvents) {\n    registerKeyboardEvents();\n  }\n\n  window.addEventListener('resize', resize);\n\n  // ********************\n  //   Helper functions\n  // ********************\n\n  function renderInitalView() {\n    renderer.renderInitalView(dateSlice);\n    ticker.stop();\n\n    const controlButtons = renderer.getControlButtons();\n    addListenersToControls(controlButtons);\n  }\n\n  function renderFrame() {\n    renderer.renderFrame(dateSlice);\n  }\n\n  function notifyRenderer(running: boolean) {\n    renderer.renderAsRunning(running);\n  }\n\n  function addListenersToControls(controlButtons: ControlButtons) {\n    if (!controlButtons) {\n      return;\n    }\n    controlButtons.rewind.addEventListener('click', ticker.rewind);\n    controlButtons.play.addEventListener('click', ticker.toggle);\n    controlButtons.pause.addEventListener('click', ticker.toggle);\n    controlButtons.fastforward.addEventListener('click', ticker.fastForward);\n  }\n\n  function resize() {\n    renderer.resize(reset);\n\n    function reset() {\n      const currentlyRunning = ticker.isRunning();\n      ticker.stop();\n      element.innerHTML = '';\n      tickerDate.update();\n      renderInitalView();\n\n      if (currentlyRunning) {\n        ticker.start();\n      }\n    }\n  }\n\n  function updateDate(currentDate: string) {\n    dateSlice = getDateSlice(data, tickerDate.getDate(), lastValues, topN);\n    renderFrame();\n    element.dispatchEvent(\n      new CustomEvent('dateChanged', {\n        detail: { date: formatDate(currentDate, 'YYYY-MM-DD') }\n      })\n    );\n  }\n\n  function initialize() {\n    initializeLastValues();\n    tickerDate.setFirst();\n\n    function initializeLastValues() {\n      lastValues = {};\n      data.forEach(d => {\n        d.lastValue = d.value;\n        if (!lastValues[d.name] || d.date < lastValues[d.name].date) {\n          lastValues[d.name] = {\n            date: d.date,\n            value: d.value\n          };\n        }\n      });\n    }\n  }\n\n  function createScroller() {\n    prepareDOM();\n\n    const step = document.body.clientHeight / dates.length;\n\n    subscribeToEvents();\n\n    function prepareDOM() {\n      element.style.position = 'fixed';\n      element.style.top = '0';\n\n      const scrollElement = document.createElement('div');\n      scrollElement.style.height = window.innerHeight * 10 + 'px';\n      document.body.appendChild(scrollElement);\n    }\n\n    function subscribeToEvents() {\n      window.addEventListener('scroll', goToDate);\n      // element.addEventListener(\"dateChanged\", scrollToPosition);\n    }\n\n    // function scrollToPosition(e: CustomEvent) {\n    //   let currentDate = getDateString(e.detail.date);\n    //   let index = dates.indexOf(currentDate);\n    //   ignoreNextScrollEvent = true;\n    //   window.scroll({\n    //     top: index * step,\n    //     behavior: \"smooth\",\n    //   });\n    // }\n\n    function goToDate() {\n      const index = Math.ceil(window.pageYOffset / step);\n      if (index < dates.length) {\n        tickerDate.setDate(dates[index]);\n      } else {\n        tickerDate.setLast();\n      }\n    }\n  }\n\n  function registerClickEvents() {\n    const svg = element.querySelector('svg') as SVGSVGElement;\n    svg.addEventListener('click', ticker.toggle);\n\n    element.addEventListener('dblclick', ticker.fastForward);\n  }\n\n  function registerKeyboardEvents() {\n    document.addEventListener('keypress', function(e) {\n      const keyCodes = {\n        spacebar: 32,\n        a: 97,\n        d: 100,\n        s: 115\n      };\n\n      // TODO: keyCode is deprecated\n      switch (e.keyCode) {\n        case keyCodes.spacebar:\n          ticker.toggle();\n          break;\n        case keyCodes.a:\n          ticker.rewind();\n          break;\n        case keyCodes.s:\n          ticker.toggle();\n          break;\n        case keyCodes.d:\n          ticker.fastForward();\n          break;\n      }\n    });\n  }\n\n  // ********************\n  //      Public API\n  // ********************\n\n  return {\n    // TODO: validate user input\n    start: () => {\n      if (!ticker.isRunning()) {\n        ticker.start();\n      }\n    },\n    stop: () => {\n      ticker.stop();\n    },\n    rewind: () => {\n      ticker.rewind();\n    },\n    fastforward: () => {\n      ticker.fastForward();\n    },\n    loop: () => {\n      ticker.loop();\n    },\n    inc: (value = 1) => {\n      tickerDate.inc(value);\n    },\n    dec: (value = 1) => {\n      tickerDate.dec(value);\n    },\n    getDate: () => tickerDate.getDate(),\n    setDate: (inputDate: string | Date) => {\n      tickerDate.setDate(getDateString(inputDate));\n    },\n    getAllDates: () => dates.map((date: string) => formatDate(date, 'YYYY-MM-DD')),\n    createScroller: () => {\n      createScroller();\n    }\n  };\n}\n","import * as d3 from 'd3';\n\nimport { formatDate } from './dates';\nimport { icons } from './icons';\nimport { ControlButtons, Data, Options, RenderOptions } from './models';\nimport { getHeight, getWidth } from './utils';\n\nexport function createRenderer(selector: string, renderOptions: RenderOptions) {\n  let margin: any;\n  let svg: any;\n  let x: d3.ScaleLinear<number, number>;\n  let y: d3.ScaleLinear<number, number>;\n  let xAxis: any;\n  let barPadding: any;\n  let dateCounterText: any;\n  let labelX: number | ((d: Data) => number);\n  let height: number;\n  let width: number;\n  let controlButtons: ControlButtons;\n\n  function renderInitalView(dateSlice: Data[]) {\n    const {\n      selector,\n      title,\n      subTitle,\n      caption,\n      dateCounterFormat,\n      labelsOnBars,\n      labelsWidth,\n      showControls,\n      inputHeight,\n      inputWidth,\n      minHeight,\n      minWidth,\n      topN\n    } = renderOptions;\n\n    const currentDate = dateSlice.length > 0 ? dateSlice[0].date : '';\n    const element = document.querySelector(selector) as HTMLElement;\n\n    height = getHeight(element, minHeight, inputHeight);\n    width = getWidth(element, minWidth, inputWidth);\n\n    renderInitialFrame();\n    renderControls(element, showControls);\n\n    function renderInitialFrame() {\n      svg = d3\n        .select(selector)\n        .append('svg')\n        .attr('width', width)\n        .attr('height', height);\n\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\n\n      margin = {\n        top: 80,\n        right: 0,\n        bottom: 5,\n        left: 0 + labelsArea\n      };\n\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\n\n      svg\n        .append('text')\n        .attr('class', 'title')\n        .attr('y', 24)\n        .html(title);\n\n      svg\n        .append('text')\n        .attr('class', 'subTitle')\n        .attr('y', 55)\n        .html(subTitle);\n\n      x = d3\n        .scaleLinear()\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\n        .range([margin.left, width - margin.right - 65]);\n\n      y = d3\n        .scaleLinear()\n        .domain([topN, 0])\n        .range([height - margin.bottom, margin.top]);\n\n      xAxis = d3\n        .axisTop(x)\n        // .scale()\n        .ticks(width > 500 ? 5 : 2)\n        .tickSize(-(height - margin.top - margin.bottom))\n        .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n));\n\n      svg\n        .append('g')\n        .attr('class', 'axis xAxis')\n        .attr('transform', `translate(0, ${margin.top})`)\n        .call(xAxis)\n        .selectAll('.tick line')\n        .classed('origin', (d: number) => d === 0);\n\n      svg\n        .selectAll('rect.bar')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('x', x(0) + 1)\n        .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n        .attr('y', (d: any) => y(d.rank) + 5)\n        .attr('height', y(1) - y(0) - barPadding)\n        .style('fill', (d: Data) => d.color);\n\n      labelX = labelsOnBars ? (d: Data) => x(d.value) - 8 : margin.left - 8;\n\n      svg\n        .selectAll('text.label')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'label')\n        .attr('x', labelX)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .style('text-anchor', 'end')\n        .html((d: Data) => d.name);\n      svg\n        .selectAll('text.valueLabel')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'valueLabel')\n        .attr('x', (d: Data) => x(d.value) + 5)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\n\n      const strokeWidth = 10;\n      dateCounterText = svg\n        .append('text')\n        .attr('class', 'dateCounterText')\n        .attr('x', width - margin.right - barPadding)\n        .attr('y', height - 40)\n        .style('text-anchor', 'end')\n        .html(formatDate(currentDate, dateCounterFormat))\n        .call(halo, strokeWidth);\n\n      svg\n        .append('text')\n        .attr('class', 'caption')\n        .attr('x', width - margin.right - barPadding - strokeWidth)\n        .attr('y', height - margin.bottom - barPadding)\n        .style('text-anchor', 'end')\n        .html(caption);\n\n      function halo(text: any, strokeWidth: number) {\n        text\n          .select(function() {\n            return this.parentNode.insertBefore(this.cloneNode(true), this);\n          })\n          .style('fill', '#ffffff')\n          .style('stroke', '#ffffff')\n          .style('stroke-width', strokeWidth)\n          .style('stroke-linejoin', 'round')\n          .style('opacity', 1);\n      }\n    }\n\n    function renderControls(\n      element: HTMLElement,\n      showControls: Options['showControls'],\n    ) {\n      element.style.position = 'relative';\n\n      const controls = addElement('div', 'controls', '', element);\n      controls.style.position = 'absolute';\n      controls.style.top = '0';\n      controls.style.right = margin.right + barPadding + 'px';\n\n      const rewindButton = addElement('div', 'rewind', icons.skipBack, controls);\n      const playButton = addElement('div', 'play', icons.play, controls);\n      const pauseButton = addElement('div', 'pause', icons.pause, controls);\n      const fastforwardButton = addElement('div', 'fastforward', icons.skipForward, controls);\n\n      controlButtons = {\n        rewind: rewindButton,\n        play: playButton,\n        pause: pauseButton,\n        fastforward: fastforwardButton,\n      }\n\n      switch (showControls) {\n        case 'play':\n          rewindButton.style.visibility = 'hidden';\n          fastforwardButton.style.visibility = 'hidden';\n          break;\n        case 'none':\n          controls.style.display = 'none';\n          break;\n      }\n\n      function addElement(tag: string, className: string, html: string, parent: HTMLElement) {\n        const domElement = document.createElement(tag);\n        domElement.classList.add(className);\n        domElement.innerHTML = html;\n        parent.appendChild(domElement);\n        return domElement;\n      }\n    }\n  }\n\n  function renderFrame(dateSlice: Data[]) {\n    if (!x) {\n      return;\n    }\n\n    const { tickDuration, topN, dateCounterFormat } = renderOptions;\n    const currentDate = dateSlice.length > 0 ? dateSlice[0].date : '';\n\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\n\n    svg\n      .select('.xAxis')\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .call(xAxis);\n\n    const bars = svg.selectAll('.bar').data(dateSlice, (d: Data) => d.name);\n\n    bars\n      .enter()\n      .append('rect')\n      .attr('class', (d: Data) => `bar ${d.name.replace(/\\s/g, '_')}`)\n      .attr('x', x(0) + 1)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .attr('height', y(1) - y(0) - barPadding)\n      .style('fill', (d: Data) => d.color)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const labels = svg.selectAll('.label').data(dateSlice, (d: Data) => d.name);\n\n    labels\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5 + (y(1) - y(0)) / 2)\n      .style('text-anchor', 'end')\n      .html((d: Data) => d.name)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const valueLabels = svg.selectAll('.valueLabel').data(dateSlice, (d: Data) => d.name);\n\n    valueLabels\n      .enter()\n      .append('text')\n      .attr('class', 'valueLabel')\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    valueLabels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n      .tween('text', function(d: Data) {\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\n        return function(t: any) {\n          this.textContent = d3.format(',')(i(t));\n        };\n      });\n\n    valueLabels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    dateCounterText.html(formatDate(currentDate, dateCounterFormat));\n  }\n\n  function resize(resetFn: () => void) {\n    if (\n      (!renderOptions.inputHeight && !renderOptions.inputWidth) ||\n      String(renderOptions.inputHeight).startsWith('window') ||\n      String(renderOptions.inputWidth).startsWith('window')\n    ) {\n      const element = document.querySelector(selector) as HTMLElement;\n\n      height = getHeight(element, renderOptions.minHeight, renderOptions.inputHeight);\n      width = getWidth(element, renderOptions.minWidth, renderOptions.inputWidth);\n\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\n      resetFn();\n      element.style.position = currentPosition;\n    }\n  }\n\n  function renderAsRunning(running: boolean) {\n    if (running) {\n      controlButtons.play.style.display = 'none';\n      controlButtons.pause.style.display = 'unset';\n    } else {\n      controlButtons.play.style.display = 'unset';\n      controlButtons.pause.style.display = 'none';\n    }\n  }\n\n  return {\n    renderInitalView,\n    renderFrame,\n    resize,\n    renderAsRunning,\n    getRenderedHeight: () => height,\n    getRenderedWidth: () => width,\n    getControlButtons: () => ({...controlButtons}),\n  };\n}\n","import * as d3 from 'd3';\n\nimport { TickerDate, TickerOptions } from './models';\n\nexport function createTicker(runningCallback: (running: boolean) => void) {\n  let ticker: d3.Timer;\n  let tickerDate: TickerDate;\n  let running: boolean;\n  let tickDuration: number;\n  let loopOption: boolean;\n  let renderFrame: () => void;\n\n  function tickerDateFactory(\n    dates: string[],\n    tickerOptions: TickerOptions,\n    updateDateCallback: (currentDate: string) => void,\n    _renderFrameFn: () => void\n  ) {\n    tickDuration = tickerOptions.tickDuration;\n    loopOption = tickerOptions.loop;\n    renderFrame = _renderFrameFn;\n\n    let dateCounter = 0;\n    let currentDate: string;\n    const lastIndex = dates.length - 1;\n    const maxDate = dates[lastIndex];\n\n    function updateDate() {\n      currentDate = dates[dateCounter];\n      updateDateCallback(currentDate);\n    }\n\n    tickerDate = {\n      inc: (value = 1) => {\n        const newValue = dateCounter + value;\n        dateCounter = newValue > lastIndex ? lastIndex : newValue;\n        updateDate();\n      },\n      dec: (value = 1) => {\n        const newValue = dateCounter - value;\n        dateCounter = newValue < 0 ? 0 : newValue;\n        updateDate();\n      },\n      setFirst: () => {\n        dateCounter = 0;\n        updateDate();\n      },\n      setLast: () => {\n        dateCounter = dates.length - 1;\n        updateDate();\n      },\n      update: () => {\n        updateDate();\n      },\n      getDate: () => currentDate,\n      setDate: (date: string) => {\n        const dateIndex = dates.indexOf(date);\n        if (dateIndex > -1) {\n          dateCounter = dateIndex;\n          updateDate();\n        }\n      },\n      isLast: () => currentDate === maxDate,\n    };\n\n    return tickerDate;\n  }\n\n  function start() {\n    setRunning(true);\n    ticker = d3.interval(showRace, tickDuration);\n\n    function showRace(_: number) {\n      if (tickerDate.isLast()) {\n        renderFrame();\n        if (loopOption) {\n          loop();\n        } else {\n          stop();\n        }\n      } else {\n        tickerDate.inc();\n      }\n    }\n  }\n\n  function stop() {\n    if (ticker) {\n      ticker.stop();\n    }\n    setRunning(false);\n  }\n\n  function rewind() {\n    stop();\n    tickerDate.setFirst();\n    renderFrame();\n  }\n\n  function loop() {\n    tickerDate.setFirst();\n    renderFrame();\n  }\n\n  function fastForward() {\n    stop();\n    tickerDate.setLast();\n    renderFrame();\n  }\n\n  function toggle() {\n    if (tickerDate.isLast()) {\n      rewind();\n      start();\n    } else if (running) {\n      stop();\n    } else {\n      start();\n    }\n  }\n\n  function isRunning() {\n    return running;\n  }\n\n  function setRunning(flag = true) {\n    running = flag;\n    runningCallback(running);\n  }\n\n  return {\n    tickerDateFactory,\n    start,\n    stop,\n    rewind,\n    loop,\n    fastForward,\n    toggle,\n    isRunning,\n  };\n}\n","import { formatDate, getDateString } from './dates';\nimport { Data } from './models';\nimport { getColor } from './utils';\n\nexport function prepareData(\n  data: Data[],\n  dataShape: string,\n  disableGroupColors: boolean,\n  colorSeed: string\n) {\n  if (dataShape === 'wide') {\n    data = wideDataToLong(data);\n  }\n  return data.map(item => {\n    const d = { ...item };\n    d.value = isNaN(+d.value) ? 0 : +d.value;\n    d.date = getDateString(d.date);\n    d.color = getColor(d, disableGroupColors, colorSeed);\n    return d;\n  });\n}\n\nexport function wideDataToLong(wide: any) {\n  const long = [] as Data[];\n  wide.forEach((item: any) => {\n    for (const [key, value] of Object.entries(item)) {\n      long.push({\n        date: item.date,\n        name: key,\n        value: Number(value)\n      });\n    }\n  });\n  return long;\n}\n\nexport function fillGaps(data: Data[], dates: string[], period: 'years' | 'months' | 'days') {\n  const minDate = new Date(formatDate(dates[0], 'YYYY-MM-DD'));\n  const maxDate = new Date(formatDate(dates[dates.length - 1], 'YYYY-MM-DD'));\n\n  const next = {\n    years: (dt: Date) => {\n      dt.setFullYear(dt.getFullYear() + 1);\n    },\n    months: (dt: Date) => {\n      dt.setMonth(dt.getMonth() + 1);\n    },\n    days: (dt: Date) => {\n      dt.setDate(dt.getDate() + 1);\n    }\n  };\n  if (!next[period]) {\n    return data;\n  }\n\n  const dateRange: string[] = [];\n  for (const date = minDate; date < maxDate; next[period](date)) {\n    dateRange.push(getDateString(date));\n  }\n\n  dateRange.forEach((date, index) => {\n    if (data.filter(d => d.date === date).length > 0) {\n      return;\n    }\n\n    const missing = data\n      .filter(d => d.date === dateRange[index - 1])\n      .map(d =>\n        // const value = {\n        //   last: d.value,\n        //   zero: 0,\n        // }\n        ({\n          ...d,\n          date\n          // value: value[fillDateGapsValue],\n        })\n      );\n\n    data.push(...missing);\n  });\n\n  return data;\n}\n\nexport function getDateSlice(data: Data[], date: string, lastValues: any, topN: number) {\n  return data\n    .filter(d => d.date === date && !isNaN(d.value))\n    .map(d => {\n      if (!lastValues[d.name]) {\n        return d;\n      }\n      const lastValue = lastValues[d.name].value;\n      lastValues[d.name].date = d.date;\n      lastValues[d.name].value = d.value;\n      return { ...d, lastValue };\n    })\n    .sort((a, b) => b.value - a.value)\n    .slice(0, topN)\n    .map((d, i) => ({ ...d, rank: i }));\n}\n"],"names":["zeroPad","n","w","toString","length","getHeight","element","minHeight","height","newHeight","String","startsWith","scale","split","window","innerHeight","getBoundingClientRect","getWidth","minWidth","width","newWidth","innerWidth","getDateString","inputDate","date","Date","isNaN","Error","year","getFullYear","month","getMonth","getDate","formatDate","dateStr","format","slice","day","weekDayIndex","getDay","replace","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","URL","type","d3","json","csv","tsv","xml","data","options","lastValues","dataShape","fillDateGaps","selector","startDate","endDate","colorSeed","disableGroupColors","tickDuration","Number","topN","disableClickEvents","disableKeyboardEvents","autorun","tickerOptions","loop","renderer","renderOptions","margin","svg","x","y","xAxis","barPadding","dateCounterText","labelX","controlButtons","renderInitalView","dateSlice","title","subTitle","caption","dateCounterFormat","labelsOnBars","labelsWidth","showControls","inputHeight","inputWidth","currentDate","document","querySelector","append","attr","top","right","bottom","left","html","domain","d","value","range","ticks","tickSize","tickFormat","call","selectAll","classed","name","enter","Math","abs","rank","style","color","text","lastValue","strokeWidth","select","parentNode","insertBefore","this","cloneNode","position","controls","addElement","rewindButton","playButton","pauseButton","fastforwardButton","rewind","play","pause","fastforward","visibility","display","tag","className","parent","domElement","createElement","classList","add","innerHTML","appendChild","renderControls","renderFrame","transition","duration","ease","bars","exit","remove","labels","valueLabels","tween","i","t","textContent","resize","resetFn","currentPosition","renderAsRunning","running","getRenderedHeight","getRenderedWidth","getControlButtons","createRenderer","ticker","runningCallback","tickerDate","loopOption","start","setRunning","_","isLast","stop","inc","setFirst","flag","tickerDateFactory","dates","updateDateCallback","_renderFrameFn","dateCounter","lastIndex","maxDate","updateDate","newValue","dec","setLast","update","setDate","dateIndex","indexOf","fastForward","toggle","isRunning","createTicker","uniqueDates","Set","forEach","Array","from","sort","getDates","long","item","Object","entries","push","map","hsl","seed","s","nums","charCodeAt","toNumbers","group","sin","floor","getColor","prepareData","filter","filterDates","period","minDate","next","years","dt","setFullYear","months","setMonth","days","dateRange","index","missing","fillGaps","a","b","getDateSlice","dispatchEvent","CustomEvent","detail","addEventListener","e","keyCode","currentlyRunning","getAllDates","createScroller","scrollElement","body","prepareDOM","step","clientHeight","ceil","pageYOffset"],"mappings":"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"}