{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/options/options.actions.ts","../../src/lib/options/options.reducer.ts","../../src/lib/ticker/ticker.actions.ts","../../src/lib/ticker/ticker.reducer.ts","../../src/lib/ticker/ticker.ts","../../src/lib/store/actions.ts","../../src/lib/store/reducer.ts","../../src/lib/store/state.ts","../../src/lib/store/store.ts","../../src/lib/utils.ts","../../src/lib/dates.ts","../../src/lib/data-utils.ts","../../src/lib/events.ts","../../src/lib/elements.ts","../../src/lib/load-data.ts","../../src/lib/race.ts","../../src/lib/styles/style-inject.ts","../../src/lib/renderer.ts","../../src/lib/scroller.ts"],"sourcesContent":["import { Options, OptionsAction } from './options.models';\r\n\r\nexport const actionTypes = {\r\n  optionsLoaded: 'options/loaded',\r\n  changeOptions: 'options/change',\r\n  optionsChanged: 'options/changed',\r\n};\r\n\r\nexport const optionsLoaded = (options: Options): OptionsAction => ({\r\n  type: actionTypes.optionsLoaded,\r\n  payload: options,\r\n});\r\n\r\nexport const changeOptions = (options: Options): OptionsAction => ({\r\n  type: actionTypes.changeOptions,\r\n  payload: options,\r\n});\r\n\r\nexport const optionsChanged = (options: Options): OptionsAction => ({\r\n  type: actionTypes.optionsChanged,\r\n  payload: options,\r\n});\r\n","import { getDateString } from '../dates';\nimport { Options, OptionsAction } from './options.models';\nimport { actionTypes } from './options.actions';\n\nconst initialState: Options = {\n  selector: '#race',\n  dataShape: 'long',\n  fillDateGaps: false,\n  fillDateGapsValue: 'last',\n  startDate: '',\n  endDate: '',\n  colorSeed: '',\n  disableGroupColors: false,\n  tickDuration: 500,\n  topN: 10,\n  disableClickEvents: true,\n  disableKeyboardEvents: false,\n  autorun: true,\n  loop: false,\n  injectStyles: true,\n  title: '18 years of Top Global Brands',\n  subTitle: 'Brand value, $m',\n  caption: 'Source: Interbrand',\n  dateCounterFormat: 'YYYY',\n  labelsOnBars: true,\n  labelsWidth: 100,\n  showControls: 'all',\n  showOverlays: 'all',\n  inputHeight: '',\n  inputWidth: '',\n  minHeight: 300,\n  minWidth: 500,\n  height: '',\n  width: '',\n};\n\nexport function optionsReducer(state = initialState, action: OptionsAction): Options {\n  switch (action.type) {\n    // initial processing of input options\n    case actionTypes.optionsLoaded:\n      const startDate = action.payload.startDate ? getDateString(action.payload.startDate) : '';\n      const endDate = action.payload.endDate ? getDateString(action.payload.endDate) : '';\n      const inputHeight = action.payload.height;\n      const inputWidth = action.payload.width;\n      return {\n        ...state,\n        ...action.payload,\n        startDate,\n        endDate,\n        inputHeight,\n        inputWidth,\n      };\n\n    // change options from code e.g. change height and width on resize\n    case actionTypes.changeOptions:\n      return {\n        ...state,\n        ...action.payload,\n      };\n\n    default:\n      return state;\n  }\n}\n","import { TickerAction } from './ticker.models';\r\n\r\nexport const actionTypes = {\r\n  initialize: 'ticker/initialize',\r\n  updateDate: 'ticker/updateDate',\r\n  setRunning: 'ticker/setRunning',\r\n  setFirst: 'ticker/setFirst',\r\n  setLast: 'ticker/setLast',\r\n  inc: 'ticker/inc',\r\n  dec: 'ticker/dec',\r\n};\r\n\r\nexport const initialize = (dates: string[]): TickerAction => ({\r\n  type: actionTypes.initialize,\r\n  payload: dates,\r\n});\r\n\r\nexport const updateDate = (currentDate: string): TickerAction => ({\r\n  type: actionTypes.updateDate,\r\n  payload: currentDate,\r\n});\r\n\r\nexport const setRunning = (running: boolean): TickerAction => ({\r\n  type: actionTypes.setRunning,\r\n  payload: running,\r\n});\r\n\r\nexport const setFirst = (): TickerAction => ({\r\n  type: actionTypes.setFirst,\r\n});\r\n\r\nexport const setLast = (): TickerAction => ({\r\n  type: actionTypes.setLast,\r\n});\r\n\r\nexport const inc = (value = 1): TickerAction => ({\r\n  type: actionTypes.inc,\r\n  payload: value,\r\n});\r\n\r\nexport const dec = (value = 1): TickerAction => ({\r\n  type: actionTypes.dec,\r\n  payload: value,\r\n});\r\n","import { TickerState, TickerAction } from './ticker.models';\r\nimport { actionTypes } from './ticker.actions';\r\n\r\nconst initialState: TickerState = {\r\n  isRunning: false,\r\n  currentDate: '',\r\n  isFirstDate: true,\r\n  isLastDate: false,\r\n  dates: [],\r\n};\r\n\r\nexport function tickerReducer(state = initialState, action: TickerAction): TickerState {\r\n  switch (action.type) {\r\n    case actionTypes.initialize: {\r\n      const dates = action.payload as string[];\r\n      return {\r\n        ...state,\r\n        isRunning: false,\r\n        currentDate: dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n        dates,\r\n      };\r\n    }\r\n\r\n    case actionTypes.updateDate: {\r\n      const currentDate = action.payload as string;\r\n      if (state.dates.indexOf(currentDate) === -1) {\r\n        return { ...state };\r\n      }\r\n      return {\r\n        ...state,\r\n        currentDate,\r\n        isFirstDate: currentDate === state.dates[0],\r\n        isLastDate: currentDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    case actionTypes.setRunning: {\r\n      return {\r\n        ...state,\r\n        isRunning: action.payload as boolean,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setFirst: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[0],\r\n        isFirstDate: true,\r\n        isLastDate: false,\r\n      };\r\n    }\r\n\r\n    case actionTypes.setLast: {\r\n      return {\r\n        ...state,\r\n        currentDate: state.dates[state.dates.length - 1],\r\n        isFirstDate: false,\r\n        isLastDate: true,\r\n      };\r\n    }\r\n\r\n    case actionTypes.inc: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const lastIndex = state.dates.length - 1;\r\n      const incValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex + incValue > lastIndex\r\n          ? state.dates[lastIndex]\r\n          : state.dates[currentIndex + incValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[lastIndex],\r\n      };\r\n    }\r\n\r\n    case actionTypes.dec: {\r\n      const currentIndex = state.dates.indexOf(state.currentDate);\r\n      const decValue = action.payload as number;\r\n      const newDate =\r\n        currentIndex - decValue < 0 ? state.dates[0] : state.dates[currentIndex - decValue];\r\n      return {\r\n        ...state,\r\n        currentDate: newDate,\r\n        isFirstDate: newDate === state.dates[0],\r\n        isLastDate: newDate === state.dates[state.dates.length - 1],\r\n      };\r\n    }\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import * as d3 from '../d3';\r\nimport { store, actions } from '../store';\r\nimport { Ticker } from './ticker.models';\r\n\r\nexport function createTicker(dates: string[]): Ticker {\r\n  store.dispatch(actions.ticker.initialize(dates));\r\n\r\n  let ticker: d3.Timer;\r\n\r\n  function start() {\r\n    ticker = d3.interval(showRace, store.getState().options.tickDuration);\r\n    store.dispatch(actions.ticker.setRunning(true));\r\n\r\n    function showRace(_: number) {\r\n      if (store.getState().ticker.isLastDate) {\r\n        if (store.getState().options.loop) {\r\n          loop();\r\n        } else {\r\n          stop();\r\n        }\r\n      } else {\r\n        store.dispatch(actions.ticker.inc());\r\n      }\r\n    }\r\n  }\r\n\r\n  function stop() {\r\n    if (ticker) {\r\n      ticker.stop();\r\n    }\r\n    store.dispatch(actions.ticker.setRunning(false));\r\n  }\r\n\r\n  function skipBack() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function loop() {\r\n    store.dispatch(actions.ticker.setFirst());\r\n  }\r\n\r\n  function skipForward() {\r\n    stop();\r\n    store.dispatch(actions.ticker.setLast());\r\n  }\r\n\r\n  function toggle() {\r\n    if (store.getState().ticker.isLastDate) {\r\n      skipBack();\r\n      start();\r\n    } else if (store.getState().ticker.isRunning) {\r\n      stop();\r\n    } else {\r\n      start();\r\n    }\r\n  }\r\n\r\n  function goToDate(date: string) {\r\n    store.dispatch(actions.ticker.updateDate(date));\r\n  }\r\n\r\n  return {\r\n    start,\r\n    stop,\r\n    skipBack,\r\n    loop,\r\n    skipForward,\r\n    toggle,\r\n    goToDate,\r\n  };\r\n}\r\n","import * as options from '../options';\r\nimport * as ticker from '../ticker';\r\n\r\nexport const actions = {\r\n  options,\r\n  ticker,\r\n};\r\n","import { optionsReducer, OptionsAction } from '../options';\r\nimport { tickerReducer, TickerAction } from '../ticker';\r\nimport { Action, State } from './models';\r\n\r\nexport function rootReducer(state: State, action: Action): State {\r\n  return {\r\n    options: optionsReducer(state.options, action as OptionsAction),\r\n    ticker: tickerReducer(state.ticker, action as TickerAction),\r\n  };\r\n}\r\n","import { createStore } from './store';\r\nimport { rootReducer } from './reducer';\r\n\r\nexport const store = createStore(rootReducer);\r\n","import { Action, Reducer, State, Subscriber } from './models';\r\nimport { rootReducer } from './reducer';\r\n\r\nexport function createStore(reducer: Reducer = rootReducer, preloadedState?: State) {\r\n  let state = {} as State;\r\n\r\n  if (preloadedState) {\r\n    state = preloadedState;\r\n  }\r\n\r\n  function dispatch(action: Action) {\r\n    state = reducer(state, action);\r\n    notifySubscribers();\r\n    return action;\r\n  }\r\n\r\n  function getState() {\r\n    return state;\r\n  }\r\n\r\n  const subscribers: Subscriber[] = [];\r\n\r\n  function subscribe(fn: Subscriber) {\r\n    subscribers.push(fn);\r\n    const index = subscribers.length - 1;\r\n\r\n    return {\r\n      unsubscribe: () => {\r\n        subscribers.splice(index, 1);\r\n      },\r\n    };\r\n  }\r\n\r\n  function notifySubscribers() {\r\n    subscribers.forEach((fn: Subscriber) => {\r\n      fn();\r\n    });\r\n  }\r\n\r\n  return {\r\n    getState,\r\n    dispatch,\r\n    subscribe,\r\n  };\r\n}\r\n","import * as d3 from './d3';\r\n\r\nimport { Data } from './models';\r\nimport { store } from './store';\r\n\r\nexport function getColor(d: Data, disableGroupColors: boolean, colorSeed: string) {\r\n  const nameseed = d.group && !disableGroupColors ? d.group : d.name;\r\n  const seed = nameseed + colorSeed;\r\n  return d3.hsl(random(seed) * 360, 0.75, 0.75);\r\n}\r\n\r\nexport function zeroPad(n: string, w: number) {\r\n  while (n.toString().length < w) {\r\n    n = '0' + n;\r\n  }\r\n  return n;\r\n}\r\n\r\nexport function random(seedStr: string) {\r\n  function toNumbers(s: string) {\r\n    let nums = '';\r\n    for (let i = 0; i < s.length; i++) {\r\n      nums += zeroPad(String(s.charCodeAt(i)), 3);\r\n    }\r\n    return nums;\r\n  }\r\n\r\n  const seed = toNumbers(seedStr);\r\n  const x = Math.sin(+seed) * 10000;\r\n  return x - Math.floor(x);\r\n}\r\n\r\nexport function randomString(prefix: string, n: number) {\r\n  const rnd = Array(3)\r\n    .fill(null)\r\n    .map(() => Math.random().toString(36).substr(2))\r\n    .join('');\r\n  return prefix + rnd.slice(-n);\r\n}\r\n\r\nexport function generateId(prefix = 'racingbars', n = 8) {\r\n  return randomString(prefix, n);\r\n}\r\n\r\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\r\n  let newHeight;\r\n  if (!height) {\r\n    newHeight = element.getBoundingClientRect().height;\r\n  } else if (String(height).startsWith('window')) {\r\n    const scale = +height.split('*')[1] || 1;\r\n    newHeight = window.innerHeight * scale;\r\n  } else {\r\n    newHeight = +height;\r\n  }\r\n  return newHeight > minHeight ? newHeight : minHeight;\r\n}\r\n\r\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\r\n  let newWidth;\r\n  if (!width) {\r\n    newWidth = element.getBoundingClientRect().width;\r\n  } else if (String(width).startsWith('window')) {\r\n    const scale = +width.split('*')[1] || 1;\r\n    newWidth = window.innerWidth * scale;\r\n  } else {\r\n    newWidth = +width;\r\n  }\r\n  return newWidth > minWidth ? newWidth : minWidth;\r\n}\r\n\r\nexport function getElement(className: string) {\r\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n  return element.querySelector('.' + className) as HTMLElement;\r\n}\r\n\r\nexport function showElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.style.display = 'flex';\r\n  }\r\n}\r\n\r\nexport function hideElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.style.display = 'none';\r\n  }\r\n}\r\nexport function removeElement(className: string) {\r\n  const selector = store.getState().options.selector;\r\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\r\n  if (element) {\r\n    element.remove();\r\n  }\r\n}\r\n\r\nexport function addEventHandler(className: string, event: string, handler: () => void) {\r\n  const element = getElement(className);\r\n  if (element) {\r\n    element.addEventListener(event, handler);\r\n  }\r\n}\r\n\r\nexport function debounce(func: any, wait: number, immediate = false) {\r\n  let timeout: any;\r\n  return function () {\r\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\r\n    const context = this;\r\n    const args: any = arguments;\r\n    const later = function () {\r\n      timeout = null;\r\n      if (!immediate) {\r\n        func.apply(context, args);\r\n      }\r\n    };\r\n    const callNow = immediate && !timeout;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n    if (callNow) {\r\n      func.apply(context, args);\r\n    }\r\n  };\r\n}\r\n","import { Data } from './models';\nimport { zeroPad } from './utils';\n\nexport function getDates(data: Data[]) {\n  const uniqueDates = new Set<string>();\n  data.forEach((d) => {\n    uniqueDates.add(d.date);\n  });\n  return Array.from(uniqueDates).sort();\n}\n\nexport function filterDates(data: Data[], startDate: string, endDate: string) {\n  return data\n    .filter((d) => (startDate ? d.date >= startDate : true))\n    .filter((d) => (endDate ? d.date <= endDate : true));\n}\n\nexport function getDateString(inputDate: string | Date) {\n  const date = new Date(inputDate);\n  if (isNaN(+date)) {\n    throw new Error(`\"${inputDate}\" is not a valid date`);\n  }\n\n  const year = date.getFullYear();\n\n  let month = (1 + date.getMonth()).toString();\n  month = zeroPad(month, 2);\n\n  let day = date.getDate().toString();\n  day = zeroPad(day, 2);\n\n  return `${year}${month}${day}`;\n}\n\nexport function formatDate(dateStr: string, format: string) {\n  const year = dateStr.slice(0, 4);\n  const month = dateStr.slice(4, 6);\n  const day = dateStr.slice(6, 8);\n  const date = new Date(`${year}-${month}-${day}`);\n  const weekDayIndex = String(date.getDay());\n  const monthNames: { [key: string]: string } = {\n    '01': 'Jan',\n    '02': 'Feb',\n    '03': 'Mar',\n    '04': 'Apr',\n    '05': 'May',\n    '06': 'Jun',\n    '07': 'Jul',\n    '08': 'Aug',\n    '09': 'Sep',\n    '10': 'Oct',\n    '11': 'Nov',\n    '12': 'Dec',\n  };\n\n  const weekDays: { [key: string]: string } = {\n    '0': 'Sun',\n    '1': 'Mon',\n    '2': 'Tue',\n    '3': 'Wed',\n    '4': 'Thu',\n    '5': 'Fri',\n    '6': 'Sat',\n  };\n\n  return format\n    .replace('MMM', monthNames[month])\n    .replace('DDD', weekDays[weekDayIndex])\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day);\n}\n","import { formatDate, getDateString, getDates, filterDates } from './dates';\r\nimport { Data } from './models';\r\nimport { getColor } from './utils';\r\nimport { store } from './store';\r\nimport { Options } from './options';\r\n\r\nexport function prepareData(data: Data[]) {\r\n  const options = store.getState().options;\r\n\r\n  data = filterDates(data, options.startDate, options.endDate);\r\n\r\n  if (options.dataShape === 'wide') {\r\n    data = wideDataToLong(data);\r\n  }\r\n\r\n  if (options.fillDateGaps) {\r\n    data = fillGaps(data, options.fillDateGaps);\r\n  }\r\n\r\n  data = data.map((item) => {\r\n    const d = { ...item };\r\n    d.value = isNaN(+d.value) ? 0 : +d.value;\r\n    d.date = getDateString(d.date);\r\n    d.color = getColor(d, options.disableGroupColors, options.colorSeed);\r\n    return d;\r\n  });\r\n\r\n  data = calculateLastValues(data);\r\n\r\n  return data;\r\n}\r\n\r\nfunction calculateLastValues(data: Data[]) {\r\n  return data\r\n    .sort((a, b) => a.name.localeCompare(b.name) || a.date.localeCompare(b.date))\r\n    .reduce((acc: Data[], curr) => {\r\n      if (acc.length === 0) {\r\n        curr.lastValue = curr.value;\r\n      } else {\r\n        const last = acc[acc.length - 1];\r\n        if (curr.name === last.name) {\r\n          curr.lastValue = last.value;\r\n        } else {\r\n          curr.lastValue = curr.value;\r\n        }\r\n      }\r\n      return [...acc, curr];\r\n    }, [])\r\n    .sort((a, b) => a.date.localeCompare(b.date));\r\n}\r\n\r\nfunction wideDataToLong(wide: any) {\r\n  const long = [] as Data[];\r\n  wide.forEach((item: any) => {\r\n    for (const [key, value] of Object.entries(item)) {\r\n      long.push({\r\n        date: item.date,\r\n        name: key,\r\n        value: Number(value),\r\n      });\r\n    }\r\n  });\r\n  return long;\r\n}\r\n\r\nfunction fillGaps(data: Data[], period: Options['fillDateGaps']) {\r\n  if (!period) {\r\n    return data;\r\n  }\r\n\r\n  const dates = getDates(data);\r\n  const minDate = new Date(formatDate(dates[0], 'YYYY-MM-DD'));\r\n  const maxDate = new Date(formatDate(dates[dates.length - 1], 'YYYY-MM-DD'));\r\n\r\n  const next = {\r\n    years: (dt: Date) => {\r\n      dt.setFullYear(dt.getFullYear() + 1);\r\n    },\r\n    months: (dt: Date) => {\r\n      dt.setMonth(dt.getMonth() + 1);\r\n    },\r\n    days: (dt: Date) => {\r\n      dt.setDate(dt.getDate() + 1);\r\n    },\r\n  };\r\n  if (!next[period]) {\r\n    return data;\r\n  }\r\n\r\n  const dateRange: string[] = [];\r\n  for (const date = minDate; date < maxDate; next[period](date)) {\r\n    dateRange.push(getDateString(date));\r\n  }\r\n\r\n  dateRange.forEach((date, index) => {\r\n    if (data.filter((d) => d.date === date).length > 0) {\r\n      return;\r\n    }\r\n\r\n    const missing = data\r\n      .filter((d) => d.date === dateRange[index - 1])\r\n      .map((d) =>\r\n        // const value = {\r\n        //   last: d.value,\r\n        //   zero: 0,\r\n        // }\r\n        ({\r\n          ...d,\r\n          date,\r\n          // value: value[fillDateGapsValue],\r\n        }),\r\n      );\r\n\r\n    data.push(...missing);\r\n  });\r\n\r\n  return data;\r\n}\r\n\r\nexport function getDateSlice(data: Data[], date: string) {\r\n  return data\r\n    .filter((d) => d.date === date && !isNaN(d.value))\r\n    .sort((a, b) => b.value - a.value)\r\n    .slice(0, store.getState().options.topN)\r\n    .map((d, i) => ({ ...d, rank: i }));\r\n}\r\n","import { elements } from './elements';\nimport { store } from './store';\nimport { Ticker } from './ticker';\nimport { addEventHandler } from './utils';\nimport { formatDate } from './dates';\nimport { DOMCustomEvent } from './models';\n\nexport function registerEvents(element: HTMLElement, ticker: Ticker) {\n  registerControlButtonEvents();\n  registerOverlayEvents();\n  registerClickEvents();\n  registerKeyboardEvents();\n\n  function registerControlButtonEvents() {\n    addEventHandler(elements.skipBack, 'click', ticker.skipBack);\n    addEventHandler(elements.play, 'click', ticker.toggle);\n    addEventHandler(elements.pause, 'click', ticker.toggle);\n    addEventHandler(elements.skipForward, 'click', ticker.skipForward);\n  }\n\n  function registerOverlayEvents() {\n    addEventHandler(elements.overlayPlay, 'click', ticker.start);\n    addEventHandler(elements.overlayRepeat, 'click', () => {\n      ticker.skipBack();\n      ticker.start();\n    });\n  }\n\n  function registerClickEvents() {\n    if (!store.getState().options.disableClickEvents) {\n      const svg = element.querySelector('svg') as SVGSVGElement;\n      svg.addEventListener('click', ticker.toggle);\n      element.addEventListener('dblclick', ticker.skipForward);\n    }\n  }\n\n  function registerKeyboardEvents() {\n    if (!store.getState().options.disableKeyboardEvents) {\n      document.addEventListener('keypress', function (e) {\n        const keyCodes = {\n          spacebar: 32,\n          a: 97,\n          d: 100,\n          s: 115,\n        };\n\n        // TODO: keyCode is deprecated\n        switch (e.keyCode) {\n          case keyCodes.spacebar:\n            ticker.toggle();\n            break;\n          case keyCodes.a:\n            ticker.skipBack();\n            break;\n          case keyCodes.s:\n            ticker.toggle();\n            break;\n          case keyCodes.d:\n            ticker.skipForward();\n            break;\n        }\n      });\n    }\n  }\n}\n\nexport function dispatchDOMEvent(element: HTMLElement, currentDate: string) {\n  element.dispatchEvent(\n    new CustomEvent('racingBars/dateChanged', {\n      bubbles: true,\n      detail: {\n        date: formatDate(currentDate, 'YYYY-MM-DD'),\n        isFirst: store.getState().ticker.isFirstDate,\n        isLast: store.getState().ticker.isLastDate,\n      },\n    } as DOMCustomEvent),\n  );\n}\n\nexport function DOMEventSubscriber(element: HTMLElement) {\n  let lastDate = '';\n  return function () {\n    const currentDate = store.getState().ticker.currentDate;\n    if (currentDate !== lastDate) {\n      dispatchDOMEvent(element, currentDate);\n      lastDate = currentDate;\n    }\n  };\n}\n","export const elements = {\r\n  controls: 'controls',\r\n  skipBack: 'skipBack',\r\n  play: 'play',\r\n  pause: 'pause',\r\n  skipForward: 'skipForward',\r\n  overlay: 'overlay',\r\n  overlayPlay: 'overlayPlay',\r\n  overlayRepeat: 'overlayRepeat',\r\n};\r\n","import * as d3 from './d3';\r\n\r\nexport function loadData(URL: string, type: 'json' | 'csv' | 'tsv' | 'xml' = 'json') {\r\n  switch (type) {\r\n    case 'json':\r\n      return d3.json(URL);\r\n    case 'csv':\r\n      return d3.csv(URL);\r\n    case 'tsv':\r\n      return d3.tsv(URL);\r\n    case 'xml':\r\n      return d3.xml(URL);\r\n    default:\r\n      throw new Error(`Unsupported data type: ${type}`);\r\n  }\r\n}\r\n","import { prepareData } from './data-utils';\nimport { getDates, getDateString, formatDate } from './dates';\nimport { Data } from './models';\nimport { createRenderer } from './renderer';\nimport { createTicker } from './ticker';\nimport * as styles from './styles';\nimport { actions, store } from './store';\nimport { Options } from './options';\nimport { registerEvents, DOMEventSubscriber } from './events';\nimport { createScroller } from './scroller';\n\nexport function race(data: Data[], options: Options) {\n  store.dispatch(actions.options.optionsLoaded(options));\n\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\n  if (!element) {\n    throw new Error('Cannot find element with this selector: ' + store.getState().options.selector);\n  }\n\n  if (store.getState().options.injectStyles) {\n    styles.styleInject(store.getState().options.selector, 'top');\n  }\n\n  data = prepareData(data);\n\n  const dates = getDates(data);\n\n  const ticker = createTicker(dates);\n\n  const renderer = createRenderer(data);\n  renderer.renderInitalView();\n\n  store.subscribe(renderer.renderFrame);\n  store.subscribe(DOMEventSubscriber(element));\n\n  ticker.start();\n\n  if (!store.getState().options.autorun) {\n    ticker.stop();\n  }\n\n  registerEvents(element, ticker);\n  window.addEventListener('resize', resize);\n\n  function resize() {\n    renderer.resize();\n    registerEvents(element, ticker);\n  }\n\n  return {\n    // TODO: validate user input\n    start: () => {\n      if (!store.getState().ticker.isRunning) {\n        ticker.start();\n      }\n    },\n    stop: () => {\n      ticker.stop();\n    },\n    rewind: () => {\n      ticker.skipBack();\n    },\n    fastforward: () => {\n      ticker.skipForward();\n    },\n    loop: () => {\n      ticker.loop();\n    },\n    inc: (value = 1) => {\n      store.dispatch(actions.ticker.inc(value));\n    },\n    dec: (value = 1) => {\n      store.dispatch(actions.ticker.dec(value));\n    },\n    getDate: () => store.getState().ticker.currentDate,\n    setDate: (inputDate: string | Date) => {\n      store.dispatch(actions.ticker.updateDate(getDateString(inputDate)));\n    },\n    getAllDates: () => dates.map((date: string) => formatDate(date, 'YYYY-MM-DD')),\n    createScroller: () => {\n      createScroller(element);\n    },\n  };\n}\n","import { styles } from './styles';\n\n// slightly modifed from https://github.com/egoist/style-inject\nexport function styleInject(selector: string, insertAt = 'top', css = styles) {\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  // replace with selector\n  css = css.split('#selector').join(selector);\n\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const style = document.createElement('style') as HTMLStyleElement | any;\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n","import * as d3 from './d3';\r\n\r\nimport { formatDate } from './dates';\r\nimport { icons } from './icons';\r\nimport { elements } from './elements';\r\nimport { Data, Renderer } from './models';\r\nimport { store } from './store';\r\nimport { getHeight, getWidth, hideElement, showElement, removeElement } from './utils';\r\nimport { getDateSlice } from './data-utils';\r\n\r\nexport function createRenderer(data: Data[]): Renderer {\r\n  let margin: { top: number; right: number; bottom: number; left: number };\r\n  let svg: any;\r\n  let x: d3.ScaleLinear<number, number>;\r\n  let y: d3.ScaleLinear<number, number>;\r\n  let xAxis: d3.Axis<number | { valueOf(): number }>;\r\n  let barPadding: number;\r\n  let dateCounterText: any;\r\n  let labelX: number | ((d: Data) => number);\r\n  let height: number;\r\n  let width: number;\r\n\r\n  function renderInitalView() {\r\n    const {\r\n      selector,\r\n      title,\r\n      subTitle,\r\n      caption,\r\n      dateCounterFormat,\r\n      labelsOnBars,\r\n      labelsWidth,\r\n      inputHeight,\r\n      inputWidth,\r\n      minHeight,\r\n      minWidth,\r\n      topN,\r\n    } = store.getState().options;\r\n\r\n    const dateSlice = getDateSlice(data, store.getState().ticker.currentDate);\r\n    const element = document.querySelector(selector) as HTMLElement;\r\n    element.innerHTML = '';\r\n\r\n    height = getHeight(element, minHeight, inputHeight);\r\n    width = getWidth(element, minWidth, inputWidth);\r\n\r\n    renderInitialFrame();\r\n    renderControls();\r\n    renderOverlays();\r\n    updateControls();\r\n\r\n    function renderInitialFrame() {\r\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\r\n\r\n      margin = {\r\n        top: 80,\r\n        right: 0,\r\n        bottom: 5,\r\n        left: 0 + labelsArea,\r\n      };\r\n\r\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\r\n\r\n      svg = d3 //\r\n        .select(selector)\r\n        .append('svg')\r\n        .attr('width', width)\r\n        .attr('height', height);\r\n\r\n      svg //\r\n        .append('text')\r\n        .attr('class', 'title')\r\n        .attr('y', 24)\r\n        .html(title);\r\n\r\n      svg //\r\n        .append('text')\r\n        .attr('class', 'subTitle')\r\n        .attr('y', 55)\r\n        .html(subTitle);\r\n\r\n      x = d3\r\n        .scaleLinear()\r\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\r\n        .range([margin.left, width - margin.right - 65]);\r\n\r\n      y = d3\r\n        .scaleLinear()\r\n        .domain([topN, 0])\r\n        .range([height - margin.bottom, margin.top]);\r\n\r\n      xAxis = d3\r\n        .axisTop(x)\r\n        .ticks(width > 500 ? 5 : 2)\r\n        .tickSize(-(height - margin.top - margin.bottom))\r\n        .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n));\r\n\r\n      svg\r\n        .append('g')\r\n        .attr('class', 'axis xAxis')\r\n        .attr('transform', `translate(0, ${margin.top})`)\r\n        .call(xAxis)\r\n        .selectAll('.tick line')\r\n        .classed('origin', (d: number) => d === 0);\r\n\r\n      svg\r\n        .selectAll('rect.bar')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('rect')\r\n        .attr('class', 'bar')\r\n        .attr('x', x(0) + 1)\r\n        .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n        .attr('y', (d: Data) => y(d.rank as number) + 5)\r\n        .attr('height', y(1) - y(0) - barPadding)\r\n        .style('fill', (d: Data) => d.color);\r\n\r\n      labelX = labelsOnBars ? (d: Data) => x(d.value) - 8 : margin.left - 8;\r\n\r\n      svg\r\n        .selectAll('text.label')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('text')\r\n        .attr('class', 'label')\r\n        .attr('x', labelX)\r\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\r\n        .style('text-anchor', 'end')\r\n        .html((d: Data) => d.name);\r\n      svg\r\n        .selectAll('text.valueLabel')\r\n        .data(dateSlice, (d: Data) => d.name)\r\n        .enter()\r\n        .append('text')\r\n        .attr('class', 'valueLabel')\r\n        .attr('x', (d: Data) => x(d.value) + 5)\r\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\r\n        .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\r\n\r\n      const strokeWidth = 10;\r\n\r\n      dateCounterText = svg\r\n        .append('text')\r\n        .attr('class', 'dateCounterText')\r\n        .attr('x', width - margin.right - barPadding)\r\n        .attr('y', height - 40)\r\n        .style('text-anchor', 'end')\r\n        .html(formatDate(store.getState().ticker.currentDate, dateCounterFormat))\r\n        .call(halo, strokeWidth);\r\n\r\n      svg\r\n        .append('text')\r\n        .attr('class', 'caption')\r\n        .attr('x', width - margin.right - barPadding - strokeWidth)\r\n        .attr('y', height - margin.bottom - barPadding)\r\n        .style('text-anchor', 'end')\r\n        .html(caption);\r\n\r\n      // TODO: animate halo\r\n      function halo(text: any, strokeWidth: number) {\r\n        text\r\n          .select(function () {\r\n            return this.parentNode.insertBefore(this.cloneNode(true), this);\r\n          })\r\n          .style('fill', '#ffffff')\r\n          .style('stroke', '#ffffff')\r\n          .style('stroke-width', strokeWidth)\r\n          .style('stroke-linejoin', 'round')\r\n          .style('opacity', 1);\r\n      }\r\n    }\r\n\r\n    function renderControls() {\r\n      const controlIcons = [\r\n        { skipBack: icons.skipBack },\r\n        { play: icons.play },\r\n        { pause: icons.pause },\r\n        { skipForward: icons.skipForward },\r\n      ];\r\n\r\n      const elementWidth = element.getBoundingClientRect().width;\r\n\r\n      d3.select(selector)\r\n        .append('div')\r\n        .classed('controls', true)\r\n        .style('width', width)\r\n        .style('right', elementWidth - width + margin.right + barPadding + 'px')\r\n        .selectAll('div')\r\n        .data(controlIcons)\r\n        .enter()\r\n        .append('div')\r\n        .html((d) => Object.values(d)[0] as string)\r\n        .attr('class', (d) => Object.keys(d)[0]);\r\n    }\r\n\r\n    function renderOverlays() {\r\n      const overlayIcons = [\r\n        { overlayPlay: icons.overlayPlay },\r\n        { overlayRepeat: icons.overlayRepeat },\r\n      ];\r\n\r\n      d3.select(selector)\r\n        .append('div')\r\n        .classed('overlay', true)\r\n        .style('minHeight', minHeight + 'px')\r\n        .style('minWidth', minWidth + 'px')\r\n        .selectAll('div')\r\n        .data(overlayIcons)\r\n        .enter()\r\n        .append('div')\r\n        .html((d) => Object.values(d)[0] as string)\r\n        .attr('class', (d) => Object.keys(d)[0]);\r\n    }\r\n  }\r\n\r\n  function renderFrame() {\r\n    if (!x) {\r\n      return;\r\n    }\r\n\r\n    const { tickDuration, topN, dateCounterFormat } = store.getState().options;\r\n    const dateSlice = getDateSlice(data, store.getState().ticker.currentDate);\r\n\r\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\r\n\r\n    svg //\r\n      .select('.xAxis')\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .call(xAxis);\r\n\r\n    const bars = svg //\r\n      .selectAll('.bar')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    bars\r\n      .enter()\r\n      .append('rect')\r\n      .attr('class', (d: Data) => `bar ${d.name.replace(/\\s/g, '_')}`)\r\n      .attr('x', x(0) + 1)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .attr('height', y(1) - y(0) - barPadding)\r\n      .style('fill', (d: Data) => d.color)\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\r\n\r\n    bars\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\r\n\r\n    bars\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    const labels = svg //\r\n      .selectAll('.label')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    labels\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'label')\r\n      .attr('x', labelX)\r\n      .attr('y', () => y(topN + 1) + 5 + (y(1) - y(0)) / 2)\r\n      .style('text-anchor', 'end')\r\n      .html((d: Data) => d.name)\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\r\n\r\n    labels\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', labelX)\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\r\n\r\n    labels\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', labelX)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    const valueLabels = svg //\r\n      .selectAll('.valueLabel')\r\n      .data(dateSlice, (d: Data) => d.name);\r\n\r\n    valueLabels\r\n      .enter()\r\n      .append('text')\r\n      .attr('class', 'valueLabel')\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\r\n\r\n    valueLabels\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\r\n      .tween('text', function (d: Data) {\r\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\r\n        return function (t: number) {\r\n          this.textContent = d3.format(',')(i(t));\r\n        };\r\n      });\r\n\r\n    valueLabels\r\n      .exit()\r\n      .transition()\r\n      .duration(tickDuration)\r\n      .ease(d3.easeLinear)\r\n      .attr('x', (d: Data) => x(d.value) + 5)\r\n      .attr('y', () => y(topN + 1) + 5)\r\n      .remove();\r\n\r\n    dateCounterText.html(formatDate(store.getState().ticker.currentDate, dateCounterFormat));\r\n\r\n    updateControls();\r\n  }\r\n\r\n  function resize() {\r\n    if (\r\n      (!store.getState().options.inputHeight && !store.getState().options.inputWidth) ||\r\n      String(store.getState().options.inputHeight).startsWith('window') ||\r\n      String(store.getState().options.inputWidth).startsWith('window')\r\n    ) {\r\n      const element = document.querySelector(store.getState().options.selector) as HTMLElement;\r\n\r\n      height = getHeight(\r\n        element,\r\n        store.getState().options.minHeight,\r\n        store.getState().options.inputHeight,\r\n      );\r\n      width = getWidth(\r\n        element,\r\n        store.getState().options.minWidth,\r\n        store.getState().options.inputWidth,\r\n      );\r\n\r\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\r\n      renderInitalView();\r\n      renderFrame();\r\n      updateControls();\r\n      element.style.position = currentPosition;\r\n    }\r\n  }\r\n\r\n  function updateControls() {\r\n    const showControls = store.getState().options.showControls;\r\n    const showOverlays = store.getState().options.showOverlays;\r\n\r\n    if (showControls === 'play') {\r\n      removeElement(elements.skipBack);\r\n      removeElement(elements.skipForward);\r\n    } else if (showControls === 'none') {\r\n      removeElement(elements.controls);\r\n    }\r\n\r\n    if (store.getState().ticker.isRunning) {\r\n      showElement(elements.pause);\r\n      hideElement(elements.play);\r\n    } else {\r\n      showElement(elements.play);\r\n      hideElement(elements.pause);\r\n    }\r\n\r\n    if (\r\n      store.getState().ticker.isFirstDate &&\r\n      !store.getState().ticker.isRunning &&\r\n      (showOverlays === 'all' || showOverlays === 'play')\r\n    ) {\r\n      showElement(elements.overlay);\r\n      hideElement(elements.controls);\r\n      showElement(elements.overlayPlay);\r\n      hideElement(elements.overlayRepeat);\r\n    } else if (\r\n      store.getState().ticker.isLastDate &&\r\n      !store.getState().ticker.isRunning &&\r\n      !store.getState().options.loop &&\r\n      (showOverlays === 'all' || showOverlays === 'repeat')\r\n    ) {\r\n      setTimeout(() => {\r\n        showElement(elements.overlay);\r\n        hideElement(elements.controls);\r\n        showElement(elements.overlayRepeat);\r\n        hideElement(elements.overlayPlay);\r\n      }, store.getState().options.tickDuration);\r\n    } else {\r\n      showElement(elements.controls);\r\n      hideElement(elements.overlay);\r\n    }\r\n  }\r\n\r\n  return {\r\n    renderInitalView,\r\n    renderFrame,\r\n    resize,\r\n  };\r\n}\r\n","import { store, actions } from './store';\r\n\r\nexport function createScroller(element: HTMLElement) {\r\n  const dates = store.getState().ticker.dates;\r\n  prepareDOM();\r\n\r\n  const step = document.body.clientHeight / dates.length;\r\n\r\n  subscribeToEvents();\r\n\r\n  function prepareDOM() {\r\n    element.style.position = 'fixed';\r\n    element.style.top = '0';\r\n\r\n    const scrollElement = document.createElement('div');\r\n    scrollElement.style.height = window.innerHeight * 10 + 'px';\r\n    document.body.appendChild(scrollElement);\r\n  }\r\n\r\n  function subscribeToEvents() {\r\n    window.addEventListener('scroll', goToDate);\r\n    // element.addEventListener(\"dateChanged\", scrollToPosition);\r\n  }\r\n\r\n  // function scrollToPosition(e: CustomEvent) {\r\n  //   let currentDate = getDateString(e.detail.date);\r\n  //   let index = dates.indexOf(currentDate);\r\n  //   ignoreNextScrollEvent = true;\r\n  //   window.scroll({\r\n  //     top: index * step,\r\n  //     behavior: \"smooth\",\r\n  //   });\r\n  // }\r\n\r\n  function goToDate() {\r\n    const index = Math.ceil(window.pageYOffset / step);\r\n    if (index < dates.length) {\r\n      store.dispatch(actions.ticker.updateDate(dates[index]));\r\n    } else {\r\n      store.dispatch(actions.ticker.setLast());\r\n    }\r\n  }\r\n}\r\n"],"names":["actionTypes","optionsLoaded","changeOptions","optionsChanged","initialState","selector","dataShape","fillDateGaps","fillDateGapsValue","startDate","endDate","colorSeed","disableGroupColors","tickDuration","topN","disableClickEvents","disableKeyboardEvents","autorun","loop","injectStyles","title","subTitle","caption","dateCounterFormat","labelsOnBars","labelsWidth","showControls","showOverlays","inputHeight","inputWidth","minHeight","minWidth","height","width","optionsReducer","state","action","type","payload","getDateString","initialize","updateDate","setRunning","setFirst","setLast","inc","dec","isRunning","currentDate","isFirstDate","isLastDate","dates","tickerReducer","indexOf","length","currentIndex","lastIndex","incValue","newDate","decValue","createTicker","ticker","start","d3","_","store","getState","options","stop","dispatch","actions","skipBack","skipForward","toggle","goToDate","date","running","value","rootReducer","reducer","preloadedState","subscribers","forEach","fn","subscribe","push","index","unsubscribe","splice","createStore","zeroPad","n","w","toString","getHeight","element","newHeight","String","startsWith","scale","split","window","innerHeight","getBoundingClientRect","getWidth","newWidth","innerWidth","showElement","className","document","querySelector","style","display","hideElement","removeElement","remove","addEventHandler","event","handler","getElement","addEventListener","getDates","data","uniqueDates","Set","d","add","Array","from","sort","inputDate","Date","isNaN","Error","year","getFullYear","month","getMonth","getDate","formatDate","dateStr","format","slice","day","weekDayIndex","getDay","replace","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","getDateSlice","filter","a","b","map","i","rank","registerEvents","e","keyCode","prefix","fill","Math","random","substr","join","randomString","URL","insertAt","css","head","getElementsByTagName","createElement","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","styles","long","filterDates","item","Object","entries","name","Number","period","minDate","maxDate","next","years","dt","setFullYear","months","setMonth","days","setDate","dateRange","missing","fillGaps","localeCompare","reduce","acc","curr","lastValue","last","calculateLastValues","color","seed","s","nums","charCodeAt","toNumbers","group","x","sin","floor","getColor","prepareData","renderer","margin","svg","y","xAxis","barPadding","dateCounterText","labelX","renderInitalView","controlIcons","elementWidth","overlayIcons","dateSlice","innerHTML","top","right","bottom","left","append","attr","html","domain","range","ticks","tickSize","tickFormat","call","selectAll","classed","enter","abs","text","strokeWidth","select","parentNode","this","cloneNode","play","pause","values","keys","overlayPlay","overlayRepeat","updateControls","renderFrame","transition","duration","ease","bars","exit","labels","valueLabels","tween","t","textContent","setTimeout","resize","currentPosition","position","createRenderer","lastDate","dispatchEvent","CustomEvent","bubbles","detail","isFirst","isLast","dispatchDOMEvent","DOMEventSubscriber","rewind","fastforward","getAllDates","createScroller","scrollElement","body","prepareDOM","step","clientHeight","ceil","pageYOffset"],"mappings":"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"}