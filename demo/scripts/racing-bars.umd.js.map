{"version":3,"file":"racing-bars.umd.js","sources":["../../src/lib/options/options.actions.ts","../../src/lib/options/options.reducer.ts","../../src/lib/renderer/renderer.actions.ts","../../src/lib/renderer/renderer.reducer.ts","../../src/lib/renderer/renderer.ts","../../src/lib/elements.ts","../../src/lib/ticker/ticker.actions.ts","../../src/lib/ticker/ticker.reducer.ts","../../src/lib/ticker/ticker.ts","../../src/lib/store/actions.ts","../../src/lib/store/reducer.ts","../../src/lib/store/state.ts","../../src/lib/store/store.ts","../../src/lib/utils.ts","../../src/lib/dates.ts","../../src/lib/data-utils.ts","../../src/lib/load-data.ts","../../src/lib/race.ts","../../src/lib/styles/style-inject.ts"],"sourcesContent":["import { Options, OptionsAction } from './options.models';\r\n\r\nexport const actionTypes = {\r\n  optionsLoaded: 'options/loaded',\r\n  changeOptions: 'options/change',\r\n  optionsChanged: 'options/changed',\r\n};\r\n\r\nexport const optionsLoaded = (options: Options): OptionsAction => ({\r\n  type: actionTypes.optionsLoaded,\r\n  payload: options,\r\n});\r\n\r\nexport const changeOptions = (options: Options): OptionsAction => ({\r\n  type: actionTypes.changeOptions,\r\n  payload: options,\r\n});\r\n\r\nexport const optionsChanged = (options: Options): OptionsAction => ({\r\n  type: actionTypes.optionsChanged,\r\n  payload: options,\r\n});\r\n","import { getDateString } from '..';\r\nimport { Options, OptionsAction } from './options.models';\r\nimport { actionTypes } from './options.actions';\r\n\r\nconst initialState: Options = {\r\n  selector: '#race',\r\n  dataShape: 'long',\r\n  fillDateGaps: false,\r\n  fillDateGapsValue: 'last',\r\n  startDate: '',\r\n  endDate: '',\r\n  colorSeed: '',\r\n  disableGroupColors: false,\r\n  tickDuration: 500,\r\n  topN: 10,\r\n  disableClickEvents: true,\r\n  disableKeyboardEvents: false,\r\n  autorun: true,\r\n  loop: false,\r\n  injectStyles: true,\r\n  title: '18 years of Top Global Brands',\r\n  subTitle: 'Brand value, $m',\r\n  caption: 'Source: Interbrand',\r\n  dateCounterFormat: 'YYYY',\r\n  labelsOnBars: true,\r\n  labelsWidth: 100,\r\n  showControls: 'all',\r\n  showOverlays: 'all',\r\n  inputHeight: '',\r\n  inputWidth: '',\r\n  minHeight: 300,\r\n  minWidth: 500,\r\n  height: '',\r\n  width: '',\r\n};\r\n\r\nexport function optionsReducer(state = initialState, action: OptionsAction): Options {\r\n  switch (action.type) {\r\n    // initial processing of input options\r\n    case actionTypes.optionsLoaded:\r\n      const startDate = action.payload.startDate ? getDateString(action.payload.startDate) : '';\r\n      const endDate = action.payload.endDate ? getDateString(action.payload.endDate) : '';\r\n      const inputHeight = action.payload.height;\r\n      const inputWidth = action.payload.width;\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n        startDate,\r\n        endDate,\r\n        inputHeight,\r\n        inputWidth,\r\n      };\r\n\r\n    // change options from code e.g. change height and width on resize\r\n    case actionTypes.changeOptions:\r\n      return {\r\n        ...state,\r\n        ...action.payload,\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n","import { Button, ResizeOptions, RendererAction } from './renderer.models';\n\nexport const actionTypes = {\n  buttonPress: 'renderer/buttonPress',\n  click: 'renderer/click',\n  keyPress: 'renderer/keyPress',\n  resize: 'renderer/resize',\n};\n\nexport const buttonPress = (button: Button): RendererAction => ({\n  type: actionTypes.buttonPress,\n  payload: button,\n});\n\nexport const click = (): RendererAction => ({ type: actionTypes.click });\n\nexport const keyPress = (keyCode: string): RendererAction => ({\n  type: actionTypes.keyPress,\n  payload: keyCode,\n});\n\nexport const resize = (options: ResizeOptions): RendererAction => ({\n  type: actionTypes.resize,\n  payload: options,\n});\n","import { TickerAction } from '../ticker';\nimport { actions } from '../store';\nimport { RendererState, Button, RendererAction } from './renderer.models';\nimport { actionTypes } from './renderer.actions';\n\nconst initialState: RendererState = {\n  controls: {\n    controlsContainer: true,\n    skipBack: true,\n    play: true,\n    pause: true,\n    skipForward: true,\n    overlayContainer: true,\n    overlayPlay: true,\n    overlayRepeat: true,\n  },\n  dimensions: {\n    renderedHeight: 0,\n    renderedWidth: 0,\n    elementHeight: 0,\n    elementWidth: 0,\n    windowHeight: 0,\n    windowWidth: 0,\n  },\n};\n\nexport function rendererReducer(\n  state = initialState,\n  action: RendererAction | TickerAction,\n): RendererState {\n  switch (action.type) {\n    case actions.ticker.actionTypes.setFirst:\n    case actions.ticker.actionTypes.setLast:\n    case actions.ticker.actionTypes.inc:\n    case actions.ticker.actionTypes.dec:\n    case actions.ticker.actionTypes.updateDate: {\n      return { ...state };\n    }\n\n    case actionTypes.buttonPress: {\n      const button = action.payload as Button;\n\n      switch (button) {\n        case 'play':\n      }\n\n      const newButtonsState = { ...state.controls };\n      newButtonsState[button] = !newButtonsState[button];\n\n      return { ...state };\n    }\n\n    case actionTypes.click:\n\n    case actionTypes.keyPress:\n\n    default:\n      return state;\n  }\n}\n","import * as d3 from '../d3';\n\nimport { formatDate } from '../dates';\nimport { icons } from '../icons';\nimport { elements } from '../elements';\nimport { Data } from '../models';\nimport { store } from '../store';\nimport { getHeight, getWidth, hideElement, showElement } from '../utils';\nimport { getDateSlice } from '../data-utils';\n\nexport function createRenderer(data: Data[]) {\n  let margin: { top: number; right: number; bottom: number; left: number };\n  let svg: any;\n  let x: d3.ScaleLinear<number, number>;\n  let y: d3.ScaleLinear<number, number>;\n  let xAxis: d3.Axis<number | { valueOf(): number }>;\n  let barPadding: number;\n  let dateCounterText: any;\n  let labelX: number | ((d: Data) => number);\n  let height: number;\n  let width: number;\n\n  function renderInitalView() {\n    const {\n      selector,\n      title,\n      subTitle,\n      caption,\n      dateCounterFormat,\n      labelsOnBars,\n      labelsWidth,\n      inputHeight,\n      inputWidth,\n      minHeight,\n      minWidth,\n      topN,\n    } = store.getState().options;\n\n    const dateSlice = getDateSlice(data, store.getState().ticker.currentDate);\n    const element = document.querySelector(selector) as HTMLElement;\n    element.innerHTML = '';\n\n    height = getHeight(element, minHeight, inputHeight);\n    width = getWidth(element, minWidth, inputWidth);\n\n    renderInitialFrame();\n    renderControls();\n    renderOverlays();\n    updateControls();\n\n    function renderInitialFrame() {\n      const labelsArea = labelsOnBars ? 0 : labelsWidth;\n\n      margin = {\n        top: 80,\n        right: 0,\n        bottom: 5,\n        left: 0 + labelsArea,\n      };\n\n      barPadding = (height - (margin.bottom + margin.top)) / (topN * 5);\n\n      svg = d3 //\n        .select(selector)\n        .append('svg')\n        .attr('width', width)\n        .attr('height', height);\n\n      svg //\n        .append('text')\n        .attr('class', 'title')\n        .attr('y', 24)\n        .html(title);\n\n      svg //\n        .append('text')\n        .attr('class', 'subTitle')\n        .attr('y', 55)\n        .html(subTitle);\n\n      x = d3\n        .scaleLinear()\n        .domain([0, d3.max(dateSlice, (d: Data) => d.value) as number])\n        .range([margin.left, width - margin.right - 65]);\n\n      y = d3\n        .scaleLinear()\n        .domain([topN, 0])\n        .range([height - margin.bottom, margin.top]);\n\n      xAxis = d3\n        .axisTop(x)\n        .ticks(width > 500 ? 5 : 2)\n        .tickSize(-(height - margin.top - margin.bottom))\n        .tickFormat((n: number | { valueOf(): number }) => d3.format(',')(n));\n\n      svg\n        .append('g')\n        .attr('class', 'axis xAxis')\n        .attr('transform', `translate(0, ${margin.top})`)\n        .call(xAxis)\n        .selectAll('.tick line')\n        .classed('origin', (d: number) => d === 0);\n\n      svg\n        .selectAll('rect.bar')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('x', x(0) + 1)\n        .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n        .attr('y', (d: Data) => y(d.rank as number) + 5)\n        .attr('height', y(1) - y(0) - barPadding)\n        .style('fill', (d: Data) => d.color);\n\n      labelX = labelsOnBars ? (d: Data) => x(d.value) - 8 : margin.left - 8;\n\n      svg\n        .selectAll('text.label')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'label')\n        .attr('x', labelX)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .style('text-anchor', 'end')\n        .html((d: Data) => d.name);\n      svg\n        .selectAll('text.valueLabel')\n        .data(dateSlice, (d: Data) => d.name)\n        .enter()\n        .append('text')\n        .attr('class', 'valueLabel')\n        .attr('x', (d: Data) => x(d.value) + 5)\n        .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n        .text((d: Data) => d3.format(',.0f')(d.lastValue as number));\n\n      const strokeWidth = 10;\n\n      dateCounterText = svg\n        .append('text')\n        .attr('class', 'dateCounterText')\n        .attr('x', width - margin.right - barPadding)\n        .attr('y', height - 40)\n        .style('text-anchor', 'end')\n        .html(formatDate(store.getState().ticker.currentDate, dateCounterFormat))\n        .call(halo, strokeWidth);\n\n      svg\n        .append('text')\n        .attr('class', 'caption')\n        .attr('x', width - margin.right - barPadding - strokeWidth)\n        .attr('y', height - margin.bottom - barPadding)\n        .style('text-anchor', 'end')\n        .html(caption);\n\n      // TODO: animate halo\n      function halo(text: any, strokeWidth: number) {\n        text\n          .select(function () {\n            return this.parentNode.insertBefore(this.cloneNode(true), this);\n          })\n          .style('fill', '#ffffff')\n          .style('stroke', '#ffffff')\n          .style('stroke-width', strokeWidth)\n          .style('stroke-linejoin', 'round')\n          .style('opacity', 1);\n      }\n    }\n\n    function renderControls() {\n      const controlIcons = [\n        { skipBack: icons.skipBack },\n        { play: icons.play },\n        { pause: icons.pause },\n        { skipForward: icons.skipForward },\n      ];\n\n      const elementWidth = element.getBoundingClientRect().width;\n\n      d3.select(selector)\n        .append('div')\n        .classed('controls', true)\n        .style('width', width)\n        .style('right', elementWidth - width + margin.right + barPadding + 'px')\n        .selectAll('div')\n        .data(controlIcons)\n        .enter()\n        .append('div')\n        .html((d) => Object.values(d)[0] as string)\n        .attr('class', (d) => Object.keys(d)[0]);\n    }\n\n    function renderOverlays() {\n      const overlayIcons = [\n        { overlayPlay: icons.overlayPlay },\n        { overlayRepeat: icons.overlayRepeat },\n      ];\n\n      d3.select(selector)\n        .append('div')\n        .classed('overlay', true)\n        .style('minHeight', minHeight + 'px')\n        .style('minWidth', minWidth + 'px')\n        .selectAll('div')\n        .data(overlayIcons)\n        .enter()\n        .append('div')\n        .html((d) => Object.values(d)[0] as string)\n        .attr('class', (d) => Object.keys(d)[0]);\n    }\n  }\n\n  function renderFrame() {\n    if (!x) {\n      return;\n    }\n\n    const { tickDuration, topN, dateCounterFormat } = store.getState().options;\n    const dateSlice = getDateSlice(data, store.getState().ticker.currentDate);\n\n    x.domain([0, d3.max(dateSlice, (d: Data) => d.value) as number]);\n\n    svg //\n      .select('.xAxis')\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .call(xAxis);\n\n    const bars = svg //\n      .selectAll('.bar')\n      .data(dateSlice, (d: Data) => d.name);\n\n    bars\n      .enter()\n      .append('rect')\n      .attr('class', (d: Data) => `bar ${d.name.replace(/\\s/g, '_')}`)\n      .attr('x', x(0) + 1)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .attr('height', y(1) - y(0) - barPadding)\n      .style('fill', (d: Data) => d.color)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', (d: Data) => y(d.rank as number) + 5);\n\n    bars\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('width', (d: Data) => Math.abs(x(d.value) - x(0) - 1))\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const labels = svg //\n      .selectAll('.label')\n      .data(dateSlice, (d: Data) => d.name);\n\n    labels\n      .enter()\n      .append('text')\n      .attr('class', 'label')\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5 + (y(1) - y(0)) / 2)\n      .style('text-anchor', 'end')\n      .html((d: Data) => d.name)\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    labels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', labelX)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    const valueLabels = svg //\n      .selectAll('.valueLabel')\n      .data(dateSlice, (d: Data) => d.name);\n\n    valueLabels\n      .enter()\n      .append('text')\n      .attr('class', 'valueLabel')\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .text((d: Data) => d3.format(',.0f')(d.lastValue as number))\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1);\n\n    valueLabels\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', (d: Data) => y(d.rank as number) + 5 + (y(1) - y(0)) / 2 + 1)\n      .tween('text', function (d: Data) {\n        const i = d3.interpolateRound(d.lastValue as number, d.value);\n        return function (t: number) {\n          this.textContent = d3.format(',')(i(t));\n        };\n      });\n\n    valueLabels\n      .exit()\n      .transition()\n      .duration(tickDuration)\n      .ease(d3.easeLinear)\n      .attr('x', (d: Data) => x(d.value) + 5)\n      .attr('y', () => y(topN + 1) + 5)\n      .remove();\n\n    dateCounterText.html(formatDate(store.getState().ticker.currentDate, dateCounterFormat));\n\n    updateControls();\n  }\n\n  function resize(resetFn: () => void) {\n    if (\n      (!store.getState().options.inputHeight && !store.getState().options.inputWidth) ||\n      String(store.getState().options.inputHeight).startsWith('window') ||\n      String(store.getState().options.inputWidth).startsWith('window')\n    ) {\n      const element = document.querySelector(store.getState().options.selector) as HTMLElement;\n\n      height = getHeight(\n        element,\n        store.getState().options.minHeight,\n        store.getState().options.inputHeight,\n      );\n      width = getWidth(\n        element,\n        store.getState().options.minWidth,\n        store.getState().options.inputWidth,\n      );\n\n      const currentPosition = element.style.position; // \"fixed\" if scrolling\n      resetFn();\n      element.style.position = currentPosition;\n    }\n  }\n\n  function updateControls() {\n    const showControls = store.getState().options.showControls;\n    const showOverlays = store.getState().options.showOverlays;\n\n    if (showControls === 'play') {\n      hideElement(elements.skipBack);\n      hideElement(elements.skipForward);\n    } else if (showControls === 'none') {\n      hideElement(elements.controls);\n    } else {\n      showElement(elements.controls);\n    }\n\n    if (store.getState().ticker.isRunning) {\n      showElement(elements.pause);\n      hideElement(elements.play);\n    } else {\n      showElement(elements.play);\n      hideElement(elements.pause);\n    }\n\n    if (\n      store.getState().ticker.isFirstDate &&\n      (showOverlays === 'all' || showOverlays === 'play')\n    ) {\n      showElement(elements.overlay);\n      hideElement(elements.controls);\n      showElement(elements.overlayPlay);\n      hideElement(elements.overlayRepeat);\n    } else if (\n      store.getState().ticker.isLastDate &&\n      (showOverlays === 'all' || showOverlays === 'repeat')\n    ) {\n      showElement(elements.overlay);\n      hideElement(elements.controls);\n      showElement(elements.overlayRepeat);\n      hideElement(elements.overlayPlay);\n    } else {\n      showElement(elements.controls);\n      hideElement(elements.overlay);\n    }\n  }\n\n  return {\n    renderInitalView,\n    renderFrame,\n    resize,\n    updateControls,\n    getRenderedHeight: () => height,\n    getRenderedWidth: () => width,\n  };\n}\n","export const elements = {\n  controls: 'controls',\n  skipBack: 'skipBack',\n  play: 'play',\n  pause: 'pause',\n  skipForward: 'skipForward',\n  overlay: 'overlay',\n  overlayPlay: 'overlayPlay',\n  overlayRepeat: 'overlayRepeat',\n};\n","import { TickerAction } from './ticker.models';\n\nexport const actionTypes = {\n  initialize: 'ticker/initialize',\n  updateDate: 'ticker/updateDate',\n  setRunning: 'ticker/setRunning',\n  setFirst: 'ticker/setFirst',\n  setLast: 'ticker/setLast',\n  inc: 'ticker/inc',\n  dec: 'ticker/dec',\n};\n\nexport const initialize = (dates: string[]): TickerAction => ({\n  type: actionTypes.initialize,\n  payload: dates,\n});\n\nexport const updateDate = (currentDate: string): TickerAction => ({\n  type: actionTypes.updateDate,\n  payload: currentDate,\n});\n\nexport const setRunning = (running: boolean): TickerAction => ({\n  type: actionTypes.setRunning,\n  payload: running,\n});\n\nexport const setFirst = (): TickerAction => ({\n  type: actionTypes.setFirst,\n});\n\nexport const setLast = (): TickerAction => ({\n  type: actionTypes.setLast,\n});\n\nexport const inc = (value = 1): TickerAction => ({\n  type: actionTypes.inc,\n  payload: value,\n});\n\nexport const dec = (value = 1): TickerAction => ({\n  type: actionTypes.dec,\n  payload: value,\n});\n","import { TickerState, TickerAction } from './ticker.models';\nimport { actionTypes } from './ticker.actions';\n\nconst initialState: TickerState = {\n  isRunning: false,\n  currentDate: '',\n  isFirstDate: true,\n  isLastDate: false,\n  dates: [],\n};\n\nexport function tickerReducer(state = initialState, action: TickerAction): TickerState {\n  switch (action.type) {\n    case actionTypes.initialize: {\n      const dates = action.payload as string[];\n      return {\n        ...state,\n        isRunning: false,\n        currentDate: dates[0],\n        isFirstDate: true,\n        isLastDate: false,\n        dates,\n      };\n    }\n\n    case actionTypes.updateDate: {\n      const currentDate = action.payload as string;\n      if (state.dates.indexOf(currentDate) === -1) {\n        return { ...state };\n      }\n      return {\n        ...state,\n        currentDate,\n        isFirstDate: currentDate === state.dates[0],\n        isLastDate: currentDate === state.dates[state.dates.length - 1],\n      };\n    }\n\n    case actionTypes.setRunning: {\n      return {\n        ...state,\n        isRunning: action.payload as boolean,\n      };\n    }\n\n    case actionTypes.setFirst: {\n      return {\n        ...state,\n        currentDate: state.dates[0],\n        isFirstDate: true,\n        isLastDate: false,\n      };\n    }\n\n    case actionTypes.setLast: {\n      return {\n        ...state,\n        currentDate: state.dates[state.dates.length - 1],\n        isFirstDate: false,\n        isLastDate: true,\n      };\n    }\n\n    case actionTypes.inc: {\n      const currentIndex = state.dates.indexOf(state.currentDate);\n      const lastIndex = state.dates.length - 1;\n      const incValue = action.payload as number;\n      const newDate =\n        currentIndex + incValue > lastIndex\n          ? state.dates[lastIndex]\n          : state.dates[currentIndex + incValue];\n      return {\n        ...state,\n        currentDate: newDate,\n        isFirstDate: newDate === state.dates[0],\n        isLastDate: newDate === state.dates[lastIndex],\n      };\n    }\n\n    case actionTypes.dec: {\n      const currentIndex = state.dates.indexOf(state.currentDate);\n      const decValue = action.payload as number;\n      const newDate =\n        currentIndex - decValue < 0 ? state.dates[0] : state.dates[currentIndex - decValue];\n      return {\n        ...state,\n        currentDate: newDate,\n        isFirstDate: newDate === state.dates[0],\n        isLastDate: newDate === state.dates[state.dates.length - 1],\n      };\n    }\n\n    default:\n      return state;\n  }\n}\n","import * as d3 from '../d3';\nimport { store, actions } from '../store';\n\nexport function createTicker(dates: string[]) {\n  store.dispatch(actions.ticker.initialize(dates));\n\n  let ticker: d3.Timer;\n\n  function start() {\n    ticker = d3.interval(showRace, store.getState().options.tickDuration);\n    store.dispatch(actions.ticker.setRunning(true));\n\n    function showRace(_: number) {\n      if (store.getState().ticker.isLastDate) {\n        if (store.getState().options.loop) {\n          loop();\n        } else {\n          stop();\n        }\n      } else {\n        store.dispatch(actions.ticker.inc());\n      }\n    }\n  }\n\n  function stop() {\n    if (ticker) {\n      ticker.stop();\n    }\n    store.dispatch(actions.ticker.setRunning(false));\n  }\n\n  function skipBack() {\n    stop();\n    store.dispatch(actions.ticker.setFirst());\n  }\n\n  function loop() {\n    store.dispatch(actions.ticker.setFirst());\n  }\n\n  function skipForward() {\n    stop();\n    store.dispatch(actions.ticker.setLast());\n  }\n\n  function toggle() {\n    if (store.getState().ticker.isLastDate) {\n      skipBack();\n      start();\n    } else if (store.getState().ticker.isRunning) {\n      stop();\n    } else {\n      start();\n    }\n  }\n\n  function goToDate(date: string) {\n    store.dispatch(actions.ticker.updateDate(date));\n  }\n\n  return {\n    start,\n    stop,\n    skipBack,\n    loop,\n    skipForward,\n    toggle,\n    goToDate,\n  };\n}\n","import * as options from '../options';\nimport * as renderer from '../renderer';\nimport * as ticker from '../ticker';\n\nexport const actions = {\n  options,\n  renderer,\n  ticker,\n};\n","import { optionsReducer, OptionsAction } from '../options';\nimport { rendererReducer, RendererAction } from '../renderer';\nimport { tickerReducer, TickerAction } from '../ticker';\nimport { Action, State } from './models';\n\nexport function rootReducer(state: State, action: Action): State {\n  return {\n    options: optionsReducer(state.options, action as OptionsAction),\n    renderer: rendererReducer(state.renderer, action as RendererAction),\n    ticker: tickerReducer(state.ticker, action as TickerAction),\n  };\n}\n","import { createStore } from './store';\nimport { rootReducer } from './reducer';\n\nexport const store = createStore(rootReducer);\n","import { Action, Reducer, State, Subscriber } from './models';\nimport { rootReducer } from './reducer';\n\nexport function createStore(reducer: Reducer = rootReducer, preloadedState?: State) {\n  let state = {} as State;\n\n  if (preloadedState) {\n    state = preloadedState;\n  }\n\n  function dispatch(action: Action) {\n    state = reducer(state, action);\n    notifySubscribers();\n    // eslint-disable-next-line no-console\n    console.log(state);\n    return action;\n  }\n\n  function getState() {\n    return state;\n  }\n\n  const subscribers: Subscriber[] = [];\n\n  function subscribe(fn: Subscriber) {\n    subscribers.push(fn);\n    const index = subscribers.length - 1;\n\n    return {\n      unsubscribe: () => {\n        subscribers.splice(index, 1);\n      },\n    };\n  }\n\n  function notifySubscribers() {\n    subscribers.forEach((fn: Subscriber) => {\n      fn();\n    });\n  }\n\n  return {\n    getState,\n    dispatch,\n    subscribe,\n  };\n}\n","import * as d3 from './d3';\n\nimport { Data } from './models';\nimport { store } from './store';\n\nexport function getColor(d: Data, disableGroupColors: boolean, colorSeed: string) {\n  const nameseed = d.group && !disableGroupColors ? d.group : d.name;\n  const seed = nameseed + colorSeed;\n  return d3.hsl(random(seed) * 360, 0.75, 0.75);\n}\n\nexport function zeroPad(n: string, w: number) {\n  while (n.toString().length < w) {\n    n = '0' + n;\n  }\n  return n;\n}\n\nexport function random(seedStr: string) {\n  function toNumbers(s: string) {\n    let nums = '';\n    for (let i = 0; i < s.length; i++) {\n      nums += zeroPad(String(s.charCodeAt(i)), 3);\n    }\n    return nums;\n  }\n\n  const seed = toNumbers(seedStr);\n  const x = Math.sin(+seed) * 10000;\n  return x - Math.floor(x);\n}\n\nexport function randomString(prefix: string, n: number) {\n  const rnd = Array(3)\n    .fill(null)\n    .map(() => Math.random().toString(36).substr(2))\n    .join('');\n  return prefix + rnd.slice(-n);\n}\n\nexport function generateId(prefix = 'racingbars', n = 8) {\n  return randomString(prefix, n);\n}\n\nexport function getHeight(element: HTMLElement, minHeight: number, height?: string) {\n  let newHeight;\n  if (!height) {\n    newHeight = element.getBoundingClientRect().height;\n  } else if (String(height).startsWith('window')) {\n    const scale = +height.split('*')[1] || 1;\n    newHeight = window.innerHeight * scale;\n  } else {\n    newHeight = +height;\n  }\n  return newHeight > minHeight ? newHeight : minHeight;\n}\n\nexport function getWidth(element: HTMLElement, minWidth: number, width?: string) {\n  let newWidth;\n  if (!width) {\n    newWidth = element.getBoundingClientRect().width;\n  } else if (String(width).startsWith('window')) {\n    const scale = +width.split('*')[1] || 1;\n    newWidth = window.innerWidth * scale;\n  } else {\n    newWidth = +width;\n  }\n  return newWidth > minWidth ? newWidth : minWidth;\n}\n\nexport function getElement(className: string) {\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\n  return element.querySelector(className) as HTMLElement;\n}\n\nexport function showElement(className: string) {\n  const selector = store.getState().options.selector;\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\n  if (element) {\n    element.style.display = 'none';\n  }\n}\n\nexport function hideElement(className: string) {\n  const selector = store.getState().options.selector;\n  const element = document.querySelector(selector + ' .' + className) as HTMLElement;\n  if (element) {\n    element.style.display = 'flex';\n  }\n}\n","import { Data } from './models';\nimport { zeroPad } from './utils';\n\nexport function getDates(data: Data[]) {\n  const uniqueDates = new Set<string>();\n  data.forEach((d) => {\n    uniqueDates.add(d.date);\n  });\n  return Array.from(uniqueDates).sort();\n}\n\nexport function filterDates(data: Data[], startDate: string, endDate: string) {\n  return data\n    .filter((d) => (startDate ? d.date >= startDate : true))\n    .filter((d) => (endDate ? d.date <= endDate : true));\n}\n\nexport function getDateString(inputDate: string | Date) {\n  const date = new Date(inputDate);\n  if (isNaN(+date)) {\n    throw new Error(`\"${inputDate}\" is not a valid date`);\n  }\n\n  const year = date.getFullYear();\n\n  let month = (1 + date.getMonth()).toString();\n  month = zeroPad(month, 2);\n\n  let day = date.getDate().toString();\n  day = zeroPad(day, 2);\n\n  return `${year}${month}${day}`;\n}\n\nexport function formatDate(dateStr: string, format: string) {\n  const year = dateStr.slice(0, 4);\n  const month = dateStr.slice(4, 6);\n  const day = dateStr.slice(6, 8);\n  const date = new Date(`${year}-${month}-${day}`);\n  const weekDayIndex = String(date.getDay());\n  const monthNames: { [key: string]: string } = {\n    '01': 'Jan',\n    '02': 'Feb',\n    '03': 'Mar',\n    '04': 'Apr',\n    '05': 'May',\n    '06': 'Jun',\n    '07': 'Jul',\n    '08': 'Aug',\n    '09': 'Sep',\n    '10': 'Oct',\n    '11': 'Nov',\n    '12': 'Dec',\n  };\n\n  const weekDays: { [key: string]: string } = {\n    '0': 'Sun',\n    '1': 'Mon',\n    '2': 'Tue',\n    '3': 'Wed',\n    '4': 'Thu',\n    '5': 'Fri',\n    '6': 'Sat',\n  };\n\n  return format\n    .replace('MMM', monthNames[month])\n    .replace('DDD', weekDays[weekDayIndex])\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day);\n}\n","import { formatDate, getDateString, getDates, filterDates } from './dates';\nimport { Data } from './models';\nimport { getColor } from './utils';\nimport { store } from './store';\nimport { Options } from './options';\n\nexport function prepareData(data: Data[]) {\n  const options = store.getState().options;\n\n  data = filterDates(data, options.startDate, options.endDate);\n\n  if (options.dataShape === 'wide') {\n    data = wideDataToLong(data);\n  }\n\n  if (options.fillDateGaps) {\n    data = fillGaps(data, options.fillDateGaps);\n  }\n\n  data = data.map((item) => {\n    const d = { ...item };\n    d.value = isNaN(+d.value) ? 0 : +d.value;\n    d.date = getDateString(d.date);\n    d.color = getColor(d, options.disableGroupColors, options.colorSeed);\n    return d;\n  });\n\n  data = calculateLastValues(data);\n\n  return data;\n}\n\nfunction calculateLastValues(data: Data[]) {\n  return data\n    .sort((a, b) => a.name.localeCompare(b.name) || a.date.localeCompare(b.date))\n    .reduce((acc: Data[], curr) => {\n      if (acc.length === 0) {\n        curr.lastValue = curr.value;\n      } else {\n        const last = acc[acc.length - 1];\n        if (curr.name === last.name) {\n          curr.lastValue = last.value;\n        } else {\n          curr.lastValue = curr.value;\n        }\n      }\n      return [...acc, curr];\n    }, [])\n    .sort((a, b) => a.date.localeCompare(b.date));\n}\n\nfunction wideDataToLong(wide: any) {\n  const long = [] as Data[];\n  wide.forEach((item: any) => {\n    for (const [key, value] of Object.entries(item)) {\n      long.push({\n        date: item.date,\n        name: key,\n        value: Number(value),\n      });\n    }\n  });\n  return long;\n}\n\nfunction fillGaps(data: Data[], period: Options['fillDateGaps']) {\n  if (!period) {\n    return data;\n  }\n\n  const dates = getDates(data);\n  const minDate = new Date(formatDate(dates[0], 'YYYY-MM-DD'));\n  const maxDate = new Date(formatDate(dates[dates.length - 1], 'YYYY-MM-DD'));\n\n  const next = {\n    years: (dt: Date) => {\n      dt.setFullYear(dt.getFullYear() + 1);\n    },\n    months: (dt: Date) => {\n      dt.setMonth(dt.getMonth() + 1);\n    },\n    days: (dt: Date) => {\n      dt.setDate(dt.getDate() + 1);\n    },\n  };\n  if (!next[period]) {\n    return data;\n  }\n\n  const dateRange: string[] = [];\n  for (const date = minDate; date < maxDate; next[period](date)) {\n    dateRange.push(getDateString(date));\n  }\n\n  dateRange.forEach((date, index) => {\n    if (data.filter((d) => d.date === date).length > 0) {\n      return;\n    }\n\n    const missing = data\n      .filter((d) => d.date === dateRange[index - 1])\n      .map((d) =>\n        // const value = {\n        //   last: d.value,\n        //   zero: 0,\n        // }\n        ({\n          ...d,\n          date,\n          // value: value[fillDateGapsValue],\n        }),\n      );\n\n    data.push(...missing);\n  });\n\n  return data;\n}\n\nexport function getDateSlice(data: Data[], date: string) {\n  return data\n    .filter((d) => d.date === date && !isNaN(d.value))\n    .sort((a, b) => b.value - a.value)\n    .slice(0, store.getState().options.topN)\n    .map((d, i) => ({ ...d, rank: i }));\n}\n","import * as d3 from './d3';\r\n\r\nexport function loadData(URL: string, type: 'json' | 'csv' | 'tsv' | 'xml' = 'json') {\r\n  switch (type) {\r\n    case 'json':\r\n      return d3.json(URL);\r\n    case 'csv':\r\n      return d3.csv(URL);\r\n    case 'tsv':\r\n      return d3.tsv(URL);\r\n    case 'xml':\r\n      return d3.xml(URL);\r\n    default:\r\n      throw new Error(`Unsupported data type: ${type}`);\r\n  }\r\n}\r\n","import { prepareData } from './data-utils';\nimport { getDates } from './dates';\nimport { Data } from './models';\n// import { formatDate, getDateString, getDates } from './dates';\n// import { Controls, Data, Overlays } from './models';\nimport { createRenderer } from './renderer';\nimport { createTicker } from './ticker';\nimport * as styles from './styles';\nimport { actions, store } from './store';\nimport { Options } from './options';\n\nexport function race(data: Data[], options: Options) {\n  store.dispatch(actions.options.optionsLoaded(options));\n\n  const element = document.querySelector(store.getState().options.selector) as HTMLElement;\n  if (!element) {\n    throw new Error('Cannot find element with this selector: ' + store.getState().options.selector);\n  }\n\n  if (store.getState().options.injectStyles) {\n    styles.styleInject(store.getState().options.selector, 'top');\n  }\n\n  data = prepareData(data);\n\n  const dates = getDates(data);\n\n  const ticker = createTicker(dates);\n\n  const renderer = createRenderer(data);\n  renderer.renderInitalView();\n  store.subscribe(renderer.renderFrame);\n  ticker.start();\n\n  if (!store.getState().options.autorun) {\n    ticker.stop();\n  }\n\n  // if (!state.options.disableClickEvents) {\n  //   registerClickEvents();\n  // }\n  // if (!state.options.disableKeyboardEvents) {\n  //   registerKeyboardEvents();\n  // }\n\n  // window.addEventListener('resize', resize);\n\n  // ********************\n  //   Helper functions\n  // ********************\n\n  // function renderInitalView() {\n\n  //   // const controls = renderer.getControls();\n  //   // registerControlButtonEvents(controls);\n  //   // registerOverlayEvents(controls);\n  // }\n\n  // function notifyRenderer(running: boolean, position: 'first' | 'last' | '') {\n  //   renderer.updateControls(running, position);\n  // }\n\n  // function registerControlButtonEvents(controls: Controls) {\n  //   if (!controls) {\n  //     return;\n  //   }\n  //   controls.skipBack.addEventListener('click', ticker.rewind);\n  //   controls.play.addEventListener('click', ticker.toggle);\n  //   controls.pause.addEventListener('click', ticker.toggle);\n  //   controls.skipForward.addEventListener('click', ticker.fastForward);\n  // }\n\n  // function registerOverlayEvents(controls: Overlays) {\n  //   if (!controls) {\n  //     return;\n  //   }\n  //   controls.overlayPlay.addEventListener('click', ticker.start);\n  //   controls.overlayRepeat.addEventListener('click', () => {\n  //     ticker.rewind();\n  //     ticker.start();\n  //   });\n  // }\n\n  // function resize() {\n  //   renderer.resize(reset);\n\n  //   function reset() {\n  //     const currentlyRunning = ticker.isRunning();\n  //     tickerDate.update();\n  //     renderInitalView();\n\n  //     if (currentlyRunning) {\n  //       ticker.start();\n  //     }\n  //   }\n  // }\n\n  // function updateDate(currentDate: string) {\n  //   dateSlice = getDateSlice(data, tickerDate.getDate(), lastValues, topN);\n  //   renderFrame();\n  //   element.dispatchEvent(\n  //     new CustomEvent('dateChanged', {\n  //       detail: { date: formatDate(currentDate, 'YYYY-MM-DD') },\n  //     }),\n  //   );\n  // }\n\n  // function createScroller() {\n  //   prepareDOM();\n\n  //   const step = document.body.clientHeight / dates.length;\n\n  //   subscribeToEvents();\n\n  //   function prepareDOM() {\n  //     element.style.position = 'fixed';\n  //     element.style.top = '0';\n\n  //     const scrollElement = document.createElement('div');\n  //     scrollElement.style.height = window.innerHeight * 10 + 'px';\n  //     document.body.appendChild(scrollElement);\n  //   }\n\n  //   function subscribeToEvents() {\n  //     window.addEventListener('scroll', goToDate);\n  //     // element.addEventListener(\"dateChanged\", scrollToPosition);\n  //   }\n\n  //   // function scrollToPosition(e: CustomEvent) {\n  //   //   let currentDate = getDateString(e.detail.date);\n  //   //   let index = dates.indexOf(currentDate);\n  //   //   ignoreNextScrollEvent = true;\n  //   //   window.scroll({\n  //   //     top: index * step,\n  //   //     behavior: \"smooth\",\n  //   //   });\n  //   // }\n\n  //   function goToDate() {\n  //     const index = Math.ceil(window.pageYOffset / step);\n  //     if (index < dates.length) {\n  //       tickerDate.setDate(dates[index]);\n  //     } else {\n  //       tickerDate.setLast();\n  //     }\n  //   }\n  // }\n\n  // function registerClickEvents() {\n  //   const svg = element.querySelector('svg') as SVGSVGElement;\n  //   svg.addEventListener('click', ticker.toggle);\n  //   element.addEventListener('dblclick', ticker.fastForward);\n  // }\n\n  // function registerKeyboardEvents() {\n  //   document.addEventListener('keypress', function (e) {\n  //     const keyCodes = {\n  //       spacebar: 32,\n  //       a: 97,\n  //       d: 100,\n  //       s: 115,\n  //     };\n\n  //     // TODO: keyCode is deprecated\n  //     switch (e.keyCode) {\n  //       case keyCodes.spacebar:\n  //         ticker.toggle();\n  //         break;\n  //       case keyCodes.a:\n  //         ticker.rewind();\n  //         break;\n  //       case keyCodes.s:\n  //         ticker.toggle();\n  //         break;\n  //       case keyCodes.d:\n  //         ticker.fastForward();\n  //         break;\n  //     }\n  //   });\n  // }\n\n  // ********************\n  //      Public API\n  // ********************\n\n  return {\n    // TODO: validate user input\n    //   start: () => {\n    //     if (!ticker.isRunning()) {\n    //       ticker.start();\n    //     }\n    //   },\n    //   stop: () => {\n    //     ticker.stop();\n    //   },\n    //   rewind: () => {\n    //     ticker.rewind();\n    //   },\n    //   fastforward: () => {\n    //     ticker.fastForward();\n    //   },\n    //   loop: () => {\n    //     ticker.loop();\n    //   },\n    //   inc: (value = 1) => {\n    //     tickerDate.inc(value);\n    //   },\n    //   dec: (value = 1) => {\n    //     tickerDate.dec(value);\n    //   },\n    //   getDate: () => tickerDate.getDate(),\n    //   setDate: (inputDate: string | Date) => {\n    //     tickerDate.setDate(getDateString(inputDate));\n    //   },\n    //   getAllDates: () => dates.map((date: string) => formatDate(date, 'YYYY-MM-DD')),\n    //   createScroller: () => {\n    //     createScroller();\n    //   },\n  };\n}\n","import { styles } from './styles';\n\n// slightly modifed from https://github.com/egoist/style-inject\nexport function styleInject(selector: string, insertAt = 'top', css = styles) {\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  // replace with selector\n  css = css.split('#selector').join(selector);\n\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const style = document.createElement('style') as HTMLStyleElement | any;\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n"],"names":["actionTypes","optionsLoaded","changeOptions","optionsChanged","initialState","selector","dataShape","fillDateGaps","fillDateGapsValue","startDate","endDate","colorSeed","disableGroupColors","tickDuration","topN","disableClickEvents","disableKeyboardEvents","autorun","loop","injectStyles","title","subTitle","caption","dateCounterFormat","labelsOnBars","labelsWidth","showControls","showOverlays","inputHeight","inputWidth","minHeight","minWidth","height","width","optionsReducer","state","action","type","payload","getDateString","buttonPress","click","keyPress","resize","controls","controlsContainer","skipBack","play","pause","skipForward","overlayContainer","overlayPlay","overlayRepeat","dimensions","renderedHeight","renderedWidth","elementHeight","elementWidth","windowHeight","windowWidth","rendererReducer","actions","ticker","setFirst","setLast","inc","dec","updateDate","button","newButtonsState","createRenderer","data","margin","svg","x","y","xAxis","barPadding","dateCounterText","labelX","updateControls","store","getState","options","hideElement","showElement","isRunning","isFirstDate","isLastDate","renderInitalView","controlIcons","overlayIcons","dateSlice","getDateSlice","currentDate","element","document","querySelector","innerHTML","getHeight","getWidth","top","right","bottom","left","d3","append","attr","html","domain","d","value","range","ticks","tickSize","tickFormat","n","call","selectAll","classed","name","enter","Math","abs","rank","style","color","text","lastValue","formatDate","strokeWidth","select","parentNode","insertBefore","this","cloneNode","getBoundingClientRect","Object","values","keys","renderFrame","transition","duration","ease","bars","replace","exit","remove","labels","valueLabels","tween","i","t","textContent","resetFn","String","startsWith","currentPosition","position","getRenderedHeight","getRenderedWidth","initialize","setRunning","dates","tickerReducer","indexOf","length","currentIndex","lastIndex","incValue","newDate","decValue","createTicker","start","_","stop","dispatch","toggle","goToDate","date","renderer","keyCode","running","rootReducer","reducer","preloadedState","subscribers","forEach","fn","console","log","subscribe","push","index","unsubscribe","splice","createStore","zeroPad","w","toString","newHeight","scale","split","window","innerHeight","newWidth","innerWidth","className","display","getDates","uniqueDates","Set","add","Array","from","sort","inputDate","Date","isNaN","Error","year","getFullYear","month","getMonth","getDate","dateStr","format","slice","day","weekDayIndex","getDay","01","02","03","04","05","06","07","08","09","10","11","12","0","1","2","3","4","5","6","filter","a","b","map","prefix","fill","random","substr","join","randomString","URL","insertAt","css","head","getElementsByTagName","createElement","firstChild","appendChild","styleSheet","cssText","createTextNode","styles","long","filterDates","item","entries","Number","period","minDate","maxDate","next","years","dt","setFullYear","months","setMonth","days","setDate","dateRange","missing","fillGaps","localeCompare","reduce","acc","curr","last","calculateLastValues","seed","s","nums","charCodeAt","toNumbers","group","sin","floor","getColor","prepareData"],"mappings":"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"}